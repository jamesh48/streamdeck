
/*---
/plugins/searchBuildByNumber//search.js
---*/
(function(a){BS.Search={reactHeaderEnabled:window.ReactUI.isSakuraHeaderUsed(),containerSiblings:null,currentBuildTypeId:null,active:false,timer:null,hideTimerId:null,init:function(){var c=document.createElement("span");var b=document.getElementById("inputIdF");Element.cleanWhitespace(b);b.firstChild.id="headerSearchField";c.classList.add("search");c.innerHTML=b.innerHTML;b.remove();if(BS.Search.reactHeaderEnabled){c.classList.add("sakura");}new TeamCityAPI.Plugin(BS.Search.reactHeaderEnabled?TeamCityAPI.Plugin.placeIds.SAKURA_HEADER_RIGHT:TeamCityAPI.Plugin.placeIds.HEADER_RIGHT,{name:"Search by Build Number",content:c,options:{},onMount:function(d){if(BS.Search.reactHeaderEnabled){BS.Search.setCurrentBuildTypeId(d&&d.location&&d.location.buildTypeId||null);}BS.Search.addEventListeners();},onContextUpdate:function(d){if(BS.Search.reactHeaderEnabled){BS.Search.setCurrentBuildTypeId(d&&d.location&&d.location.buildTypeId||null);}}});b.classList.remove("hidden");},setCurrentBuildTypeId:function(b){BS.Search.currentBuildTypeId=b||null;},setActive:function(b){if(b){a(b).parent().addClass("searchFocused");}if(b.id==="headerSearchField"){BS.Search.hideSiblings();}BS.Search.active=true;},setInactive:function(b){if(b){a(b).parent().removeClass("searchFocused");}else{a(".searchFocused").removeClass("searchFocused");}BS.Search.showSiblings();BS.Search.active=false;},getSiblings:function(){if(BS.Search.containerSiblings!==null){return BS.Search.containerSiblings;}var c=[];var b=a(".header-tray > div");b.each(function(){if(a(this).find(".search.sakura").length==0){c.push(this);}});BS.Search.containerSiblings=c;return c;},hideSiblings:function(){if(!this.reactHeaderEnabled){return;}var b=BS.Search.getSiblings();b.forEach(function(c){a(c).addClass("search-plugin-invisible");});},showSiblings:function(){if(!this.reactHeaderEnabled){return;}if(BS.Search.hideTimerId){clearTimeout(BS.Search.hideTimerId);}var b=BS.Search.getSiblings();b.forEach(function(c){a(c).removeClass("hidden");});BS.Search.hideTimerId=setTimeout(function(){b.forEach(function(c){a(c).removeClass("search-plugin-invisible");});},150);},addEventListeners:function(){var b=a("#searchField, #headerSearchField");b.on("focus",function(c){BS.Search.setActive(c.target);});b.on("blur",function(c){if(c.relatedTarget==document.querySelector(".quickSearchButton")){return false;}BS.Search.setInactive(c.target);});b.on("keydown",function(){BS.Tooltip.hidePopup();});b.on("keypress",function(c){if(c.keyCode==13){BS.Search.go(c.shiftKey,$j(this));return false;}});BS.Search.attachSearchInputListener();if(BS.Search.reactHeaderEnabled){BS.Search.attachModernLogics();}},attachModernLogics:function(){var b=a(".quickSearchButton").first();var c=a(".quickSearchCancelButton").first();var d=a(".quickSearchQuery").first();c.on("click",function(e){e.stopPropagation();BS.Search.setInactive();});b.on("click",function(e){e.preventDefault();d.focus();});},attachSearchInputListener:function(){var b=a("#headerSearchField");b.on("keypress paste",BS.Search.searchInputChangeHandler);},searchInputChangeHandler:function(b){if(BS.Search.timer){clearTimeout(BS.Search.timer);}if(b.keyCode==Event.KEY_ESC){return false;}else{BS.Search.timer=setTimeout(function(){BS.Search.showPopup(BS.Search.getUrl());},700);}},disableSearchTooltip:function(){BS.Cookie.set("n_s_h","true",60);BS.Tooltip.hidePopup();},getCurrentBuildType:function(){if(BS.Search.reactHeaderEnabled){return BS.Search.currentBuildTypeId||"";}else{return a("#inputIdF").attr("data-btId");}},go:function(c,e){var d=a("#searchByTime");var b=window["base_uri"]+"/searchResults.html?query="+encodeURIComponent(e.val())+"&buildTypeId="+BS.Search.getCurrentBuildType()+"&byTime="+(d.length>0?d.val():false);if(c){window.open(b);}else{document.location.href=b;}},getUrl:function(){return window["base_uri"]+"/searchResults.html?query="+encodeURIComponent(a("#headerSearchField").val())+"&buildTypeId="+BS.Search.getCurrentBuildType();},showPopup:function(b){new BS.Popup("searchResultsPopup",{delay:0,shift:{x:-150,y:22},hideOnMouseOut:false,loadingText:"Loading search results...",url:b+"&popupMode=true",afterShowFunc:function(c){}}).showPopupNearElement("headerSearchField",{forceReload:true});},highlightResult:function(d){var c=a(d);var b;c.each(function(){var e=a(this);b=e.data("zones");if(b){b.split(" ").forEach(function(f){if(f){e.find("span"+f).addClass("highlightChanges");}});}});}};a(document).ready(function(){BS.Search.init();});})(jQuery);