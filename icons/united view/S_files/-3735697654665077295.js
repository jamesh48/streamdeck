
/*---
/js/bs/bs.js
---*/
window.name="tcMain";window.name321="tcMain";window.$j=window.$j||jQuery.noConflict;$j(function(){BS.enableDisabled();BS.CSRF.addCSRFHeaderJQuery();$j(document).ajaxError(function(c,b,a){BS.CSRF.handleCSRFError(b,null,a.headers&&a.headers["X-TC-CSRF-Token"]);});});var OO={extend:function(a,b){return $j.extend({},a,b);},bindAll:function(b){var a=new Object();for(var c in b){if(typeof(b[c])=="function"){a[c]=b[c].bind(a);}else{a[c]=b[c];}}return a;}};var BS={Log:{_levelValues:{debug:0,info:1,warn:2,error:3},_defaultLevel:internalProps["teamcity.development.mode"]?"debug":"info",_log:function(e,d,a){var c=this._levelValues[BS.Util.extractParam("logLevel")]||this._levelValues[this._defaultLevel];if(this._levelValues[e]<c){return;}var b=window.console;if(b&&b[e]){if(a.length==1){b[e](d);if(d.stack){b[e](d.stack);}}else{Function.prototype.apply.apply(b[e],[b,Array.prototype.slice.call(a)]);}}},error:function(a){this._log("error",a,arguments);},warn:function(a){this._log("warn",a,arguments);},info:function(a){this._log("info",a,arguments);},debug:function(a){this._log("debug",a,arguments);}},loadingUrl:window["base_uri"]+"/img/spinner.gif",loadingIcon:'<i class="icon-refresh icon-spin ring-loader-inline"></i>',_canReload:true,_temporaryBlocked:false,_tempBlockedTimer:null,stopObservingInContainers:function(e,a){if(e.nodeType==1){e=[e];}var b=e.length;while(b--){var c=e[b];$j(c).find("[data-observe-visibility]").each(function(g,f){ReactUI.stopObservingVisibility(f);});if(!a||!c.dataset.cleanedUp){$j(c).find("[data-react-refreshable-root]").each(function(g,f){ReactUI.markAsUnused(f.id);});}c.dataset.cleanedUp=true;var d=Array.prototype.slice.call(c.getElementsByTagName("*")).concat(c);jQuery.cleanData(d);Element.purge(c);d.forEach(function(f){BS.BackgroundLoader.remove(f);ReactUI.performCleanups(f);});}},stopObservingWhenDetached:function(b,a){if(document.body.contains(b)){setTimeout(BS.stopObservingWhenDetached.bind(BS,b),100000);}else{if(a===true){BS.stopObservingInContainers([b],true);}else{setTimeout(BS.stopObservingWhenDetached.bind(BS,b,true),10000);}}},refreshBlocked:function(){return !BS._canReload||BS._temporaryBlocked;},canReload:function(){return !BS.Hider.hasVisiblePopups()&&!BS.refreshBlocked()&&document.readyState!=="loading"&&document.readyState!=="uninitialized"&&window.getSelection().toString().length===0;},initReloadBlocker:function(){if(window.ReactUI.isExperimentalUI){return;}if(BS.Browser.mozilla){$(document.body).on("mousedown",function(b,a){if(typeof BS=="object"){if(a.tagName.toUpperCase()=="A"&&a.href&&(a.href.indexOf("#")==-1||a.href.indexOf("javascript://")==-1)){BS.blockRefreshTemporary(1000);}}});}$(document.body).on("mousemove",function(){if(typeof BS!="object"){return;}BS.blockRefreshTemporary(100);});Event.observe(window,"scroll",function(){if(typeof BS!="object"){return;}BS.blockRefreshTemporary(100);});},blockRefreshTemporary:function(a){if(!BS._canReload){return;}var b=a||10*1000;if(BS._tempBlockedTimer){clearTimeout(BS._tempBlockedTimer);}BS._temporaryBlocked=true;BS._tempBlockedTimer=setTimeout(function(){BS._temporaryBlocked=false;},b);},_blockingActions:{},blockRefreshPermanently:function(a){BS._blockingActions[a||"default"]=true;BS._canReload=false;},unblockRefresh:function(a){delete BS._blockingActions[a||"default"];if(_.isEmpty(BS._blockingActions)){BS._canReload=true;if(BS._tempBlockedTimer){clearTimeout(BS._tempBlockedTimer);}BS._temporaryBlocked=false;}},_reloadTimeout:null,reload:function(c,b,a){if(!a){a=$j.Deferred();}if(BS._reloadTimeout){clearTimeout(BS._reloadTimeout);BS._reloadTimeout=null;}if(BS.canReload()||c){a.resolve();if(b){b();}else{window.location.reload(true);}}else{BS._reloadTimeout=setTimeout(function(){BS.reload(c,b,a);},100);}return a;},trimText:function(b,a){b=b||"";a-=1;if(b.length>a+3){return b.substr(0,a/2)+"\u2026"+b.substr(b.length-a/2,b.length);}return b;},ajaxRequest:function(b,a){var c=BS._patchOptions(b,a);if(!c.afterCSRFRetry){c.afterCSRFRetry=function(){c.afterCSRFRetry=function(){};BS.CSRF.addCSRFHeader(c);new Ajax.Request(b,c);};}return new Ajax.Request(b,c);},ajaxUpdater:function(a,c,b){if(typeof a==="string"){a=$(a);}if(a==null){return null;}if(!a.success){a={success:a};}var d=BS._patchOptions(c,b,a);if(!d.afterCSRFRetry){d.afterCSRFRetry=function(){d.afterCSRFRetry=function(){};BS.CSRF.addCSRFHeader(d);new Ajax.Updater(a,c,d);};}return new Ajax.Updater(a,c,d);},_getRequestKey:function(a,b){if(_.isObject(b)){return a+Object.toQueryString(b);}else{if(_.isString(b)){return a+b;}else{return a;}}},_patchOptions:function(d,c,b){if(c==null){c={};}var a=BS.CSRF.addCSRFHeader(c);var e=c.onComplete;c.onComplete=function(f,g){if(BS.CSRF.handleCSRFError(f,c.afterCSRFRetry,a)){return;}var h=f.responseXML;if(h){var i=BS.XMLResponse.processErrors(h,{onAccessDeniedError:function(j){BS.XMLResponse.processRedirect(j.ownerDocument);},onUnexpectedError:function(k){var j="Unexpected error occurred on server:<br/>"+k.textContent.escapeHTML();BS.Log.error(j);if(c.onUnexpectedError){c.onUnexpectedError(h,k);}else{BS.confirmDialog.show({title:"Unexpected error",text:j,actionButtonText:"Reload",action:function(){BS.reload(true);}});}}});if(i){return;}}else{if(BS._reloadIfReceivedHTML(f)){return;}}if(f.status===401&&f.request.url.indexOf(base_uri)===0){BS.SubscriptionManager.closeSocket("you are logged out");}if(e){e.call(c,f,g);}if(b){if($(b) instanceof Element){BS.loadRetinaImages(b);}else{["success","failure"].forEach(function(j){if(b[j]){BS.loadRetinaImages(b[j]);}});}}};return c;},internalProperty:function(a,c){var b=window["internalProps"]==undefined?c:window["internalProps"][a];return b==undefined?c:b;},_reloadIfReceivedHTML:function(a){var b=a.responseText;if(a.status==200&&b.match(/^\s*<!DOCTYPE html[^>]*>[\s\S]*<\/html>\s*/i)){BS.reload(true);return true;}return false;}};BS.CSRF={_failureCount:0,_cachedToken:null,addCSRFHeaderJQuery:function(){var a=this.getToken();if(a){$j.ajaxSetup({headers:{"X-TC-CSRF-Token":a}});}},addCSRFHeader:function(b){var a=this.getToken();if(a){b.requestHeaders=b.requestHeaders||{};b.requestHeaders["X-TC-CSRF-Token"]=a;}return a;},handleCSRFError:function(b,c,a){if(b&&b.status==403&&b.responseText.indexOf("CSRF")>=0){if(a!=null&&a!==this.getCachedToken()){if(c!=null){BS.Log.info("CSRF token already updated. Retry request");c();}}else{BS.Log.info("CSRF check error for the request");this.refreshCSRFToken(c);}return true;}return false;},getToken:function(){var a=$j("meta[name=tc-csrf-token]").attr("content");this._cachedToken=a;return a;},getCachedToken:function(){return this._cachedToken;},retryCallbacks:[],refreshCSRFToken:function(c,b){if(c!=null){this.retryCallbacks.push(c);}if(!b&&!BS.Util.isPageVisible()){return;}var a=this;BS.ajaxRequest(window["base_uri"]+"/authenticationTest.html?csrf",{method:"GET",onSuccess:function(d){BS.Log.info("CSRF token has been updated");$j("meta[name=tc-csrf-token]").attr("content",d.responseText);$j(".tc-csrf-token-input").attr("value",d.responseText);a.addCSRFHeaderJQuery();this._cachedToken=d.responseText;if(a.retryCallbacks.length>0){BS.Log.info("Retry requests after CSRF token update");a.retryCallbacks.forEach(function(e){e();});a.retryCallbacks=[];}},onFailure:function(){BS.Log.info("Cannot refresh CSRF token");}});},initPeriodicalCsrfRefresh:function(){BS.PageVisibilityListeners.subscribe({onPageBecameVisible:function(){BS.CSRF.refreshCSRFToken();BS.ServerLink.getServerInfo();}});var a=1000*60*30;var b=Math.random()*a;setTimeout(function(){setInterval(function(){BS.CSRF.refreshCSRFToken(null,true);},a);},b);}};BS.WebSocketLog=function(){var a=[];return{log:function(g,e){if(e.length>200){e=e.substring(0,200)+"...";}if(a.length>50){a.shift();}var d=new Date();var b=function(h){if(h<10){return"0"+h;}else{return""+h;}};var f=function(h){if(h<10){return"00"+h;}if(h<100){return"0"+h;}else{return""+h;}};var c="["+b(d.getHours())+":"+b(d.getMinutes())+":"+b(d.getSeconds())+"."+f(d.getUTCMilliseconds())+", session "+g+"]: "+e;a.push(c);if(BS.internalProperty("teamcity.ui.webSocket.logToConsole",false)){BS.Log.debug("WebSocket: "+c);
}},getLog:function(){return a;}};}();BS.WebSocketProperties={heartbeatIntervalMillis:15000,webSocketEnabled:true};BS.WebSocket=function(){var q;var n;var o=false;var m=false;var i;var l;var p=[];var k;var g;var a;var c;var h=function(){if(l){clearTimeout(l);l=null;}if(g){clearTimeout(g);g=null;}if(k){clearTimeout(k);k=null;}if(o){o=false;if(a){b("Calling WebSocket disconnected listener");a();}}if(i.state()==="pending"){i.resolve(false);}};var b=function(r){BS.WebSocketLog.log(c,r);};var f=function(r){b("WebSocket connection failed"+(r?(": "+r):""));h();if(n!=null&&n.readyState===1){b("Closing WebSocket on error");n.close();}};var e=function(){if(m){b("WebSocket connection is established, but the connection timeout was already fired, closing the socket.");if(n.readyState===1){n.close();}return;}o=true;clearTimeout(l);b("WebSocket connection is successfully established");(function r(){while(p.length>0){var s=p.splice(0,50).join(",");d(s);}k=setTimeout(r,500);})();d("ping");if(i.state()==="pending"){i.resolve(true);}};var d=function(r){b("Sending message '"+r+"'");n.send(r);};var j=function(){if(!window.WebSocket){f("WebSocket is not supported in the current browser");return;}var r=(window["base_uri"]).replace(/^http/,"ws")+"/app/subscriptions"+"?browserLocationHost="+encodeURIComponent(window["base_uri"]);b("Opening websocket on '"+r+"'");n=new WebSocket(r);n.onmessage=function(t){var s=t.data;b("Message received: '"+s+"'");if(g){clearTimeout(g);}g=setTimeout(function(){if(o){b("Closing WebSocket session due to idle timeout");h();n.close();}},BS.WebSocketProperties.heartbeatIntervalMillis*2);if(s=="socketOpened"){e();return;}if(s=="ping#Ping"){if(o){d("pong");}return;}if(q){q(s);}};n.onerror=function(){b("WebSocket 'error' event captured");f();};n.onclose=function(s){if(s.wasClean){b("WebSocket closed normally with code "+s.code+" "+s.reason);}else{b("WebSocket closed unexpectedly with code "+s.code+" "+s.reason);}h();};n.onopen=function(){b("WebSocket 'open' event captured");d("tc-csrf-token:"+BS.CSRF.getToken());};l=setTimeout(function(){if(!o){m=true;f("Connection timeout");}},BS.internalProperty("teamcity.ui.websocket.connectTimeout",3000));};return{open:function(r){if(!BS.WebSocketProperties.sessionsCounter){BS.WebSocketProperties.sessionsCounter=1;}c=BS.WebSocketProperties.sessionsCounter++;if(!BS.WebSocketProperties.webSocketEnabled){b("WebSocket support is disabled on server side.");r.onFailedToOpen();return;}i=$j.Deferred();i.done(function(s){b("WebSocket opening deferred is resolved to "+s);if(s){r.onOpen();}else{r.onFailedToOpen();}});a=r.onDisconnected;q=r.onMessage;j();},close:function(r){if(n!=null&&n.readyState===1){b("Closing WebSocket"+r&&(": "+r)+".");n.close();}},sendMessage:function(r){p.push(r);}};};BS.periodicalExecutor=function(b,a){var e;var h;var c=null;if(!a){a=5000;}var g=function(){if(BS.Util.isPageVisible()){clearTimeout(e);e=setTimeout(d,a);}};var d=function(){c=b().then(g,g);};var f=function(){return c.then(function(){clearTimeout(e);});};return{start:function(){d();var i=this;h=BS.PageVisibilityListeners.subscribe({onPageBecameHidden:function(){f();},onPageBecameVisible:function(){i.unscheduledExecution();}});},unscheduledExecution:function(){f().then(d);},stop:function(){f();BS.PageVisibilityListeners.unsubscribe(h);}};};BS.SubscriptionManager=function(){var d={};var g=null;var f="default";var c;var b;function a(i,j){var h=d[i];if(h==null){return;}Object.keys(h).forEach(function(k){var l=h[k];if(l!=null){h[k](j);}else{BS.Log.info("Message with unknown handler '"+i+"' was received: "+j);}});}var e={subscribe:function(j,k,i){var h=i||f;if(d[j]==null){d[j]={};if(c){b.sendMessage(j);}}else{if(d[j][h]!=null){return;}}d[j][h]=k;return function(){e.unsubscribe(j,i);};},unsubscribe:function(k,j){var i=j||f;var h=d[k]||{};if(h[i]==null){return;}delete h[i];if(Object.keys(h).length===0){if(c){b.sendMessage("unsubscribe#"+k);}delete d[k];}},checkNow:function(){if(g){g.unscheduledExecution();}},start:function(){b=BS.WebSocket();b.open({onOpen:function(){c=true;for(var h in d){if(d.hasOwnProperty(h)){b.sendMessage(h);}}},onFailedToOpen:function(){c=false;g=BS.periodicalExecutor(function(){var h=$j.Deferred();BS.ajaxRequest(window["base_uri"]+"/subscriptions.html",{method:"post",parameters:"topics="+Object.keys(d).join(","),onComplete:function(j){if(j&&j.status!=200){BS.ServerLink.waitUntilServerIsAvailable(BS.SubscriptionManager.start);g.stop();g=null;return;}var m=j.responseText.trim();while(m.length!==0){var i=m.indexOf("|");var k=m.substring(0,i);m=m.substring(i+1);var n=m.indexOf("|");var l=m.substring(0,n);m=m.substring(n+1);a(k,m.substring(0,l));m=m.substring(l);}h.resolve();}});return h.promise();},BS.internalProperty("teamcity.ui.pollInterval")*1000);g.start();},onDisconnected:function(){c=false;BS.ServerLink.waitUntilServerIsAvailable(function(){BS.SubscriptionManager.start();});},onMessage:function(j){var k=j.indexOf("#");var h=j.substring(0,k);var i=j.substring(k+1);a(h,i);}});},dispose:function(){if(g){g.stop();}d={};},closeSocket:function(h){if(b!=null){b.close(h);}}};return e;}();BS.ServerCommands={_reloadCounter:null,startWatching:function(){var a=this;BS.SubscriptionManager.subscribe("serverCommands/reload",function(d){var c=JSON.parse(d);if(!c){return;}if(a._reloadCounter===null){a._reloadCounter=c.counter;return;}if(a._reloadCounter!==c.counter){var b=Math.floor((Math.random()*c.dispersion)+1);BS.Log.info("Received reload command from the server, page will be reloaded in "+b+" seconds.");setTimeout(function(){BS.reload(false);},b*1000);}});}};Ajax.PeriodicalUpdater.addMethods({updateNow:function(){clearTimeout(this.timer);this.onTimerEvent();}});BS.PeriodicalUpdater=Class.create(Ajax.PeriodicalUpdater,{initialize:function($super,a,c,b){this.initialFrequency=b.frequency||2;this.reducedFrequency=this.initialFrequency*5;this.initialOnSuccess=b.onSuccess||Prototype.emptyFunction();this.initialOnFailure=b.onFailure||Prototype.emptyFunction();b.onSuccess=this.onSuccess.bind(this);b.onFailure=this.onFailure.bind(this);b.onException=this.onException.bind(this);b.onComplete=this.onComplete.bind(this);BS.CSRF.addCSRFHeader(b);this.visibilityListenerId=this.setupVisibilityHandler();if(a&&!a.success){a={success:a};}$super(a||{update:function(){}},c,b);},updateComplete:function(){if(!this.isPaused){Ajax.PeriodicalUpdater.prototype.updateComplete.apply(this,arguments);}},onComplete:function(){this.stopVisibilityHandler();},onSuccess:function(a,b){if(a&&a.status==0){this.onFailure(a,b);return;}this.frequency=this.initialFrequency;this.failureState=false;if(this.initialOnSuccess){if(BS._reloadIfReceivedHTML(a)){return;}this.initialOnSuccess.call(this.options,a,b);}},onFailure:function(a,b){this.frequency=this.reducedFrequency;this.failureState=true;if(this.initialOnFailure){this.initialOnFailure.call(this.options,a,b);}},onException:function(){this.frequency=this.reducedFrequency;this.failureState=true;},setupVisibilityHandler:function(){var a=this;return BS.PageVisibilityListeners.subscribe({onPageBecameVisible:function(){a.isPaused=false;a.updateNow();},onPageBecameHidden:function(){a.isPaused=true;}});},stopVisibilityHandler:function(){if(this.visibilityListenerId!==undefined){BS.PageVisibilityListeners.unsubscribe(this.visibilityListenerId);}}});BS.PageVisibility={detect:function(){var c,b;if(typeof document.hidden!=="undefined"){c="hidden";b="visibilitychange";}else{if(typeof document.mozHidden!=="undefined"){c="mozHidden";b="mozvisibilitychange";}else{if(typeof document.msHidden!=="undefined"){c="msHidden";b="msvisibilitychange";}else{if(typeof document.webkitHidden!=="undefined"){c="webkitHidden";b="webkitvisibilitychange";}}}}var a=typeof document.addEventListener!=="undefined"&&typeof c!=="undefined";return{supported:a,hiddenProperty:c,visibilityChangeEvent:b};}};BS.PageVisibilityListeners=function(){var b=BS.PageVisibility.detect();var a=[];if(b.supported){document.addEventListener(b.visibilityChangeEvent,function(){if(document[b.hiddenProperty]){for(var d=0;
d<a.length;d++){if(a[d]){if(a[d].onPageBecameHidden){a[d].onPageBecameHidden();}}}}else{for(var c=0;c<a.length;c++){if(a[c]){if(a[c].onPageBecameVisible){a[c].onPageBecameVisible();}}}}},false);}return{subscribe:function(c){if(!b.supported||(BS.Cookie&&BS.Cookie.get("disable-visibility-api")==1)){return -1;}return a.push(c)-1;},unsubscribe:function(c){a[c]=undefined;}};}();BS.EventTracker={_subscriptions:{},_toBeInvokedListeners:[],subscribeOnEvent:function(a,b,c){this._subscribeOnEvent(a,b,"",c);},subscribeOnProjectEvent:function(b,c,a,d){this._subscribeOnEvent(b,c,"p:"+a,d);},subscribeOnBuildTypeEvent:function(b,c,a,d){this._subscribeOnEvent(b,c,"b:"+a,d);},subscribeOnUserEvent:function(a,c,b,d){this._subscribeOnEvent(a,c,"u:"+b,d);},subscribeOnAgentEvent:function(a,b,d,c){this._subscribeOnEvent(a,b,"a:"+d,c);},_subscribeOnEvent:function(a,b,d,e){var c={currentValue:b,listeners:[e],id:a+";"+d};this._addSubscription(c);},unsubscribeBuildTypeEventSubscription:function(b,a){this._removeSubscription(b,"b:"+a);},_removeSubscription:function(a,c){var d=(a+";"+c);var b=this._subscriptions[d];if(b){b.listeners=[];delete b[d];}BS.SubscriptionManager.unsubscribe("events/"+d);},_addSubscription:function(c){var b=this._subscriptions[c.id];if(b!=null){for(var a=0;a<b.listeners.length;a++){if(b.listeners[a].toString().strip()==c.listeners[0].toString().strip()){return;}}b.listeners.push(c.listeners[0]);}else{this._subscriptions[c.id]=c;}BS.SubscriptionManager.subscribe("events/"+c.id,function(d){if(c.currentValue!=d){c.currentValue=d;for(var e=0;e<c.listeners.length;e++){BS.EventTracker._addPendingListener(c.listeners[e]);}}});},_callPendingListeners:function(){for(var a=0;a<this._toBeInvokedListeners.length;a++){try{this._toBeInvokedListeners[a]();}catch(b){BS.Log.error(b);}}this._toBeInvokedListeners=[];},_addPendingListener:function(a){if(!this._toBeInvokedListeners.include(a)){this._toBeInvokedListeners.push(a);}},startTracking:function(){(function a(){setTimeout(function(){BS.EventTracker._callPendingListeners();a();},BS.internalProperty("teamcity.ui.events.pollInterval")*1000);})();},checkEvents:function(){BS.SubscriptionManager.checkNow();}};BS.StatisticsMonitor=function(){var a=function(e,j,d){var f=e-j;if(e!=null){var k=0;if(f>0||j>0){k=Math.round(f*100/e);}if(k<0){k=100;}var c=j;if(c<0){c=0;}var i="";if(e==0){i="There are no agents";}else{if(c==0){i="All agents are busy";}else{if(c==e){i="All agents are idle";}else{i=f+(f>1?" builds are":" build is")+" running, ";i+=c+(c>1?" agents are":" agent is")+" idle";}}}var g='<div class="mug" onmouseover="BS.Tooltip.showMessage(this, {shift:{x:10,y:20}}, \''+i+'\')" onmouseout="BS.Tooltip.hidePopup()">';if(k>0){var l=16;var h=Math.round((100-k)/100*l);g+='<div class="mugStuff" style="top: '+h+"px; height: "+(l-h)+'px;"></div>';}g+="</div>";var b=BS.topNavPane.getTab("agents");b.setPostLinkContent(g);b.setCaption("Agents ("+e+")");}if(d!=null&&BS.topNavPane.getTab("queue")){BS.topNavPane.getTab("queue").setCaption("Build Queue ("+d+")");}};return{start:function(){BS.SubscriptionManager.subscribe("statistics",function(c){var b=JSON.parse(c);a(b.agentsNum,b.freeAgentsNum,b.buildQueueSize);});}};}();BS.InvestigationsCounterMonitor=function(){var a=function(d,b){var c=$j(".investigationsTicker");if(c.length>0){c.removeClass("investigationsNew");c.removeClass("investigationsOld");if(d==0){c.html("");}else{var e=b?"You have some recently updated investigations, click to view":"Review your active investigations";c.html("<a class='investigationsLink' href='"+window["base_uri"]+"/investigations.html' title='"+e+"'>"+d+"</a>");c.addClass(b?"investigationsNew":"investigationsOld");}}};return{start:function(b){BS.SubscriptionManager.subscribe("investigationsCounter/"+b,function(f){var g=$j.parseXML(f).documentElement;var c=g.getElementsByTagName("investigations");if(!c||c.length!=1){return;}var e=c[0].getAttribute("activeCount");var d=c[0].getAttribute("hasNew")=="true";a(e,d);});}};}();BS.Util={escape:function(a){if(typeof a!=="string"){return a;}return a.escapeHTML().replace(/"/g,"&quot;").replace(/'/g,"&#39;");},removePrefix:function(a,b){return a.startsWith(b)?a.substring(b.length):a;},removeSuffix:function(b,c){var a=b.lastIndexOf(c);return b>=0?b.substring(0,a):b;},wrapRelative:function(a){if($j(a).parent().hasClass("posRel")){return $j(a).parent();}return $j(a).wrap('<div class="posRel"/>').parent();},extractParam:function(d,c){if(typeof c=="undefined"){c=window.location.search.substring(1);}var e=c.split("&");for(var b=0;b<e.length;b++){var a=e[b].split("=");if(a[0]==d){return a[1];}}},place:function(b,a,c){$(b).setStyle({left:a+"px",top:c+"px"});},center:function(b,a){var c=BS.Util.computeCenter(b,a);BS.Util.place(b,c[0],c[1]);},computeCenter:function(d,a){if(!a){a=$("mainContent");}d=$(d);var b=a.getDimensions();var c=a.cumulativeOffset();var j=BS.Util.windowSize();var f=d.style.visibility;var g=d.style.display;d.setStyle({visibility:"hidden",display:"block"});var e=d.getDimensions();d.setStyle({visibility:f,display:g});var i=0;var h=Math.round(this._scrollTop()+(j[1]-e.height)/2);if(b.width>j[0]){i=Math.round(this._scrollLeft()+(j[0]-e.width)/2);}else{i=Math.round(c[0]+(b.width-e.width)/2);}if(_.isElement(a)&&a.id=="mainContent"){h=Math.max(h,0);}return[i,h];},_scrollTop:function(){return $j(window).scrollTop();},_scrollLeft:function(){return $j(window).scrollLeft();},windowSize:function(a){var b=$j(a||window);return[b.width(),b.height()];},placeNearElement:function(d,c,b){if(!b){b={};b.x=0;b.y=15;}c=$(c);var f=c.positionedOffset();var a=f[0]+b.x;var e=f[1]+b.y;BS.Util.place(d,a,e);},showNearElement:function(d,a,b){var c=$(a);if(typeof b=="undefined"){b=-180;}BS.Util.placeNearElement(c,d,{x:b,y:21});BS.Hider.showDivWithTimeout(c,{hideOnMouseOut:false});},visible:function(a){return jQuery($(a)).is(":visible");},toElement:function(a){return jQuery($(a)).get(0);},toElements:function(a){return jQuery($(a)).get();},show:function(){var a=Array.from(arguments).map(BS.Util.toElements).reduce(function(c,b){return c.concat(b);},[]);return ReactUI.showHide(a,true).then(function(){a.forEach(function(b){Array.prototype.forEach.call(b.querySelectorAll("iron-list"),function(c){c.fire("iron-resize");});});});},hide:function(){var a=Array.from(arguments).map(BS.Util.toElements).reduce(function(c,b){return c.concat(b);},[]);return ReactUI.showHide(a,false);},toggleDependentElements:function(e,c,d,a){var b=a&&a[e];if(!b){b=e;}var f="."+c+":not(."+b+")";$j(f).hide();if(d){$j(f+" input:text").val("");$j(f+" input:password").val("");$j(f+" input:file").val("");$j(f+" select").prop("selectedIndex",0);$j(f+" textarea").val("");}$j("."+c+"."+b).show();},toggleVisible:function(){for(var b=0;b<arguments.length;b++){var a=$(arguments[b]);jQuery(a).toggle();}},isParameterIgnored:function(a){return !a||$j(a).parents(".non_serializable_form_elements_container").length!=0;},isPasswordInput:function(a){return a.type==="password"||a.hasAttribute("data-imitate-password");},getPasswordInputs:function(a){return Form.getInputs(a).filter(BS.Util.isPasswordInput);},serializeForm:function(c){var g=Form.getElements(c);var h=BS.jQueryDropdown.namePrefix;g=g.filter(function(i){return !BS.Util.isPasswordInput(i)&&i.name.indexOf("prop:encrypted")==-1&&!i.name.endsWith(h)&&!BS.Util.isParameterIgnored(i);});var b,f,a=false,e;var d=g.inject({},function(j,k){var i=$j(k).data("cm");if(i!=null){i.save();}if(k.name){b=k.name;f=$(k).getValue();if(f!=null&&(k.type!="submit"||(!a&&e!==false&&(!e||b==e)&&(a=true)))){if(b in j&&b!=="tc-csrf-token"){if(!_.isArray(j[b])){j[b]=[j[b]];}j[b].push(f);}else{j[b]=f;}}}return j;});return Object.toQueryString(d);},disableFormTemp:function(e,d){var c=[];for(var b=0;b<e.elements.length;b++){var a=e.elements[b];if(!d||d(a)){this.disableInputTemp(a);c.push(a);}}BS.VisibilityHandlers.updateVisibility(e);return c;},isDisabled:function(a){return a.disabled=="disabled"||a.disabled;},disableInputTemp:function(b){b.blur();if(this.isDisabled(b)){b._wasDisabled=true;
}else{b.disabled="disabled";var a=$j(b).data("cm");if(a!=null){a.setOption("readOnly",true);}}},reenableInput:function(b){if(typeof b._wasDisabled=="undefined"){b.disabled="";var a=$j(b).data("cm");if(a!=null){a.setOption("readOnly",false);}}else{b._wasDisabled=undefined;}},reenableForm:function(d,c){if(d&&d.elements){for(var b=0;b<d.elements.length;b++){var a=d.elements[b];if(!c||c(a)){this.reenableInput(a);}}}BS.VisibilityHandlers.updateVisibility(d);},shiftToFitPage:function(b){b=$(b);if(!b||b.hasClassName("modalDialogFixed")){return;}var d=b.style.overflow;if(BS.Browser.opera){b.style.overflow="visible";}var g=BS.Util.windowSize();var e=BS.Util._scrollLeft();var h=b.positionedOffset();var f=b.getDimensions();var a=g[0]+e;var c=h[0];var i=h[0]+f.width;if(c<e){b.style.left=(10+e)+"px";}else{if(i>a&&f.width<a){b.style.left=(a-f.width-20)+"px";}else{if(f.width>=a){b.style.left="10px";}}}if(BS.Browser.opera){b.style.overflow=d;}},showHelp:function(c,b,a){Event.stop(c);var d=b.split("#");if(d.length==2){BS.Util.popupWindow(d[0]+"#"+(a.preservePlus?d[1]:d[1].replace(/\+/g,"")),"tcHelp",a);}else{BS.Util.popupWindow(b,"tcHelp",a);}},popupWindow:function(a,f,j){f=f||"_blank";j=j||{};var b=j.width||1000;var i=j.height||600;var c=j.safe!==false;var g=j.opener||window;var h=g.open(a,f,"toolbar=no,scrollbars=yes,resizable=yes,width="+b+",height="+i+(c?",noopener=yes,noreferrer=yes":""));try{h.focus();}catch(d){}return h;},hideSuccessMessages:function(){if(BS._shownMessages){for(var b in BS._shownMessages){var a=$(b);if(a&&BS._shownMessages[b]=="info"){a.style.visibility="hidden";}}BS._shownMessages={};}},addWordToTextArea:function(b,c){var a=b.value;if(a.length==0){b.value=c;}else{b.value=a+" "+c;}},processError:function(a){if(a.message){alert(a.message);}else{alert(a.toString());}},changeChildrenColor:function(e,b){var a=b.color;var f=b.backgroundColor;var d=b.filter;var g=e.childNodes;for(var c=0;c<g.length;c++){if(d&&!d(g[c])){continue;}if(g[c].style){if(a!=null){g[c].style.color=a;}if(f!=null){g[c].style.backgroundColor=f;}}}},documentRoot:function(a){if(!a.responseXML){return null;}return a.responseXML.documentElement;},trimSpaces:function(a){return a.replace(/^\s+(.*)/,"$1").replace(/(.*?)\s+$/,"$1");},makeBreakable:function(b,a){a=a?new RegExp("("+a+")","g"):/(.{60})/g;return b.replace(a,"$1<wbr/>");},formatSeconds:function(f,c){if(f<0){return"N/A";}if(f==0){return"&lt;1s";}var a="";var d=parseInt(f);if(d>=3600){var b=Math.floor(d/3600);d-=b*3600;a+=b+"h";}if(d>=60){var e=Math.floor(d/60);d-=e*60;if(a!=""){a+=":";}a+=e+"m";}if(d>0&&c){f=d;if(a!=""){a+=":";}a+=f+"s";}else{if(a==""){a="&lt;1m";}}return a;},selectAll:function(b,a){this._setChecked(b,a,true);},unselectAll:function(b,a){this._setChecked(b,a,false);},getSelectedValues:function(d,b){var a=[];var e=Form.getInputs(d,"checkbox",b);for(var c=0;c<e.length;c++){if(e[c].checked){a.push(e[c].value);}}return a;},_setChecked:function(d,a,c){var e=Form.getInputs(d,"checkbox",a);for(var b=0;b<e.length;b++){if(!e[b].disabled){e[b].checked=c;}}},descendantOf:function(b,a){while(b!=null){if(b===a){return true;}b=b.parentNode;}return false;},isDetached:function(a){if(a.id){return $(a.id)!==a;}if(a===document.documentElement||a===window||a===document){return false;}if(a.parentNode==null){return true;}return BS.Util.isDetached(a.parentNode);},runWithElement:function(a,b,c){if(!c){c=1000;}BS.WaitFor(function(){return $(a)&&!BS.Util.isDetached($(a));},b,c/1000);},setTitle:function(a){document.title=a?a+" \u2014 TeamCity":"TeamCity";},capitalize:function(a){return a.replace(/\s+(\w)/g,function(b,c){return" "+c.toUpperCase();});},fadeOutAndDelete:function(a){$j(a).fadeOut("fast",function(){$j(this).remove();});},createDelayedInvocator:function(a,b){return{_timeoutId:null,invoke:function(){if(this._timeoutId){clearTimeout(this._timeoutId);}var c=this;this._timeoutId=setTimeout(function(){c._timeoutId=null;a();},b);}};},escapeId:function(a){if(a.toString().match(/^#/)){return a;}return"#"+a.toString().replace(/(:|\.)/g,"\\$1");},getTextChildren:function(a){return $j(BS.Util.escapeId(a)).contents().filter(function(){return this.nodeType==3;});},getLineFeed:function(){return navigator.userAgent.toLowerCase().match(/windows/)?"\r\n":"\n";},isModifierKey:function(a){return a&&(a.ctrlKey||a.altKey||a.shiftKey||a.metaKey);},installPlaceHolder:function(a,b,c){a=$(a);b=b.trim();if(c){a.value=b;}if(a.value.trim()==b){a.style.color="gray";}a.on("focus",function(){if(this.value.trim()==b){this.value="";this.style.color="black";}});a.on("blur",function(){if(this.value.trim().length==0){this.value=b;this.style.color="gray";}});},paramsFromHash:function(f){var b={};var e=document.location.hash;if(e.length>1){e=e.substring(1);var g=e.split(f||"&");for(var d=0;d<g.length;d++){var a=g[d].indexOf("=");if(a==-1){continue;}var c=g[d].substring(0,a);b[c]=g[d].substring(a+1);}}return b;},removeParamFromHash:function(d,c,e){var a=BS.Util.paramsFromHash(c);var f=[];for(var b in a){if(a.hasOwnProperty(b)&&b!==d){f.push(b);f.push(a[b]);}}BS.Util.setParamsInHash(f,c,e);},setParamsInHash:function(g,e,f){var d="";for(var c=0;c<g.length;c+=2){d+=g[c]+"="+g[c+1]+e;}if(d.length>0){d=d.substring(0,d.length-1);}if(f){var b=document.location.href;var a=b.indexOf("#");if(a!=-1){b=b.substring(0,a);}b+="#"+d;document.location.replace(b);}else{document.location.hash=d;}},syncValues:function(d,e){var c=d.value;var b=e.value;var a=e.getAttribute("generated");if(b.length==0||(a!=null&&b==a)){e.value=c;e.setAttribute("generated",c);$j(e).trigger("keyup");}},_visibilityAPI:null,isPageVisible:function(){if(this._visibilityAPI==null){this._visibilityAPI=BS.PageVisibility.detect();}return !this._visibilityAPI.supported||!document[this._visibilityAPI.hiddenProperty];},escapeRegExp:function(a){return a.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");}};BS.Hider={hidingDivs:{},allDivs:{},afterHideFuncs:{},hasVisiblePopups:function(){return !$j.isEmptyObject(this.allDivs);},_currentZindex:function(){while(this._shownStack.length>0){var a=this._shownStack[this._shownStack.length-1];if($(a)){return parseInt($(a).style.zIndex,10)+5;}this._shownStack.pop();}return 10;},addHideFunction:function(c,b){if(typeof this.afterHideFuncs[c]=="function"){var a=this.afterHideFuncs[c];this.afterHideFuncs[c]=function(){b();a();};}else{this.afterHideFuncs[c]=b;}},showDivWithTimeout:function(d,a){var b=$(d);d=b.id;if(!a){a={};}if(a.hideOnMouseOut===undefined){a.hideOnMouseOut=true;}if(a.hideOnMouseClickOutside===undefined){a.hideOnMouseClickOutside=true;}if(a.draggable===undefined){a.draggable=false;}if(!_.isElement(a.dragHandle)){a.draggable=false;}var c=this._currentZindex();if(a.zIndex===undefined||a.zIndex<c){a.zIndex=c;}if(a.afterHideFunc!=undefined){this.addHideFunction(d,a.afterHideFunc);}if(!b.hasClassName("modalDialog")){b.style.position="absolute";}b.style.zIndex=""+a.zIndex;return BS.Util.show(d).then(function(){BS.Util.shiftToFitPage(d);this.allDivs[d]=d;this.stopHidingDiv(d);this._shownStack.indexOf(d)<0&&this._shownStack.push(d);this._setupHandlers(d,a);BS.VisibilityHandlers.updateVisibility(d);b._hideOnMouseClickOutside=false;if(a.hideOnMouseClickOutside){setTimeout(function(){b._hideOnMouseClickOutside=true;}.bind(this),10);}if(a.draggable&&!b._draggable){b._draggable=new Draggable(d,{starteffect:function(){},endeffect:function(){},change:function(){$j(window).off("resize.modalDialog scroll.modalDialog");},handle:a.dragHandle});}}.bind(this));},startHidingDiv:function(c,a){if(a==undefined){a=500;}c=$(c).id;this.stopHidingDiv(c,true);var b=this;this.hidingDivs[c]=setTimeout(function(){if(b.hidingDivs[c]){var d;$j("span.toggle").each(function(){if(this.getAttribute("data-popup")==c){d=this.getAttribute("data-pinned")==="true";return false;}});if(!d){b.hideDivSingle(c);}}},a);},hideDiv:function(e){var d=-1;for(var b=0;b<this._shownStack.length;b++){if(this._shownStack[b]==e){d=b;break;}}if(d!=-1){var c=this._shownStack.length-d;while(c>0){var a=this._shownStack.pop();
this.hideDivSingle(a);c--;}}if(this.afterHideFuncs[e]){this.afterHideFuncs[e]();delete this.afterHideFuncs[e];}},hideDivSingle:function(b){this.stopHidingDiv(b,true);delete this.allDivs[b];$j("span.toggle").each(function(){if(this.getAttribute("data-popup")==b){this.removeAttribute("data-pinned");this.removeAttribute("data-popup");return false;}});var a=$(b);if(a&&a._draggable){a._draggable.destroy();a._draggable=null;}Event.stopObserving(a);BS.Util.hide(a);this._runAfterHide(b);},_runAfterHide:function(a){if(this.afterHideFuncs[a]){this.afterHideFuncs[a]();delete this.afterHideFuncs[a];}},stopHidingDiv:function(d,b){var c=$(d).id;if(this.hidingDivs[c]){if(b){clearTimeout(this.hidingDivs[c]);}else{for(var a=0;a<this._shownStack.length;a++){clearTimeout(this._shownStack[a]);if(this._shownStack[a]==c){break;}}}delete this.hidingDivs[c];}},hideAll:function(b){var d=[];for(var a in this.allDivs){if(!$(a)){continue;}d.push($(a));}d.sort(function(i,h){var g=parseInt(i.style.zIndex,10);var f=parseInt(h.style.zIndex,10);return g-f;});for(var c=d.length-1;c>=0;c--){var e=d[c];if(e==b){break;}if(!e._hideOnMouseClickOutside){break;}this.hideDiv(e.id);e._hideOnMouseClickOutside=true;}$j("span.toggle").each(function(){if(b&&this.getAttribute("data-popup")==b.id){return false;}this.removeAttribute("data-pinned");this.removeAttribute("data-popup");});},_shownStack:[],_setupHandlers:function(c,a){var b=$(c);if(a.hideOnMouseOut){b.on("mouseout",function(){if(document.activeElement){if(a.overrideHideIfActive&&document.activeElement==$(a.overrideHideIfActive)){return;}}var d=BS.Hider._shownStack[BS.Hider._shownStack.length-1];if(d!=c){return;}if(typeof a.hideOnMouseOut=="function"){if(!a.hideOnMouseOut()){return;}}BS.Hider.startHidingDiv(c);});}b.on("mouseover",function(){BS.Hider.stopHidingDiv(c);});b.on("contextmenu",function(){$j("span.toggle").each(function(){if(this.getAttribute("data-popup")==c){this.setAttribute("data-pinned","true");}});});},_escapeHandler:function(a){if(this._shownStack.length!=0&&a.keyCode==Event.KEY_ESC){var b=this._shownStack[this._shownStack.length-1];BS.Hider.hideDiv(b);return false;}}};$j(document).on("click",function(d){var b=d.target;var a=null;for(var f in BS.Hider.allDivs){var c=$(f);if(!c){continue;}if(BS.Util.descendantOf(b,c)){a=c;break;}}BS.Hider.hideAll(a);});$j(document).on("keydown",BS.Hider._escapeHandler.bind(BS.Hider));BS.Navigation={items:[],siblingsNavType:null,discoverMode:function(){var a=this.items.length>0&&this.items[0].title=="Administration";var c=a&&(window.location.href.indexOf("admin/edit")>-1||window.location.href.indexOf("admin/attachBuildTypeVcsRoots"));var b=a&&window.location.href.indexOf("admin/create")>-1;return{adminPart:a,editMode:c,createMode:b};},writeCompactNavigation:function(){var e=BS.Navigation.discoverMode();var a=e.adminPart;var d=e.editMode;var b=e.createMode;$j("#restBreadcrumbs").css("display","block");if(a&&!d&&!b){$j("#restPageTitle").html(this.getTitleHtml(this.items[0])).css("display","block");}else{if(this.items.length>1){$j("#restNavigation").html(this.getCompactItemsHtml()).css("display","block");}if(b||d||!a){var c=this.items[this.items.length-1];$j("#restPageTitle").html(this.getTitleHtml(c,"",d)).css("display","block");}if(!a){var f=this.getDescriptionHtml(c);if(f!=undefined&&f>""){$j("#restPageDescription").html(f).css("display","block");}}}},writeBreadcrumbs:function(){if(this.items.length==0){return;}if($j("#restBreadcrumbs").length>0){this.writeCompactNavigation();}this._selectHeaderTabIfNeeded();$j(document).trigger("bs.navigationRendered");},getItemsHtml:function(){var a="";for(var b=0;b<this.items.length-1;b++){a+=this._writeItem(this.items[b]);}if(this.items.length>0){a+=this._writeItem(this.items[this.items.length-1],"last");}return a;},getCompactItemsHtml:function(b){var a="";var e=this.items.length-(b?1:2);if(this.items[e].title==undefined||this.items[e].title.trim().length==0){e--;}for(var c=0;c<e;c++){var d=this.items[c];if(d!=undefined&&d.title!=undefined&&d.title.length>0){a+=this._writeCompactItem(this.items[c]);}}a+=this._writeCompactItem(this.items[e],"last");return a;},getTitleHtml:function(m,b,a){var j=m.title,l=j.indexOf("<small>");var h=this._prepareAttributes(b,m);var c=h.li_classes;var d=h.li_attributes;var k=this._getIcon(m,"M");var i=(l>-1?j.substr(0,l):m.title);if(m.url){i="<a href='"+m.url+"'>"+i+"</a>";}var g=undefined;var f="";var e="contentWrapper "+(f.length>0?"triangle":"");return'<div class="'+$j.trim(c)+'"'+d+'><span class="'+e+'">'+(g!=undefined?'<span class="prefix">'+g+"</span>":"")+(k?'<span class="iWrapper">'+k+"</span>":"")+i+"</span></div>";},getDescriptionHtml:function(c){var b=c.title,a=b.indexOf("<small>");return(a>-1?b.substr(a+"<small>".length+1,b.length-("</small>".length+1)-(a+"<small>".length+1)):undefined);},_getIcon:function(a,b){var d="";if(a.siblingsTree||a.siblings){d+=" hasSiblings";}if(ReactUI){var c;if(a.projectId){c="project";}else{if(a.itemClass==="buildTypeTemplate"){c="template";}else{if(a.buildTypeId){c="buildType";}}}return c?ReactUI.createAndRenderStatic(ReactUI.ProjectOrBuildTypeIcon,{type:c,composite:a.composite,status:a.status,size:b||"S",className:"projectOrBuildTypeIcon"+d,arrowClassName:"projectOrBuildTypeIcon_arrow"}):"";}else{if(a.projectId){d="projectIcon project-icon";}else{if(a.itemClass==="buildTypeTemplate"){d="buildTypeTemplate-icon";}else{if(a.buildTypeId){d="buildTypeIcon buildType-icon";if(a.composite){d+=" buildType-icon_composite";}}}}return d?'<i class="tc-icon_before icon16 '+d+' icon_disabled"></i>':"";}},_writeItem:function(e,a){function c(){var j=$j(window).width();if(j>1600){return 120;}else{if(j>1400){return 100;}else{if(j>1200){return 80;}else{if(j>1000){return 70;}else{return 50;}}}}}function h(l,j){var k=l.substr(j);var m=$j(k).text();var n=c();if(m.length>n){if(k.indexOf("<script")>-1||k.indexOf("<a")>-1){return k;}m=BS.trimText(m,n);k="<small>"+m+"</small>";}return k;}var g=e.title,i=g.indexOf("<small>");var b=[],d=[];b.push(a);if(e.selected){b.push("selected");}if(e.itemClass){b.push(e.itemClass);}if(e.status){b.push(e.status);}var f=' class="tc-icon_after icon16 tc-icon_breadcrumb" ';if(e.url){if(i>=0){g='<a href="'+e.url+'"'+f+">"+$j.trim(e.title.substr(0,i))+"</a>"+"&nbsp;"+h(g,i);}else{g='<a href="'+e.url+'"'+f+">"+$j.trim(e.title)+"</a>";}}else{if(i>=0){g=g.substr(0,i)+h(g,i);}}if(e.projectId){d.push('data-projectId="'+e.projectId+'"');}if(e.buildTypeId){d.push('data-buildTypeId="'+e.buildTypeId+'"');}if(e.siblingsTree&&e.siblingsTree.parentId){d.push('data-parentId="'+e.siblingsTree.parentId+'"');}b=b.join(" ");d=d.join(" ");return'<li class="'+$j.trim(b)+'"'+d+'><div class="contentWrapper">'+this._getIcon(e)+g+"</div></li>";},_prepareAttributes:function(c,a){var d=[],b=[];d.push(c);if(a.selected){d.push("selected");}if(a.itemClass){d.push(a.itemClass);}if(a.projectId){b.push('data-projectId="'+a.projectId+'"');}if(a.buildTypeId){b.push('data-buildTypeId="'+a.buildTypeId+'"');}if(a.siblingsTree&&a.siblingsTree.parentId){b.push('data-parentId="'+a.siblingsTree.parentId+'"');}d=d.join(" ");b=b.join(" ");return{li_classes:d,li_attributes:b};},_writeCompactItem:function(e,a){var h=e.title,k=h.indexOf("<small>");var g=this._prepareAttributes(a,e);var b=g.li_classes;var c=g.li_attributes;var i=this._getIcon(e);var j=i?"":"noIconLink";var l=(k>-1?e.title.substr(0,k):e.title).trim();var f="";h=e.url?'<a class="'+j+'" href="'+e.url+'" >'+l+"</a>":l;var d="contentWrapper "+(f.length>0?"triangle":"");return'<li class="'+$j.trim(b)+'"'+c+'><span class="nowrap"><span class="'+d+'">'+(i?'<span class="iWrapper">'+i+"</span>":"")+h+"</span>"+(a==undefined||a.indexOf("last")==-1?"<span class='tc-icon_breadcrumb_slash'></span>":"")+"</span></li>";},_selectHeaderTabIfNeeded:function(){var b=this.items[0],a=this.items[1];if(b&&b.url&&b.url.endsWith("/admin/admin.html")&&a&&a.title==="Projects"){this.selectAdminTab();}},selectProjectsTab:function(){jQuery("#overview_Tab").addClass("selected");},selectAdminTab:function(){jQuery("#userPanel .info:nth-child(2)").addClass("selected");
},selectMySettingsTab:function(){jQuery("#userPanel .info:nth-child(1)").addClass("selected");},fromUrl:function(f,c,e,d){var b=document.location.href;var a=b.indexOf("#");if(a!=-1){b=b.substring(0,a);}if(d){b=b.replace(/tab=[^&]+&*/,"");}if(!b.include(f)&&b.include(encodeURIComponent(f))){f=encodeURIComponent(f);}if(b.include("="+f)){return b.replace("="+f,"="+(c||"{id}"));}return e?b+e:b;},installHealthItems:function(){var c=$j(".healthItemIndicatorContainer").detach();var a=$j("#restPageTitle");var b={"class":"breadcrumbHealthIndicators","append":c};$j("<div></div>",b).appendTo(a);c.show();}};BS.Highlight=function(b,a){new Effect.Highlight(b,_.extend(a||{},{startcolor:"#ffffcc",duration:1,keepBackgroundImage:true}));};BS.Logout=function(a){BS.ajaxRequest(a,{onComplete:function(b){window.localStorage.clear();BS.Cookie.clearAll();BS.XMLResponse.processRedirect(b.responseXML);}});};BS.LogoutAllSessions=function(a){BS.confirm("This will also log out the current session. \nAre you sure you want to log out of all sessions?",function(){BS.ajaxRequest(a,{onComplete:function(b){window.localStorage.clear();BS.Cookie.clearAll();BS.XMLResponse.processRedirect(b.responseXML);}});}.bind(this));};BS.XMLResponse={processModified:function(b,c){if(!c){return;}var a=c.documentElement;b.setModified(a.firstChild&&a.firstChild.nodeValue=="modified");},processRedirect:function(b){if(!b){return false;}var a=b.documentElement;var c=a.getElementsByTagName("redirect")[0];if(c&&!c.firstChild.nodeValue.startsWith("javascript:")){document.location.href=c.firstChild.nodeValue;return true;}return false;},processErrors:function(h,f,b){var j=this._getErrorNodes(h);if(!j||j.length==0){return false;}var e=false;for(var d=0;d<j.length;d++){var c=j.item(d);var a=c.getAttribute("id");var g="on"+a.charAt(0).toUpperCase()+a.substring(1)+"Error";var k=f[g]||f[a];if(k&&typeof(k)=="function"){k.apply(f,[c]);e=true;}else{if(b){b(a,c);e=true;}}}return e;},_xmlErrorsXml:function(f){var b=f.getElementsByTagName("errors");if(!b||b.length==0||b[0].getElementsByTagName("error").length==0){return[];}var g=b[0].getElementsByTagName("error");var a=[];for(var c=0;c<g.length;c++){var d=g[c];a.push([d.getAttribute("id"),d.firstChild.nodeValue]);}return a;},_getErrorNodes:function(d){if(!d){d=$j.parseXML('<response><errors><error id="emptyResponse">Unexpected empty response</error></errors></response>');}var a=d.documentElement;if(a==null){return null;}var c=a.getElementsByTagName("errors");if(!c||c.length==0){return null;}var b=c.item(0);return b.getElementsByTagName("error");}};BS.StopBuild=function(b,c,a){if(a){Form.disable(a);}BS.ajaxRequest(b+"?kill="+c,{onComplete:function(){setTimeout(function(){BS.reload(true);},3000);}});return false;};BS.TableHighlighting={createInitElementFunction:function(){var a=this;var b=function(c){c=$(c);c.on("mouseover",function(){if(typeof(BS)=="undefined"){return;}BS.Util.changeChildrenColor(this.parentNode,{color:"#254193",backgroundColor:"#ffffcc",filter:function(d){return d.nodeType==1&&d.className.indexOf("highlight")>=0;}});}.bind(c));c.on("mouseout",function(){if(typeof(BS)=="undefined"){return;}BS.Util.changeChildrenColor(this.parentNode,{color:"",backgroundColor:"",filter:function(d){return d.nodeType==1&&d.className.indexOf("highlight")>=0;}});}.bind(c));};if(!a.nodeType){return b;}else{return b(a);}}};BS.Refreshable={_poppedDialogs:{},registerPoppingOutDialog:function(b,a){if(!this._poppedDialogs[b]){BS.Refreshable._poppedDialogs[b]=[];}if(this._poppedDialogs[b].indexOf(a)===-1){this._poppedDialogs[b].push(a);}},prototypeRefreshable:function(g,h,e){var i=$j.Deferred();var a=$(this);if(!a){BS.Log.error("prototypeRefreshable called without element");i.reject();return i.promise();}var c=$j(a).attr("id");var b=$j(a).attr("data-pageurl");if(!b){b=window.location.pathname;}var f=$j(a).attr("data-passjsp");if(BS.ServerLink&&!BS.ServerLink.isConnectionAvailable()){BS.Log.info("Connection to server is not available. Refresh is not called.");i.resolve();return i.promise();}if(!h){h="";}if(g&&$(g)){BS.Util.show(g);}var d=f?"jsp="+f:"__fragmentId="+c+"Inner";BS.ajaxRequest(b,{method:"get",parameters:d+(h?"&"+h:""),onFailure:function(){BS.Log.warn("Failure while refreshing "+c);i.reject();},onComplete:function(k){var j=k.request.getStatus();var l=!j||(j>=200&&j<300);if(l){BS.Refreshable.detachReactRefreshableRoots(a);BS.stopObservingInContainers(a);BS.Refreshable.destroySortables(a);(BS.Refreshable._poppedDialogs[c]||[]).each(function(n){var m=$(n);while(m){m.remove();m=$(n);}});delete BS.Refreshable._poppedDialogs[c];a.update(k.responseText);BS.loadRetinaImages(a);BS.enableDisabled(a);BS.Util.hide(g);_.isFunction(e)&&e();}i.resolve();}});return i.promise();},createRefreshFunction:function(){return function(){BS.Log.error("This function was created by BS.createRefreshFunction which shouldn't be used any more.");};},destroySortables:function(b){if(typeof(Sortable)=="undefined"){return;}if(!_.isEmpty(Sortable.sortables)){Sortable.destroy(b);var d=b.getElementsByTagName("*"),a=d.length;for(var c=0;c<a;c++){if(Sortable.sortables[d[c].id]){Sortable.destroy(d[c]);BS.Log.debug("Destroying sortable under "+d[c].id);if(_.isEmpty(Sortable.sortables)){return;}}}}},detachReactRefreshableRoots:function(b){var a=b.querySelectorAll("[data-react-refreshable-root]");for(var d=0;d<a.length;d++){var c=a[d];ReactUI.markAsUnused(c.id);var e=c.parentNode;if(e){e.removeChild(c);}}}};HTMLDivElement.prototype.refresh=BS.Refreshable.prototypeRefreshable;HTMLDivElement.prototype.refresh_delayed=function(){if(!this._refresh_timer){this._refresh_timer=setTimeout(function(){this._refresh_timer=null;if(document.body.contains(this)){this.refresh();}}.bind(this),300);}};BS.WaitFor=function(f,e,c){if(!c){c=10;}var d=c*1000/50;var a=0;var b=function(){var g=f();if(!g&&d>a++){setTimeout(b,50);}else{e(g);}};b();};Event.observe(window,"unload",function(){BS.PeriodicalRefresh.stop();});BS.PeriodicalRefresh={start:function(a,b){if(this.executor){this.executor.stop();this.executor=null;}this.executor=BS.periodicalExecutor(function(){return BS.reload(false,function(){}).then(function(){return b();});},a*1000);if(a>0){this.executor.start();}},stop:function(){this.executor&&this.executor.stop();}};(function(a){BS.InPlaceFilter={_storedInitializers:{},applyFilter:function(d,h,g,c){var b=d instanceof a?d:a(BS.Util.escapeId(d));var f=h.value.toUpperCase();if(!c&&f==this.prevKeyword){return;}var j=this.prevKeyword!=null&&f.indexOf(this.prevKeyword)!=-1;this.prevKeyword=f;var i=b.find(".inplaceFiltered");var e=this;i.each(function(k){var l=this;if(j&&!e.isVisible(l)){return;}if(!f){e.showElement(l,k);}else{e.performSearch(l,f,k);}});this.toggleOptgroups(f,b,i);if(g){g.call(this,h);}},performSearch:function(d,c,b){var f=this.getContent(d);var e=f.indexOf(c)>-1;if(!e){this.hideElement(d,b);}else{this.showElement(d,b);}return e;},hideElement:function(c,b){if(c.tagName.toUpperCase()=="OPTION"){if(c.className.indexOf("optgroup")==-1){this.hideOption(c,b);}}else{if(c.tagName.toUpperCase()!="OPTGROUP"){BS.Util.hide(c);$j(c).data("visibleElem",false);}}},showElement:function(c,b){if(this.isHiddenOption(c)){this.showOption(c,b);}else{BS.Util.show(c);$j(c).data("visibleElem",true);}},isVisible:function(b){return b.style.display!="none";},getContent:function(e){var d=e._cachedContent;if(d!=null){return d;}d="";if(e.getAttribute("data-title")){d=e.getAttribute("data-title");}else{for(var b=0;b<e.childNodes.length;b++){var c=e.childNodes[b];if(c.nodeType==1&&c.className.indexOf("noSearch")==-1){d+=this.getContent(c);}if(c.nodeType==3){d+=c.nodeValue;}}}e._cachedContent=d.replace(/[\s]+/g," ").strip().toUpperCase();return e._cachedContent;},isHiddenOption:function(b){return b.className&&b.className.indexOf("hiddenOption")!=-1;},hideOption:function(e,b){var c=e.parentNode;if(!c._hiddenOptions){c._hiddenOptions={};}c._hiddenOptions[b]=e;var d=document.createElement("SPAN");d.className="inplaceFiltered hiddenOption";d._cachedContent=this.getContent(e);
if(e.disabled){d.disabled=true;}if(e.className.indexOf("optgroup")>-1){d.className+=" optgroup";}d.setAttribute("data-filter-data",e.getAttribute("data-filter-data"));c.insertBefore(d,e);c.removeChild(e);},showOption:function(d,b){var c=d.parentNode;if(c&&c._hiddenOptions[b]){c.insertBefore(c._hiddenOptions[b],d);c.removeChild(d);c._hiddenOptions[b]=null;}},toggleOptgroups:function(d,c,f){function b(h){var g=h.tagName.toUpperCase();return g=="OPTION"||g=="SPAN";}if(c.prop("tagName").toUpperCase()=="SELECT"){var e=this;f.each(function(i){var j=this.className;if(!j.include("optgroup")||!b(this)){return;}var h=e.getContent(this).include(d),l=this.nextSibling,k=parseInt(this.getAttribute("data-filter-data")||"0");while(l&&!h){if(l.nodeType==1&&b(l)){var g=l.getAttribute("data-filter-data");if(g){if(k>=parseInt(g)){break;}}else{if(l.disabled){break;}}h=e.isVisible(l)&&e.getContent(l).include(d);}l=l.nextSibling;}if(h){j.include("hiddenOption")&&e.showOption(this,i);}else{!j.include("hiddenOption")&&e.hideOption(this,i);}});}},prepareFilter:function(d){var c=a(BS.Util.escapeId(d));function e(j){var f=(j instanceof a)?j.attr("data-filter-data"):j.getAttribute("data-filter-data");if(!f){return"";}var k=parseInt(f);var g=[];for(var h=0;h<4*k;++h){g.push("&nbsp;");}return g.join("");}if(c.length>0&&c.prop("tagName").toUpperCase()=="SELECT"){var b=null;c.children("option").each(function(){var f=this;f.innerHTML=e(f)+f.innerHTML;if(b&&parseInt(f.getAttribute("data-filter-data")||"0")>parseInt(b.getAttribute("data-filter-data")||"0")){a(b).addClass("optgroup");}b=f;});c.children("optgroup").each(function(){var g=a(this),f=this.getElementsByTagName("option");if(f.length==0){g.remove();return;}for(var h=f.length-1;h>=0;h--){var j=f[h];g.after(j);j.innerHTML=e(j)+j.innerHTML;}j=a('<option class="inplaceFiltered optgroup" disabled="disabled">'+e(g)+g.attr("label").escapeHTML()+"</option>");j.attr("data-filter-data",g.attr("data-filter-data"));g.replaceWith(j);});}},storeInitFunction:function(c,b){this._storedInitializers[c]=b;},getStoredInitFunction:function(c){var b=this._storedInitializers[c];this._storedInitializers[c]=null;return b;}};a.fn.inplaceFilter=function(c,e){var d=this;var b=a(BS.Util.escapeId(c));d.on("keyup",_.throttle(function(){BS.InPlaceFilter.applyFilter(b,d.get(0),e);},100));};})(jQuery);BS.VisibilityHandlers={_emptyHandler:{updateVisibility:function(){}},_handlers:{},attachTo:function(d,a){var b=$(d).id;var c=this._handlers[b];if(c==null){c=[];this._handlers[b]=c;}c.push(a);},detachFrom:function(a){this._handlers[a]=null;},_visibilityHandler:function(a){if(!a||!a.id){return this._emptyHandler;}var b=this._handlers[a.id];if(b==null){return this._emptyHandler;}return{updateVisibility:function(){for(var c=0;c<b.length;c++){b[c].updateVisibility();}}};},_collectElements:function(b){var a=[];var d;if(b==null){return a;}if(b.id){a.push(b);}if(b.id=="mainContent"){for(d in this._handlers){if(!this._handlers.hasOwnProperty(d)){continue;}a.push($(d));}}else{for(d in this._handlers){if(!this._handlers.hasOwnProperty(d)){continue;}var c=$(d);if(BS.Util.descendantOf(c,b)){a.push(c);}}}return a;},updateVisibility:function(c){if(c==null){return;}var a=this._collectElements($(c));for(var b=0;b<a.length;b++){this._visibilityHandler(a[b]).updateVisibility();}}};BS.User={setProperty:function(b,c,a){this._setProperty(b,c,a,"setUserProperty");},deleteProperty:function(b,a){this._beforeChange(a);BS.ajaxRequest(window["base_uri"]+"/ajax.html",{parameters:"deleteUserProperty="+b,onComplete:function(){BS.User._afterChange(a);}});},setBooleanProperty:function(b,c,a){if(c){this.setProperty(b,c,a);}else{this.deleteProperty(b,a);}},setSessionProperty:function(b,c,a){this._setProperty(b,c,a,"setSessionProperty");},_setProperty:function(c,d,b,a){if(!b){b={};}this._beforeChange(b);BS.ajaxRequest(window["base_uri"]+"/ajax.html",{parameters:a+"="+c+"&value="+d,onComplete:function(){BS.User._afterChange(b);}});},_beforeChange:function(a){if(a&&a.progress){BS.Util.show(a.progress);}},_afterChange:function(a){a=a||{};if(a.afterComplete){a.afterComplete();}if(a.progress){BS.Util.hide(a.progress);}}};BS.DelayedAction=function(a,c,b){if(!b){b=300;}this.delay=b;this.action=a;this.stop_action=c;};BS.DelayedAction.prototype.start=function(){this.timeout=setTimeout(this.action,this.delay);};BS.DelayedAction.prototype.stop=function(){clearTimeout(this.timeout);this.stop_action.call(this);};BS.DelayedShow=function(a){BS.DelayedAction.call(this,function(){if($(a)){$(a).show();}},function(){if($(a)){$(a).hide();}});};BS.DelayedShow.prototype=new BS.DelayedAction();BS.DelayedShow.prototype.show=BS.DelayedShow.prototype.start;BS.DelayedShow.prototype.hide=BS.DelayedShow.prototype.stop;Ajax.Responders.register({onException:function(a,b){BS.Log.error(b);}});BS.jQueryDropdown=function(a,d){var g=jQuery(a);var i=g.attr("id");if($(BS.jQueryDropdown.namePrefix+i)){try{jQuery($(i)).ufd("destroy");}catch(h){BS.Log.warn(h);}}var c=g.get(0);var b=c.name;i=c.id;var f="ufd";if(g.attr("class")){f+=" "+g.attr("class");}g.ufd(jQuery.extend(true,d||{},{css:{button:BS.jQueryDropdown.namePrefix+(b?b:i),wrapper:f},calculateZIndex:true,zIndexPopup:BS.Hider._currentZindex()}));return g;};BS.enableJQueryDropDownFilter=function(a,b){BS.jQueryDropdown($(a),b);$(a).setSelected=function(c,d){$(a).selectedIndex=c;d?$j($(a)).ufd("setInputFromMaster"):BS.jQueryDropdown($(a)).ufd("changeOptions");};$(a).setSelectValue=function(g,f){var d=0;var c=$(a);for(var e=0;e<c.options.length;e++){if(c.options[e].value==g){d=e;break;}}c.setSelected(d,f);};};BS.jQueryDropdown.namePrefix="-ufd-teamcity-ui-";BS.jQueryDropdown.setJQueryOptions=function(a){if(a.ui&&a.ui.ufd){a.ui.ufd.defaults.skin="default";a.ui.ufd.defaults.prefix=BS.jQueryDropdown.namePrefix;a.ui.ufd.prototype.options=a.ui.ufd.defaults;}};BS.jQueryDropdown.setJQueryOptions(jQuery);BS.deleteRedundantOptions=function(a){$j("option.user-delete",a||"select").remove();};BS.openUrl=function(b,a){if(Event.element(b)&&Event.element(b).tagName.toUpperCase()=="A"){return true;}else{if(Event.isLeftClick(b)){if(b.ctrlKey||b.metaKey){window.open(a);}else{document.location.href=a;}}else{if(Event.isMiddleClick(b)){window.open(a);}else{if(!Event.isRightClick(b)){document.location.href=a;}}}}return false;};BS.goBack=function(c,a){var b=window.location.protocol+"//"+window.location.host;BS.openUrl(c,b+a);return false;};BS.fixCancel=function(){$j(function(){$j(".btn.cancel").each(function(){var b=$j(this),a=b.attr("href");if(a&&a!="#"){b.attr("href",BS.ensureLocalUrl(a));}});});};BS.ensureLocalUrl=function(b){if(!b||b=="#"){return b;}var a=window.location.protocol+"//"+window.location.host;if(b.startsWith(a)){return b;}try{var c=new URL(b);c.protocol=window.location.protocol;c.host=window.location.host;return c.href;}catch(d){if(b.startsWith("/")){return a+b;}else{return a+"/"+b;}}};BS.LoadStyleSheetDynamically=function(a,g){var c=document.getElementsByTagName("head")[0];var f=null;var b;$j('link[type="text/css"], style').each(function(){if(this.tagName.toLowerCase()=="link"&&this.href==a||this.getAttribute("data-href")==a){f=this;return false;}});var d;var e=function(h,i){if(h.getAttribute("data-loaded")){clearInterval(d);i();}};if(!g){if(f){return;}b=document.createElement("link");b.type="text/css";b.rel="stylesheet";b.title="dynamicLoadedSheet";b.href=a;c.appendChild(b);}else{if(!f){b=document.createElement("style");b.type="text/css";b.setAttribute("data-href",a);c.appendChild(b);$j.get(a,function(h){b.textContent=h;b.setAttribute("data-loaded",true);g();});}else{if(f.tagName.toLowerCase()=="style"){d=setInterval(function(){e(f,g);},50);}else{g();}}}};BS.loadRetinaImages=function(a){if(Retina.isRetina()){jQuery(a).find("img").each(function(){if(!this.hasAttribute("data-no-retina")){if(this.src.indexOf("/empty.png")<0){new RetinaImage(this);}}});}};BS.updateRetinaImage=function(a){if(Retina.isRetina()&&!a.hasAttribute("data-no-retina")){new RetinaImage(a);}};(function(){var e=navigator.userAgent.toLowerCase(),c=/(chrome)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e)||e.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(e)||[],a=c[1]||"",d=c[2]||0;
BS.Browser={version:d,mozilla:a==="mozilla",opera:a==="opera",webkit:a==="chrome"||a==="webkit",windows:navigator.platform.indexOf("Win")!=-1};})();BS.stopPropagation=function(a){a.stopPropagation();};(function(a){BS.MultiSelect={init:function(d,e){var c=a(d);if(!c.length){return;}c.find("input").each(function(){var f=a(this);if(f.hasClass("group")){f.on("change",function(g){var h=f.parent().parent(),k=parseInt(h.attr("data-depth")||"0"),i=this.checked;var j=h.attr("data-disable-children");h.nextAll().each(function(l,n){n=a(n);var o=parseInt(n.attr("data-depth")||"0");if(o>k){var m=a(n).data("visibleElem");if(typeof m==="undefined"||m){n.find("input").prop("checked",i);if(j){n.find("input").prop("disabled",i);}}return true;}else{return false;}});e&&e(g);});}else{f.on("change",function(g){e&&e(g);});}});var b=[];c.find(".inplaceFiltered").each(function(){var f=a(this);var i=parseInt(f.attr("data-depth"));if(!b.length){b.push(f);return;}while(b.length){var h=b[b.length-1];var g=parseInt(h.attr("data-depth"));if(g==i){f.data("parent",h.data("parent"));b[b.length-1]=f;break;}else{if(i>g){f.data("parent",h);b.push(f);break;}else{b.pop();}}}});},update:function(c,b){if(!b.value){return;}a(c).find(".inplaceFiltered:visible").each(function(){var d=a(this);var g=parseInt(d.attr("data-depth"));var f=d;while(g>0){g--;var e=f.data("parent");if(!e){e=f.prevAll(".user-depth-"+g+":first");f.data("parent",e);}e.show().data("visibleElem",true);f=e;}});}};})(jQuery);function fixErrorMessage(a){return a.escapeHTML().replace(/(\w{40})/g,"$1<wbr>");}BS.ScrollUtil={win:$j(window),doc:$j(document),body:function(){return $j("#bodyWrapper");},getVerticalScroll:function(){return this.win.scrollTop();},getHorizontalScroll:function(){return this.win.scrollLeft();},getContentHeight:function(){return this.body().height();},getWindowHeight:function(){return this.win.height();},isScrollAtBottom:function(c){var b=this.getContentHeight();var a=this.getVerticalScroll();var d=this.getWindowHeight();if(c==undefined){c=20;}return Math.abs(d+a-b)<c;},scrollToBottom:function(){this.win.scrollTop(this.getContentHeight());}};BS.expandMultiSelect=function(a){a.css("height","");a.attr("size",a.children("option").length);if(a.get(0).scrollHeight&&a.get(0).scrollHeight>a.height()){a.height(a.get(0).scrollHeight);}};BS.enableDisabled=function(a){$j(a||document).find(".js_to-enable").prop("disabled",false);};BS.confirm=function(b,a,c){if(BS.internalProperty("teamcity.ui.customConfirm",false)&&BS.confirmDialog){BS.confirmDialog.show({text:b,action:a,cancelAction:c});}else{if(confirm(b)){a();}else{if(c){c();}}}};BS.nextFrame=function(a){return function(){var b=arguments;var c=this;window.requestAnimationFrame(function(){a.apply(c,b);});};};BS.CSRF.initPeriodicalCsrfRefresh();
/*---
/js/bs/cookie.js
---*/
BS.Cookie={};BS.Cookie.set=function(a,d,c,f){var e=a+"="+encodeURIComponent(d);if(c!=null){var b=new Date();b.setTime(new Date().getTime()+1000*60*60*24*c);e+="; EXPIRES="+b.toGMTString();}if(f==null){f="/";}e+="; PATH="+f;document.cookie=e;};BS.Cookie.get=function(c){var d=document.cookie;var a=null;if(d){var e=d.indexOf(c+"=");if(e>=0){e+=c.length+1;var b=d.indexOf(";",e);if(b<0){b=d.length;}a=decodeURIComponent(d.substring(e,b));}}return a;};BS.Cookie.remove=function(a){this.set(a,"Deleted",-1);};BS.Cookie.clearAll=function(){document.cookie.split(";").map(function(b){var a=b.split("=");this.remove(a[0]);}.bind(this));};
/*---
/js/bs/resize.js
---*/
(function(d){var e=[800,1000,1200];var c;var b=function(){c=c&&c.length>0?c:d(document).find("body");if(c.length==0){return;}var g=c.get(0).className.split(" ");var f=c.width();d.each(e,function(h,j){g=_.without(g,"lt"+j);g=_.without(g,"gt"+j);if(f<j){g.push("lt"+j);}else{g.push("gt"+j);}});c.attr("class",_.compact(g).join(" "));};var a=_.throttle(b,500);d(document).ready(b);Event.observe(window,"resize",a);Event.observe(window,"unload",function(){Event.stopObserving(window,"resize",a);});})(jQuery);
/*---
/js/bs/position.js
---*/
BS.getPosition=function(c){c=$(c);var k=c.ownerDocument;var e=BS.Browser.mozilla&&k.getBoxObjectFor&&c.getStyle("position")=="absolute"&&(c.style.top==""||c.style.left=="");var i=[];var l=null;var f;var j=document.viewport.getScrollOffsets();var g=document.documentElement||document.body;if(c.getBoundingClientRect){f=c.getBoundingClientRect();var b=j.top;var d=j.left;i.x=f.left+d;i.y=f.top+b;}else{if(k.getBoxObjectFor&&!e){f=k.getBoxObjectFor(c);var a=k.getBoxObjectFor(g);i.x=f.screenX-a.screenX;i.y=f.screenY-a.screenY;}else{i.x=c.offsetLeft;i.y=c.offsetTop;l=c.offsetParent;if(l!=c){while(l){i.x+=l.offsetLeft;i.y+=l.offsetTop;l=l.offsetParent;}}if(BS.Browser.opera||(BS.Browser.webkit&&c.getStyle("position")=="absolute")){i.y-=k.body.offsetTop;}l=c.offsetParent;while(l&&l!=k.body){i.x-=l.scrollLeft;if(!BS.Browser.opera||l.tagName!="TR"){i.y-=l.scrollTop;}l=l.offsetParent;}}}var h=[i.x,i.y];h.left=i.x;h.top=i.y;return h;};
/*---
/js/bs/refresh.js
---*/
(function(){function b(){var d=document.location;return BS.Crypto.hex_md5((d.href.substring(d.href.lastIndexOf("/")+1)+d.search).replace(/[?=&\.]/g,""));}function c(){var e=$j(window).scrollTop();var d="sp"+b();if(e>0){BS.Cookie.set(d,e,1/24);}else{BS.Cookie.remove(d);}}function a(){setTimeout(function(){var d=BS.Cookie.get("sp"+b());if(d!=null){window.scrollTo(0,d);}},20);}window.rememberScrolling=c;window.restoreScrolling=a;})();
/*---
/js/bs/tabs.js
---*/
function TabbedPane(a){this.level=a;this.myTabs=[];}_.extend(TabbedPane.prototype,{dispose:function(){if(this.container){BS.stopObservingInContainers(this.container);}},getContainer:function(){return this.container;},clearTabs:function(){this.myTabs=[];},getNumberOfTabs:function(){return this.myTabs.length;},addTab:function(b,a){var c=new TabbedPane.Tab(this,b,a);this.myTabs.push(c);this.myTabs[this._makeId(b)]=c;},getTabs:function(){return this.myTabs;},_makeId:function(a){return"id:"+a;},setFirstActive:function(){this.setActiveTab(this.myTabs[0].getId());},setActiveTab:function(a){this.setActiveCaption(a);var b=this.myTabs[this._makeId(a)];if(b){b.activate();return true;}},gotoTextTab:function(a){for(var b=0;b<this.myTabs.length;b++){var d=this.myTabs[b];if(d.isSelected()){var c=b+a;if(c>=0&&c<this.myTabs.length){this.setActiveTab(this.myTabs[c].getId());return;}}}},setActiveCaption:function(a){for(var b=0;b<this.myTabs.length;b++){var c=this.myTabs[b];c.setSelected(c.getId()==a);}},getActiveTab:function(){for(var a=0;a<this.myTabs.length;a++){var b=this.myTabs[a];if(b.isSelected()){return b;}}return null;},getTab:function(a){return this.myTabs[this._makeId(a)];},showIn:function(a,f){a=$(a);try{if(!a){BS.Log.warn("Unable to show tabbed pane in "+a);return;}this.dispose();this.container=a;BS.stopObservingInContainers(a);if(this.myTabs.length==0){a.menuFilled=true;return;}var l=document.createElement("ul");l.className="tabs";for(var g=0;g<this.myTabs.length;g++){var q=document.createElement("li");var h=(g==0);var o=(g==this.myTabs.length-1);var c=this.myTabs[g];c.fillTabContent(q);l.appendChild(q);if(h){$(q).addClassName("first");}if(o){$(q).addClassName("last");}}a.style.display="block";a.innerHTML="";a.appendChild(l);a.menuFilled=true;if(f!=undefined&&this._hiddenTabsSelector().length){var m=f.propertyKey;var n=f.showLinkHtml;var d=f.hideLinkHtml;var p=n;if(f.showAllByDefault){p=d;}var r=document.createElement("li");r.className="showMoreToggle";r.innerHTML='<div><a href="javascript://" showdiscardchangesmessage="false" '+(f.showAllByDefault?'class="hideToggle">':">")+p+"</a></div>";l.appendChild(r);var b=this.container.id;var j=this;$j("li.showMoreToggle").off("click").on("click",function(){var e=j._hiddenTabsSelector().is(":visible");BS.User.setBooleanProperty(m,!e,{afterComplete:function(){j._hiddenTabsSelector().toggle();if(!e){$j("#"+b+" li.showMoreToggle a").addClass("hideToggle").html(d);}else{$j("#"+b+" li.showMoreToggle a").removeClass("hideToggle").html(n);}}});});if(!f.showAllByDefault){this._hiddenTabsSelector().hide();}}$j(document).trigger("bs.breadcrumbRendered");}catch(k){BS.Log.error(k);alert(k);}},_hiddenTabsSelector:function(){return $j("#"+this.container.id+" li.noCounter:not(.first,.selected,.alwaysVisible)");},showSidebarIn:function(a){this.showIn(a);}});TabbedPane.Tab=function(c,b,a){this.myPane=c;this.myTabId=b;this.myOptions=_.extend({postLink:""},a||{});this.eventHandlerBound=false;};_.extend(TabbedPane.Tab.prototype,{activate:function(){if(!this.myOptions.onselect||this.myOptions.onselect(this)){var a=$j($(this.myElement)).find("a.tabs").attr("href");if(a&&a!="#"){document.location.href=a;}else{if(this.myOptions.url){document.location.href=this.myOptions.url;}}}},setSelected:function(b,a){this.mySelected=b;a=a?$(a):$(this.myElement);if(a){if(b){a.addClassName("selected");}else{a.removeClassName("selected");}}},isSelected:function(){return this.mySelected;},getId:function(){return this.myTabId;},getDomId:function(){return this.myTabId+"_Tab";},fillTabContent:function(a){a.setAttribute("id",this.getDomId());this.myElement=a.id;this.fillWithText(a);if(this.myOptions.width){a.style.width=this.myOptions.width;}if(this.myOptions.alwaysVisible){$(a).addClassName("alwaysVisible");}this.setSelected(this.mySelected,a);},fillWithText:function(e){var g="",b="";if(this.myOptions.caption){g=this.myOptions.caption;}if(this.myOptions.captionFrom&&$(this.myOptions.captionFrom)){g=$(this.myOptions.captionFrom).innerHTML;}if(this.myOptions.captionAddin){b=this.myOptions.captionAddin;}g=jQuery.trim(g);var c=false;var f=this.extractCount(g);if(f&&f.text){var d="tabCounter";if(f.text.indexOf("!")!=-1){c=true;f.text=f.text.replace("!","");}g=jQuery.trim(g.substring(0,f.pos-1));b+='<span class="'+d+'">'+f.text+"</span>";}else{e.addClassName("noCounter");}var a="#";if(this.myOptions.url){a=this.myOptions.url;}this.bindEventHandler(e);e.innerHTML="<p>"+(c?'<i class="tc-icon icon16 tc-icon_attention tc-icon_attention_yellow"></i>':"")+'<a class="tabs" showdiscardchangesmessage="false" href="'+a+'">'+g+"</a>"+b+this.myOptions.postLink+"</p>";this.setSelected(this.mySelected);},extractCount:function(d){var a=/\(([\d\+\!]+)\)$/;var c=d.match(a);if(!c){return;}var e=d.indexOf(c[0]);var b=c[1].toString();if(b==="+"||b==="+!"){b=b.replace("+","&#x2713;");}return{text:b,pos:e};},bindEventHandler:function(a){if(a.hasHandler){return;}if(!this.eventHandlerBound){this.eventHandlerBound=function(b){if(!b.ctrlKey&&!b.altKey&&!b.metaKey&&!b.shiftKey&&b.button===0){this.myPane.setActiveTab(this.getId());Event.stop(b);}return true;}.bindAsEventListener(this);}$(a).on("click",this.eventHandlerBound);a.hasHandler=true;},setCaption:function(b){this.myOptions.caption=b;var c=this.getDomId();var a=document.getElementById(c);if(a!=null){this.fillTabContent(a);}else{BS.Log.warn("Can't find element with id \""+c+'"');}},setPostLinkContent:function(a){this.myOptions.postLink=a;},extractCountForElements:function(a){var b=this;jQuery(a).each(function(){var c=jQuery(this),e=c.text();var d=b.extractCount(e);if(d&&d.text){e=jQuery.trim(e.substring(0,d.pos-1));c.html(e).append('<span class="tabCounter">'+d.text+"</span>");}});}});
/*---
/js/bs/forms.js
---*/
BS.AbstractWebForm={formElement:function(){return document.forms[0];},disable:function(a){if(this._formDisabled){return;}var b=BS.Util.disableFormTemp(this.formElement(),a);this._formDisabled=true;return b;},enable:function(a){if(this._formDisabled){BS.Util.reenableForm(this.formElement(),a);}var b=this._modifiedMessageForm();if(b){BS.Util.reenableForm(b);}this._formDisabled=false;},savingIndicator:function(){return $("saving");},setSaving:function(b){var a=this.savingIndicator();if(a){if(!this.progress_saving){this.progress_saving=new BS.DelayedShow(a);}if(b){this.progress_saving.start();}else{this.progress_saving.stop();}}},clearErrors:function(){var a=this;$j("#errorMessage").html("&nbsp;").hide();$j(".errorField").removeClass("errorField");$j(".error").each(function(){a.clearTextInsideElement(this);});BS.VisibilityHandlers.updateVisibility(this.formElement());},trimSpacesInTextFields:function(){var a=Form.getInputs(this.formElement(),"text");for(var b=0;b<a.length;b++){a[b].value=BS.Util.trimSpaces(a[b].value);}},serializeParameters:function(){return BS.Util.serializeForm(this.formElement());},_modifiedMessageForm:function(){return $("modifiedMessageForm");},setModified:function(b){if(b){BS.Util.show("modifiedMessage");this.hideSuccessMessages();var a=this._modifiedMessageForm();if(a){if(this._modifiedHandlers&&this._modifiedHandlers.saveState){a.style.display="inline";}else{BS.Util.hide("modifiedMessage");}}}else{BS.Util.hide("modifiedMessage");}this.modified=b;this.onModifiedChange();},onModifiedChange:function(){},hideSuccessMessages:function(){BS.Util.hideSuccessMessages();},clearTextInsideElement:function(a){if(!a||!a.firstChild){return;}a.normalize();if(!a.firstChild||!a.firstChild.nodeType==3){return;}a.firstChild.nodeValue="";},highlightErrorField:function(a){$(a).addClassName("errorField");if(BS.MultilineProperties){BS.MultilineProperties.updateVisible();}},focusFirstErrorField:function(){$j(".errorField").each(function(){if(BS.Util.visible(this)){this.focus();return false;}});},_clearStateChangeHandler:function(){if(!this._stateChangeHandlerInfo){return;}Event.stopObserving(this._stateChangeHandlerInfo._object,"keyup",this._stateChangeHandler);Event.stopObserving(this._stateChangeHandlerInfo._object,"click",this._stateChangeHandler);Event.stopObserving(this._stateChangeHandlerInfo._object,"paste",this._stateChangeHandler);this._stateChangeHandlerInfo=null;this._stateChangeHandler=null;},_setupStateChangeHandler:function(b,a){this._clearStateChangeHandler();if(a==undefined){a=1000;}var c=this;this._stateChangeHandlerInfo={_lastCallTimestamp:null,_object:c.formElement(),_func:b};this._stateChangeHandler=function(e){if(!c._stateChangeHandlerInfo){return;}if(!e.type||!e.target||$j(e.target).is("input:submit")){return;}if(c._stateChangeHandlerInfo._timeout){clearTimeout(c._stateChangeHandlerInfo._timeout);}var f=function(){if(c._stateChangeHandlerInfo){c._stateChangeHandlerInfo._func();c._stateChangeHandlerInfo._lastCallTimestamp=new Date().getTime();}};var d=function(){c._stateChangeHandlerInfo._timeout=setTimeout(function(){f();},a);};if(e.type==="paste"){d();}else{if(c._stateChangeHandlerInfo._lastCallTimestamp===null||new Date().getTime()-c._stateChangeHandlerInfo._lastCallTimestamp>a){f();}else{d();}}}.bindAsEventListener(this);$(this.formElement()).observe("keyup",this._stateChangeHandler);$(this.formElement()).observe("click",this._stateChangeHandler);$(this.formElement()).observe("paste",this._stateChangeHandler);$(this.formElement()).observe("change",this._stateChangeHandler);},_setupExitHandler:function(){this._exitHandler=function(a){if(this.modified){if(!this._shouldCheckForExit(a)){return;}if(!Event.isLeftClick(a)||a.ctrlKey||a.altKey||a.shiftKey||a.metaKey){return;}if(!confirm("Discard your changes?")){Event.stop(a);}}}.bindAsEventListener(this);$j(document.body).on("click",this._exitHandler);},_shouldCheckForExit:function(b){var a=Event.element(b);if("true"==a.getAttribute("showdiscardchangesmessage")){return true;}if(a.tagName!="A"){a=Event.findElement(b,"A");}if(!a||a.nodeType!=1){return false;}if("false"==a.getAttribute("showdiscardchangesmessage")){return false;}return a&&a.href&&a.href!="#"&&a.href!=document.location.href+"#";},setUpdateStateHandlers:function(a){_.once(this.doSetUpdateStateHandlers(a));},doSetUpdateStateHandlers:function(a){this._modifiedHandlers=a;this._setupStateChangeHandler(a.updateState);if(a.saveState){var b=this._modifiedMessageForm();if(b&&b.save){$j(b.save).on("click",a.saveState);}this.bindCtrlEnterHandler(a.saveState.bind(this));}this._setupExitHandler();},checkStateModified:function(){if(this._stateChangeHandler){this._stateChangeHandler();}},removeUpdateStateHandlers:function(){this._clearStateChangeHandler();if(this._modifiedHandlers&&this._modifiedHandlers.saveState){var a=this._modifiedMessageForm();if(a&&a.save){$j(a.save).off("click");}}$j(document.body).off("click");this._modifiedHandlers=null;this._exitHandler=null;},bindCtrlEnterHandler:function(a){var b=function(){this._ctrlEnterHandler=function(c){if(c.ctrlKey&&c.keyCode==Event.KEY_RETURN){a&&a();}}.bindAsEventListener(this);$j(document).off("keydown.formCtrlEnter").on("keydown.formCtrlEnter",this._ctrlEnterHandler);}.bind(this);b.defer();},setReadOnly:function(e){this.templateBased=true;this._formDisabled=false;var a={};var c={};if(e!=null){for(var d=0;d<e.length;d++){var h=e[d].className;var b=e[d].name;if(h!=null){a[h]=true;}if(b!=null){c[b]=true;c[BS.jQueryDropdown.namePrefix+b]=true;c[b+BS.jQueryDropdown.namePrefix]=true;a[BS.jQueryDropdown.namePrefix+b]=true;a[b+BS.jQueryDropdown.namePrefix]=true;}}}var g=function(l){if(c[l.name]){return false;}var k=l.className.split(" ");for(var j=0;j<k.length;j++){if(a[BS.Util.trimSpaces(k[j])]){return false;}}return true;};var f=this.disable(g);for(d=0;d<f.length;d++){f[d]._inherited=true;}this.removeUpdateStateHandlers();}};BS.SimpleListener={onBeginSave:function(a){},onCompleteSave:function(b,d,a,c){},onException:function(a,b){BS.Util.processError(b);a.setSaving(false);a.enable();},onFailure:function(b,d){if(d&&d.status&&d.responseText){var a="Error accessing server. Check for proxy and server errors.\nHTTP status: "+d.status+"\nResponse text: "+d.responseText;BS.Log.error(a);if(d.status==503){a="The server is in a maintenance mode";var c=d.responseText.match(/\[Stage description: ([^\]]+)]/);if(c){a+=":\n "+c[1];}}alert(a);}else{BS.Log.error(d);alert("Error accessing server. Check for proxy and server errors.");}},onRequestCancelled:function(a){}};BS.ErrorsAwareListener=OO.extend(BS.SimpleListener,{onBeginSave:function(a){a.trimSpacesInTextFields();a.clearErrors();a.hideSuccessMessages();a.disable();a.setSaving(true);},onCompleteSave:function(b,c,a){var d=$j(".advancedSetting .errorField");if(d.length>0){d.parents().each(function(){if(this._advancedOptions){this._advancedOptions.showAdvanced(true,false);}});}b.setSaving(false);b.enable();if(a){b.focusFirstErrorField();}else{this.onSuccessfulSave(c);}},onSuccessfulSave:function(a){}});BS.StoreInSessionListener=OO.extend(BS.SimpleListener,{onCompleteSave:function(b,c,a){if(!a){BS.XMLResponse.processModified(b,c);}},onException:function(a,b){},onFailure:function(a){}});BS.AbstractPasswordForm=OO.extend(BS.AbstractWebForm,{publicKey:function(){return $F("publicKey");},serializeParameters:function(){var e=BS.AbstractWebForm.serializeParameters.bind(this)();var f=BS.Util.getPasswordInputs(this.formElement());if(!f){return e;}for(var c=0;c<f.length;c++){if(BS.Util.isParameterIgnored(f[c])){continue;}var b=f[c].name;var a="encrypted"+b.charAt(0).toUpperCase()+b.substring(1);e+="&"+a+"=";if(f[c].value.length==0){continue;}var d="";if(f[c].getEncryptedPassword!=null){d=f[c].getEncryptedPassword(this.publicKey());}else{d=BS.Encrypt.encryptData(f[c].value,this.publicKey());}e+=d;}return e;}});BS.FormSaver={save:function(b,g,c,a){try{c.onBeginSave(b);var f=b.serializeParameters();if(a){alert(f);}BS.ajaxRequest(g,{method:"post",parameters:f,onComplete:function(i){if(a){alert(i.responseText);
}if(i.status===0){c.onRequestCancelled(b);}else{if(!i.responseXML){c.onCompleteSave(b,null,null,i.responseText);}else{var h=i.responseXML;var e=BS.XMLResponse.processErrors(h,c);c.onCompleteSave(b,h,e,i.responseText);}}},onFailure:function(e){c.onFailure(b,e.transport);},onException:function(i,h){c.onException(b,h);},onUnexpectedError:function(h,i){c.onUnexpectedError(b,h,i);}});}catch(d){c.onException(b,d);}}};BS.PasswordFormSaver=OO.extend(BS.FormSaver,{save:function(c,e,d,a){var b=this;if(!d.onPublicKeyExpiredError){d.onPublicKeyExpiredError=function(f){$("publicKey").value=f.firstChild.nodeValue;setTimeout(function(){b.save(c,e,d,a);},100);};}BS.FormSaver.save(c,e,d,a);}});if(!BS.CustomCheckbox){$j(document).ready(function(){new BS.CustomCheckbox();});}BS.CustomCheckbox=Class.create({initialize:function(){var b=$j(document);var a=this;b.find(".custom-checkbox_input").each(function(){if(this.disabled){$j(this).parent().addClass("custom-checkbox_disabled");}a.update_state(this);});b.on("change",".custom-checkbox",function(){var e=$j(this);if(e.hasClass("custom-checkbox_disabled")){return false;}var c=e.find(".custom-checkbox_input"),d=c.prop("checked");e.toggleClass("custom-checkbox_checked custom-checkbox_focused",d);});this.install_shift_click_interval_selection();},update_state:function(a){if(a.checked){$j(a).parent().addClass("custom-checkbox_checked");}else{$j(a).parent().removeClass("custom-checkbox_checked");}},install_shift_click_interval_selection:function(){var c=$j(document);var b=this;var a=null;c.on("click",".custom-checkbox",function(g){var h=$j(this);if(h.hasClass("custom-checkbox_disabled")){return false;}if(g.shiftKey&&a&&a!==this){var f=this.closest(".group-div");var e=a.closest(".group-div");if(f===e){var i=Array.prototype.slice.call(f.querySelectorAll(".custom-checkbox"));var d=false;i.forEach(function(j){if(j==h[0]||j==a){d=!d;}else{if(d){var k=$(j).down(".custom-checkbox_input");k.checked=!k.checked;b.update_state(k);}}});}}a=h[0];});}});
/*---
/js/bs/basePopup.js
---*/
BS.Popup=Class.create({initialize:function(a,b){this._name=a;b=b||{};var c=b.shift||{};delete b.shift;this.options=_.extend({delay:300,hideDelay:600,width:null,shift:{x:-200,y:15},hasTriangle:false,loadingText:"Loading...",fitWithinWindowHeight:false,fitWithinWindowBottomMargin:0,fitWithinWindowTopMargin:5,doScroll:true,forceReload:false,innerText:null,innerHTML:null,url:null,parameters:null,textProvider:null,htmlProvider:null,method:"get",afterShowFunc:function(d){},afterHideFunc:function(){}},b);_.extend(this.options.shift,c);this._timer=null;}},{element:function(){return $(this._name);},container:function(){return BS.Popup.container||document.body;},showPopup:function(c,d){_.extend(this.options,d||{});var b=Event.element(c);if(!this.options.forceReload&&this.isShown()&&this.isLoaded()&&b.getAttribute("data-popup")==this._name){BS.Hider.stopHidingDiv(this._name);return;}var a=Event.pointerX(c)+this.options.shift.x;var f=Event.pointerY(c)+this.options.shift.y;var e=function(){b.setAttribute("data-popup",this._name);}.bind(this);this._showWithDelay(a,f,e);return this;},showPopupNearElement:function(b,f){var j=f||{};_.extend(this.options,j,{shift:_.extend(this.options.shift,j.shift)});b=$j($(b));if(!this.options.forceReload&&this.isShown()&&this.isLoaded()&&b.attr("data-popup")==this._name){BS.Hider.stopHidingDiv(this._name);return;}var a=this.options.shift;var i=a.dx!=null?b.width()+a.dx:a.x;var g=a.dy!=null?b.height()+a.dy:a.y;var e=b.offset();var h=e.left+i;var d=e.top+g;var c=function(){b.attr("data-popup",this._name);}.bind(this);this._showWithDelay(h,d,c);return this;},isLoaded:function(){return this._loaded===undefined||this._loaded;},hidePopup:function(a,b){this._clearPopupTimer();if(a===undefined){a=this.options.hideDelay;}if(this.isShown()&&(this.isLoaded()||b)){if(a>0){BS.Hider.startHidingDiv(this._name,a);}else{BS.Hider.stopHidingDiv(this._name);BS.Hider.hideDivSingle(this._name);}}},stopHidingPopup:function(){if(this.isShown()){BS.Hider.stopHidingDiv(this._name);}},isShown:function(){return BS.Util.visible(this.element());},_getMaxHeight:function(){if(this.options.fitWithinWindowHeight){var b=$(this.element()).cumulativeOffset();var a=BS.Util.windowSize()[1]-this.options.fitWithinWindowBottomMargin;a=a-(b[1]-BS.Util._scrollTop());return a>100?a:100;}return -1;},_showWithDelay:function(a,d,c){if(this.isShown()&&!this.isLoaded()){_.isFunction(c)&&c();return;}var b=this.options.delay;this._clearPopupTimer();if(b==0){this._showPopupNow(a,d,c);}else{this._timer=setTimeout(function(){this._showPopupNow(a,d,c);}.bind(this),b);}},_clearPopupTimer:function(){if(this._timer){clearTimeout(this._timer);delete this._timer;}},_showPopupNow:function(a,g,e){var f=this.element();var c=this.container();if(!f){f=document.createElement("div");f.id=this._name;f.className="popupDiv";c.appendChild(f);}else{this._removeDuplicates();if(f.parentNode!=c){f.remove();c.appendChild(f);}}f=$(f);if(this.options.className){f.addClassName(this.options.className);}if(!this.options.backgroundColor){this.options.backgroundColor=f.getStyle("backgroundColor");}if(this.options.innerText){$j(f).text(this.options.innerText);}else{if(this.options.innerHTML){f.innerHTML=this.options.innerHTML;}else{if(this.options.url||this.options.textProvider){var d="&nbsp;"+jQuery.trim(this.options.loadingText);f.addClassName("popupLoading");f.innerHTML=BS.loadingIcon+d;}}}if(this.options.hasTriangle){f.addClassName("popupDiv_has-triangle");var b=document.createElement("div");b.className="popupDiv__inner";b.style.backgroundColor=this.options.backgroundColor||"white";$j(f).children().wrapAll($j(b));}if(this.options.beforeShow){this.options.beforeShow(f);}BS.Util.place(f,a,g);if(this._getMaxHeight()!=-1){f.style.overflow="hidden";f.style.height="auto";}this._loaded=false;return BS.Hider.showDivWithTimeout(f.id,_.extend({hideOnMouseOut:function(){return this.options.hideDelay>=0&&this._loaded;}.bind(this)},this.options)).then(function(){if(this.options.url){BS.ajaxUpdater(this._name,this.options.url,{method:this.options.method,evalScripts:true,parameters:this.options.parameters,onComplete:function(){f.removeClassName("popupLoading");this._onComplete(e);}.bind(this)});}else{f.removeClassName("popupLoading");if(this.options.textProvider){f.innerHTML=this.options.textProvider(this);}if(this.options.htmlProvider){$j(f).append(this.options.htmlProvider(this));}this._initEvents();this._onComplete(e);}}.bind(this));},_removeDuplicates:function(){var b=this.element(),a;b.id="_"+this._name;a=$(this._name);while(a){a.parentNode.removeChild(a);a=$(this._name);}b.id=this._name;},_onComplete:function(a){this.element().style.backgroundColor=this.options.backgroundColor;if(this.options.width){this.element().style.width=this.options.width;}this._fixHeight();this.updatePopup();BS.loadRetinaImages(this.element());this.options.afterShowFunc(this);_.isFunction(a)&&a();this._loaded=true;},_fixHeight:function(){var a=this.element();var b=this._getMaxHeight(a);if(b>0&&a.offsetHeight>b){if(this.options.doScroll){window.scrollTo(0,a.cumulativeOffset()[1]-this.options.fitWithinWindowTopMargin);}a.style.height=this._getMaxHeight(a)+"px";a.style.overflowY="auto";}},updatePopup:function(){BS.Util.shiftToFitPage(this.element());},_initEvents:function(){var b=this;if(_.isString(this.options.className)&&this.options.className.indexOf("quickLinksMenuPopup")>-1){var a=jQuery(this.element());a.on("mouseup","a",function(d){var c;if(d.which){c=(d.which==1);}else{if(d.button){c=(d.button==0);}}if(!c){return;}if(d.ctrlKey||d.metaKey){return;}setTimeout(function(){BS.Hider.hideDivSingle(b._name);},0);});this._initKeyboardEvents(a);}},_initKeyboardEvents:function(a){function b(g){var f=jQuery(g).closest(".menuItem"),e=f.next();if(e.length>0&&e.hasClass("menuItem")){f.removeClass("menuItemSelected");e.addClass("menuItemSelected");e.find("a").focus();}}function d(g){var f=jQuery(g).closest(".menuItem"),e=f.prev();if(e.length>0&&e.hasClass("menuItem")){f.removeClass("menuItemSelected");e.addClass("menuItemSelected");e.find("a").focus();}}var c=a.find(".menuItem");c.removeClass("menuItemSelected").first().addClass("menuItemSelected");c.first().find("a").focus();c.off("keydown");c.keydown(function(f){switch(f.keyCode){case 38:d(f.target);return false;case 40:b(f.target);return false;default:return true;}});}});BS.Popup.openRingPopups=[];BS.ChangesPopup=new BS.Popup("changesPopup",{url:window["base_uri"]+"/changesPopup.html?limit=25",method:"get"});BS.ChangesPopup._switchTab=function(b,a,c){b.style.overflow="hidden";b.style.height="auto";b.innerHTML=BS.loadingIcon+"&nbsp;Loading...";this.updatePopup();var d=this;setTimeout(function(){BS.ajaxUpdater(b,window["base_uri"]+"/changesPopupTab.html",{method:"get",evalScripts:true,parameters:"limit=25&promoId="+a+"&tab="+c,onComplete:function(){d.updatePopup();}});},500);};BS.ChangesPopup.showCurrentBuild=function(b,a){this._switchTab(b,a,"");};BS.ChangesPopup.showSinceLastSuccessful=function(b,a){this._switchTab(b,a,"sinceLastSuccessful");};BS.ChangesPopup.showBuildChangesPopup=function(a,c,b){this.options.parameters=(b?"buildId":"promoId")+"="+c;this.showPopupNearElement(a);};BS.ChangesPopup.showPendingChangesPopup=function(b,a,d,c){this.options.parameters="buildTypeId="+a;if(d!=null){this.options.parameters+="&branch="+encodeURIComponent(d);}this.showPopupNearElement(b,c);};BS.ChangesPopup.expandComment=function(a){$j(a).parent().hide().next().show();return false;};BS.ChangesPopup.initArtifactChangesBlocks=function(){var a=$j(".artifactsChangeHeader");a.click(function(){var b=$j(this);b.toggleClass("expanded").toggleClass("collapsed");b.parent().find(".artifactChange").toggleClass("hidden");});a.mousedown(function(){return false;});};BS.FilesPopup=new BS.Popup("filesPopup",{url:window["base_uri"]+"/filesPopup.html",shift:{x:-300,y:10},afterShowFunc:function(){var a=window.location.pathname+"?";if(a.include("/diff.html?")||a.include("/diffView.html?")){$j("a","#filesPopup .changedFiles").each(function(){var b=$j(this);
b.attr("href",b.attr("href").replace(/\/.*\?/,a));});}}});BS.BuildResultsPopupTracker=(function(){var a={};return function(b){return{getPopup:function(){return a[b];},showPopup:function(c,g,f,e,d){if(!a[b]){a[b]=new BS.BuildResultsSummary(b,c,g,f);d=d||{};d.afterHideFunc=this._removePopup;}a[b].showPopupNearElement(e,d);},_removePopup:function(){if(a[b]&&!a[b].isShown()){delete a[b];BS.Log.info("Cleanup build results popup "+b+"; remains "+$H(a).keys().length);}},hidePopup:function(){if(a[b]){a[b].hidePopup();this._removePopup();}},stopHidingPopup:function(){if(a[b]){a[b].stopHidingPopup();}}};};})();BS.BuildResultsSummary=Class.create(BS.Popup,{initialize:function($super,b,a,d,c){$super("popupRes"+b,{buildId:b,skipChangesArtifacts:c,buildTypeId:a,shift:{x:-80},textProvider:function(e){var f=$("buildResultsSummaryTemplate");if(!f){return;}var g=f.innerHTML;g=g.replace(/##BUILD_ID##/g,e.options.buildId);g=g.replace(/##BUILD_TYPE_ID##/g,e.options.buildTypeId);setTimeout(function(){this.showDetailedInfo();}.bind(e),20);return g;}});},showDetailedInfo:function(){this._loaded=false;var d=this.options.buildId;$("summaryProgress:"+d).innerHTML=BS.loadingIcon+" Loading details...";var b={method:"GET",evalScripts:true,onComplete:function(){if($("summaryProgress:"+d)){$("summaryProgress:"+d).innerHTML="";}this.updatePopup();this._loaded=true;}.bind(this)};var a=window.location.href;var c="";if(a.indexOf("style=light")>-1){c="&style=light";}BS.ajaxUpdater($("detailedSummary:"+d),window["base_uri"]+"/buildResultsSummary.html?buildId="+d+"&skipChangesArtifacts="+this.options.skipChangesArtifacts+c,b);}});BS.BuildTypeSummary=new BS.Popup("buildTypeSummary");BS.BuildTypeSummary.showSummaryPopup=function(d,c,g,b,e,a,f){this.showPopupNearElement(d,{shift:{x:5,y:20},url:window["base_uri"]+"/buildTypePopup.html",parameters:{buildTypeId:c,branch:BS.Branch.getBranch(g),withSelf:b?"true":"false",withProject:e?"true":"false",withAdmin:a?"true":"false",withResponsibility:f?"true":"false"}});};BS.AgentInfoPopup=new BS.Popup("agentInfoPopup",{url:window["base_uri"]+"/showCompatibleAgents.html",shift:{x:-150}});BS.AgentInfoPopup.showAgentsPopup=function(a,b){this.options.parameters="itemId="+b;this.showPopupNearElement(a);};BS.BuildCommentPopup=new BS.Popup("buildCommentPopup",{url:window["base_uri"]+"/bsout.html",shift:{x:-150}});BS.BuildCommentPopup.showBuildCommentPopup=function(a,b){this.options.parameters=b;this.showPopupNearElement(a);};BS.DependentArtifactsPopup=new BS.Popup("dependentArtifactsPopup",{shift:{x:-60},url:window["base_uri"]+"/viewDependentArtifactsPopup.html"});BS.DependentArtifactsPopup.showPopup=function(b,c,a,d){this.options.parameters="buildId="+c+"&targetBuildId="+a+"&mode="+d;this.showPopupNearElement(b);};BS.BuildTypeSettingsPopup={showMultilineValue:function(b,e,d,a){var c=$("valueContainer");BS.Util.center("valuePopup");c.value=d;$("valuePopupTitle").innerHTML=e;BS.Hider.showDivWithTimeout("valuePopup",{hideOnMouseOut:false,draggable:true,dragHandle:$("valuePopup").getElementsBySelector(".dialogHandle")[0]});if(BS.internalProperty("teamcity.ui.codeMirrorEditor.enabled",true)){if(this.cm){c.parentNode.removeChild(this.cm.getWrapperElement());}if(!a){this.togglePaddings(true);c.show();}else{this.togglePaddings(false);this.cm=BS.CodeMirror.fromTextArea(c,{mode:a,readOnly:true,cursorBlinkRate:-1,styleActiveLine:false,autofocus:false});this.cm.setSize("100%",$j("#valuePopup").height()-$j("#valuePopup .dialogHeader").outerHeight());}}c.focus();},closeMultilineValuePopup:function(){BS.Hider.hideDiv("valuePopup");},togglePaddings:function(a){$j("#valuePopup .modalDialogBody").toggleClass("modalDialogBody_nopaddings",!a);}};BS.ProgressPopup=new BS.Popup("progressPopup",{delay:0,hideDelay:0});BS.ProgressPopup.showProgress=function(a,c,b){c=jQuery.trim(c);this.options.innerHTML='<span style="white-space: nowrap;">'+BS.loadingIcon+"&nbsp;"+c+"</span>";if(this.options.delay===undefined){this.options.delay=0;}_.extend(this.options,b);this.showPopupNearElement(a);};BS.WarningPopup=new BS.Popup("warningPopup",{delay:0,hideOnMouseOut:false});BS.WarningPopup.showWarning=function(a,b,c,d){this.options.innerText=c;this.options.shift=b;setTimeout(function(){this.showPopupNearElement(a,d);}.bind(this),50);};BS.Tooltip={_id:1,getId:function(){return"messagePopup_"+this._id++;}};BS.Tooltip.create=function(a,b){if(BS.Tooltip.popup){return null;}a=_.extend({delay:a.delay||400,shift:a.shift,hideOnMouseOut:true,hideOnMouseClickOutside:false,innerHTML:b},a);BS.Tooltip.popup=new BS.Popup(BS.Tooltip.getId(),a);return BS.Tooltip.popup;};BS.Tooltip.showMessage=function(a,c,e,d){var f=$(a);d&&e.evalScripts();var b=BS.Tooltip.create(c,e);if(b){b.showPopupNearElement(f);}BS.Tooltip.popupToggle=f;BS.Tooltip.deleteTitles(f);};BS.Tooltip.showMessageFromContainer=function(a,c,b,d){BS.Tooltip.showMessage(a,c,$(b).innerHTML,d);};BS.Tooltip.showMessageAtCursor=function(d,b,c){var e=$(d.currentTarget||d.target);var a=BS.Tooltip.create(b,c);if(a){a.showPopup(d);}BS.Tooltip.popupToggle=e;BS.Tooltip.deleteTitles(e);};BS.Tooltip.hidePopup=function(){if(BS.Tooltip.popup){BS.Tooltip.popup.hidePopup(BS.Tooltip.popup.options.delay,true);BS.Tooltip.popup=null;}if(BS.Tooltip.popupToggle){BS.Tooltip.recreateTitles(BS.Tooltip.popupToggle);BS.Tooltip.popupToggle=null;}};BS.Tooltip.deleteTitles=function(b){if(!b){return;}b=b.up();for(var a=0;a<3;++a){if(!b){return;}if(b.getAttribute("title")){b.setAttribute("data-original-title",b.getAttribute("title"));b.removeAttribute("title");}b=b.up();}};BS.Tooltip.recreateTitles=function(b){if(!b){return;}b=b.up();for(var a=0;a<3;++a){if(!b){return;}if(b.getAttribute("data-original-title")){b.setAttribute("title",b.getAttribute("data-original-title"));}b=b.up();}};BS.QueuedBuildsPopup=new BS.Popup("queuedBuildsPopup",{url:window["base_uri"]+"/queue.html",method:"get"});BS.QueuedBuildsPopup.showQueuedBuilds=function(a,b,d,e){var c="forBuildTypeId="+b;if(d!=null){c+="&branch="+encodeURIComponent(d);}if(e!=null){c+="&itemId="+encodeURIComponent(e);}this.showPopupNearElement(a,{parameters:c,shift:{x:-600,y:15}});};BS.RunningBuildsPopup=new BS.Popup("runningBuildsPopup");BS.RunningBuildsPopup.showBuilds=function(a,c){var b=$j(BS.Util.escapeId("btb"+c));this.showPopupNearElement(a,{shift:{x:-800,y:15},afterShowFunc:function(){var d=$j("#runningBuildsPopup");if(!d.is(":empty")){var e=d.attr("bt-id");if(e==c){return;}d.children("table").appendTo(BS.Util.escapeId("btb"+e));}d.append(b.children("table")).attr("bt-id",c);},afterHideFunc:function(){$j("#runningBuildsPopup").children("table").appendTo(b);}});};BS.ClickPopupSupport={clickPopups:{},togglePopup:function(id,showPopupCommand){var popup=BS.ClickPopupSupport.clickPopups[id];if(!popup||!popup.isShown()){popup=eval(showPopupCommand);BS.ClickPopupSupport.clickPopups[id]=popup;var linkPos=$(this).cumulativeOffset();var linkDim=$(this).getDimensions();var elDim=popup.element().getDimensions();BS.Util.place(popup.element(),linkPos[0]+linkDim.width-elDim.width,linkPos[1]+linkDim.height-1);popup.updatePopup();BS.Hider.addHideFunction(popup._name,function(){delete BS.ClickPopupSupport.clickPopups[id];}.bind(this));}else{popup.hidePopup(0,true);}}};BS.PromoDetailsPopup=new BS.Popup("promoDetailsPopup",{url:window["base_uri"]+"/promoDetailsPopup.html",method:"get",shift:{x:-50}});BS.PromoDetailsPopup.showDetailsPopup=function(b,a){BS.PromoDetailsPopup.options.parameters="promoId="+a;BS.PromoDetailsPopup.showPopupNearElement(b);};BS.PromoDetailsPopupFunc=(function(){return function(a){return{showPopup:function(b,e,f,d,c){BS.PromoDetailsPopup.showDetailsPopup(d,a);},hidePopup:function(){BS.PromoDetailsPopup.hidePopup();},stopHidingPopup:function(){BS.PromoDetailsPopup.stopHidingPopup();}};};})();BS.AuthorityRolesPopup=new BS.Popup("authorityRolesPopup",{url:window["base_uri"]+"/admin/authorityRolesPopup.html",method:"get"});BS.AuthorityRolesPopup.showPopup=function(a,b){this.options.parameters="rolesHolderId="+b;this.showPopupNearElement(a);
};BS.GroupUsersPopup=new BS.Popup("groupUsersPopup",{url:window["base_uri"]+"/admin/groupUsersPopup.html",method:"get"});BS.GroupUsersPopup.showPopup=function(b,a){this.options.parameters="groupCode="+encodeURIComponent(a);this.showPopupNearElement(b);};BS.ParentGroupsPopup=new BS.Popup("parentGroupsPopup",{url:window["base_uri"]+"/admin/parentGroupsPopup.html",method:"get"});BS.ParentGroupsPopup.showUserParentGroups=function(a,b){this.options.parameters="userId="+b;this.showPopupNearElement(a);};BS.ParentGroupsPopup.showGroupParentGroups=function(b,a){this.options.parameters="groupCode="+encodeURIComponent(a);this.showPopupNearElement(b);};BS.BuildTypeTemplatesPopup=new BS.Popup("buildTypeTemplatesPopup",{url:window["base_uri"]+"/admin/buildTypeTemplatesPopup.html",method:"get"});BS.BuildTypeTemplatesPopup.showPopup=function(b,a,c){this.options.parameters="buildTypeId="+encodeURIComponent(a)+"&selectedStep="+c;this.showPopupNearElement(b);};BS.ShowBuildTypesPopup=new BS.Popup("showBuildTypesPopup",{hideDelay:0,shift:{x:-230,y:20},className:"flatView"});BS.ShowBuildTypesPopup.showPopup=function(a,c){var b={projectId:c};BS.Branch.addBranchToParams(b,c);this.options.url=window["base_uri"]+"/showBuildTupesPopup.html?"+Object.toQueryString(b);this.showPopupNearElement(a);};BS.InstallAgentsPopup={showNearElement:function(a){$("installAgents").style.position="absolute";BS.Util.placeNearElement("installAgents",a,{x:-180,y:21});BS.Hider.showDivWithTimeout("installAgents",{hideOnMouseOut:false});}};BS.TogglePopup=new BS.Popup("togglePopup",{delay:0,hideDelay:-1,shift:{x:0}});BS.TogglePopup.toggle=function(a){if(this.isShown()){this.hidePopup();}else{this.options.innerHTML=a.nextSibling.innerHTML;this.showPopupNearElement(a);}return false;};BS.JumpTo=new BS.Popup("jumpToPopup",{delay:0,hideDelay:-1,shift:{x:-209,y:20}});BS.JumpTo.jump=function(a){BS.HistoryTable.update("jumpTo="+a);this.hidePopup();};BS.PopupDialog={_popups:{},show:function(d,a,c,e,f){if(this._popups[a]){this.hide(a,false);}var g=OO.extend({method:"get",url:window["base_uri"]+"/popupDialog.html",parameters:"init=1&typeId="+encodeURIComponent(a)+"&contextId="+c,hideOnMouseOut:false,hideOnMouseClickOutside:false,width:"25em",delay:0,shift:{x:0,y:d?d.offsetHeight+5:16},hideDelay:-1},f||{});var b=new BS.Popup("popupDialog_"+a,g);b._afterApply=e;this._popups[a]=b;b.showPopupNearElement(d);},hide:function(a,c){var b=this._popups[a];this._popups[a]=null;if(b){b.hidePopup();if(c&&b._afterApply){b._afterApply();}}}};window._tc_es=function(b){var a=b.currentTarget;if(a.hasAttribute("data-pinned")){a.removeAttribute("data-pinned");}else{a.setAttribute("data-pinned","true");b.stopPropagation();return true;}};window._pc_over=function(){};window._pc_out=function(){};BS.ProjectDataPopup=new BS.Popup("projectDataPopup",{url:window["base_uri"]+"/projectData.html",method:"get",hideOnMouseOut:false,hideOnMouseClickOutside:true,shift:{x:0,y:20}});BS.ProjectDataPopup.showPopup=function(d,e,c,b,a){this.options.parameters="type="+e+"&projectFilePath="+$(c).value+"&sourceFieldId="+c+"&targetFieldId="+b+"&popupTitle="+a+"&retrieveData=true";this.showPopupNearElement(d);};BS.ProjectDataPopup.insertSelectedValue=function(b,a){$(a).value=b;this.hidePopup(0);};BS.ProjectDataPopup.appendSelectedValues=function(f,a){var c=Form.getElements(f);c=c.filter(function(g){return g.type=="checkbox"&&g.name.startsWith("dataItem_")&&g.checked;});var d=" ";if($(a).tagName=="TEXTAREA"){d="\n";}var e=$(a).value+d;for(var b=0;b<c.length;b++){e+=c[b].value+d;}e=$j.trim(e);if(e.length>0){$(a).value=e;this.hidePopup(0);}};BS.ProjectDataPopup.attachHandler=function(g,d,c,b){var a="handle_"+d+c;var f=document.createElement("span");f.id=a;f.className="projectDataPopupHandle icon-magic";f.style.position="absolute";f.style.display="none";f.style.right="4px";f.style.top="4px";f.title=b;f.onclick=function(){BS.ProjectDataPopup.showPopup(this,g,d,c,b);};$(c).parentNode.appendChild(f);var e={updateVisibility:function(){var i=$(c);var h=$(a);if(i.disabled||i.readOnly){BS.Util.hide(h);}else{if(h!=null){BS.Util.show(h);}}}};BS.VisibilityHandlers.attachTo(c,e);};BS.BranchesPopup=new BS.Popup("branchesPopup",{url:window["base_uri"]+"/branchesPopup.html",method:"get",hideOnMouseOut:false,hideOnMouseClickOutside:true,shift:{x:0,y:20}});BS.BranchesPopup.showPopup=function(b,e,a,d,f,c){this.options.parameters=e()+"&targetFieldId="+a+"&selectMode="+d+(f!=null?"&branchesPolicy="+f:"")+(c!=null?"&applyBranchFilter="+c:"");this.showPopupNearElement(b);};BS.BranchesPopup.attachBuildTypeHandler=function(b,a,d,e,c){BS.BranchesPopup.doAttachHandler(function(){return"buildTypeId="+b;},a,d,e,c);};BS.BranchesPopup.attachBuildTypesHandler=function(b,a,d,e,c){BS.BranchesPopup.doAttachHandler(function(){var g="";var f=b();for(var h=0;h<f.length;h++){g+="buildTypeId="+f[h]+"&";}return g;},a,d,e,c);};BS.BranchesPopup.attachHandler=function(e,a,c,d,b){BS.BranchesPopup.doAttachHandler(function(){return"id="+e;},a,c,d,b);};BS.BranchesPopup.doAttachHandler=function(g,b,e,h,d){if(!e){e="branchFilter";}var a="handle_branches_"+b;if($(a)){$(a).parentNode.removeChild($(a));}var c=document.createElement("span");c.id=a;c.className="branchesPopupHandle icon-magic";c.onclick=function(){BS.BranchesPopup.showPopup(this,g,b,e,h,d);};var f=$(b).parentNode.className;if(f.indexOf("posRel")==-1){BS.Util.wrapRelative($(b));}$(b).parentNode.appendChild(c);};BS.BranchesPopup.appendSelected=function(e,h,g){var a=Form.getElements(h);a=a.filter(function(i){return i.type=="checkbox"&&i.name.startsWith("branch_")&&i.checked;});var d=" ";if($(g).tagName=="TEXTAREA"){d="\n";}var b=$(g).value+d;for(var c=0;c<a.length;c++){var j=e+a[c].value;var f=new RegExp("^"+BS.Util.escapeRegExp(j)+"$","mg");if(f.test(b)){continue;}b+=j+d;}b=$j.trim(b);if(b.length>0){$(g).value=b;$j("#"+g).trigger("onchange");BS.VisibilityHandlers.updateVisibility($(g));this.hidePopup(0);}return false;};(function(){var c={};function b(i,f,e,h){var g=["show","hide","stopHiding"],e=e||{},d=new f(i,e.options,h);if(e.handlers){d.handlers=e.handlers;}g.forEach(function(j){if(e[j]){d[j+"Popup"]=e[j];}});if(!e.show){d.showPopup=function(j,k){this.showPopupNearElement(j,k);};}return d;}function a(e){var d=c[e];if(!d){BS.Log.error("no popup type",e);throw new Error("no popup type",e);}return d;}BS.registerPopupType=function(d,f){var e;f=f||{};if(!f.live){e=b(d,f.__base||BS.Popup,f);}else{e=function(i,h,g){h=h||{};return b(i,f.live,OO.extend(f,{options:h}),g);};}c[d]=e;};BS.bindPopup=function(g,j,n){var f=$j(typeof g==="string"?BS.Util.escapeId(g):g),d=f.find(".toggle:last"),m=n&&n.show||[],i=n&&n.hide||[],h=n&&n.stopHiding||[],l=n&&n.create||{},e=f.length?a(j):null;function k(o){if(e.__showNearEvent){e.showPopup.apply(e,[o].concat(m));}else{e.showPopup.apply(e,[d[0]].concat(m));}}if(e){if("function"===typeof e){e=e(f.attr("id"),l,g);}f.removeAttr("onmouseover");e._showOptions=m;e._$toggle=d;f.on("mouseover",function(){e.stopHidingPopup.apply(e,h);}).on("mouseout",function(){e.hidePopup.apply(e,i);});if(d.length){d.on("mouseover",k).on("click",function(o){if(_tc_es(o)){k(o);}});if(window.event&&(window.event.target||window.event.srcElement)===d[0]){d.trigger("mouseover");}}if(e.handlers){e.handlers.forEach(function(o){f.on(o.event,o.delegate,o.getHandler(e));});}}else{BS.Log.warn("bind "+j+": Cannot find element with id "+g);}};BS.registerPopupType("projectSummary",{show:function(g,f,e,d){this.showPopupNearElement(g,{shift:{x:5,y:20},url:window["base_uri"]+"/projectPopup.html",parameters:{projectId:f,branch:BS.Branch.getBranch(f),withSelf:e?"true":"false",withAdmin:d?"true":"false"}});}});BS.ProjectSummary=a("projectSummary");BS.ProjectSummary.showSummaryPopup=BS.ProjectSummary.showPopup;BS.registerPopupType("simplePopup",{live:function(d,e){var f=$j(BS.Util.escapeId(d||""));if(f.length==0){BS.Log.warn("bind simplePopup: Cannot find element with id "+d);return;}return new BS.Popup(d+"Content",OO.extend(e,{hideDelay:300}));},handlers:[{event:"click",delegate:".popupLink",getHandler:function(d){return function(){var f=$j(d._$toggle.length?d._$toggle:this),e=f.parents(".popupDiv:last")[0];
BS.Hider.hideAll(e);d.showPopupNearElement(f,OO.extend(d._showOptions[0],{delay:0}));};}}]});BS.registerPopupType("buildTypeMenuPopup",{show:function(d,f,e){return this.showPopupNearElement(d,{parameters:{buildTypeId:f,cameFromUrl:e,jspPath:"/editBuildTypePopup.jsp"},shift:{x:-241,y:20},url:window["base_uri"]+"/showJsp.html",className:"quickLinksMenuPopup"});}});BS.install_simple_popup=function(d,e){e=e||{};BS.bindPopup(d,"simplePopup",{create:e});};})();BS.createReorderDialog=function(b,f,d,a){a=a||".draggable";var c=BS.SimpleModalDialog(b);c.$dialog=$j("#"+b);var e=[];f.find(a).each(function(g,h){e.push(h.innerHTML);});c.resetState=function(){f.find(a).each(function(g,h){h.innerHTML=e[g];});};c.setDisabled=function(g){c.$dialog.find("#cancelButton").attr("disabled",g);c.$dialog.find(".saveOrderButton").attr("disabled",g);f.sortable(g?"disable":"enable");};f.sortable({cancel:".inherited",tolerance:"pointer",scroll:true,axis:"y",opacity:0.7});c.$dialog.bind("closeDialog",function(){c.close();c.$dialog.find("#saveOrderProgress").hide();}).bind("saveDialog",function(){c.$dialog.find("#saveOrderProgress").show();d(BS.QueueLikeSorter.computeOrder(f.get(0),"ord_"));return false;});c.$dialog.find("#cancelButton").bind("click",function(){c.resetState();c.$dialog.trigger("closeDialog");});c.$dialog.find(".saveOrderButton").bind("click",function(){c.$dialog.trigger("saveDialog");});return c;};
/*---
/js/bs/menuList.js
---*/
(function(a){a(function(){var b=a(document);b.on("mouseover mouseout",".menuList .menuItem",function(c){a(this).toggleClass("menuItemSelected",c.type=="mouseover");});b.on("click",".menuList .menuItem",function(d){if(!_.isFunction(this.onclick)){var c=a(this).children("a").get(0);if(c&&d.target!=c){if(_.isFunction(c.onclick)){c.onclick();}else{return BS.openUrl(d,c.href);}}}});});})(jQuery);
/*---
/js/bs/modalDialog.js
---*/
BS.AbstractModalDialog={_attachedToRoot:false,hideOnMouseClickOutside:false,getContainer:function(){},beforeShow:function(){},afterClose:function(){},getDragHandle:function(){return $(this.getContainer()).getElementsBySelector(".dialogHandle")[0];},bindCtrlEnterHandler:function(a){var b=function(){this._ctrlEnterHandler=function(c){if(c.ctrlKey&&c.keyCode==Event.KEY_RETURN){a&&a();}}.bindAsEventListener(this);$j(document).off("keydown.formCtrlEnter keydown.dialogCtrlEnter").on("keydown.dialogCtrlEnter",this._ctrlEnterHandler);}.bind(this);b.defer();},bindEnterHandler:function(a){var b=function(){this._enterHandler=function(c){if(c.keyCode==Event.KEY_RETURN){a&&a();}}.bindAsEventListener(this);$j(document).on("keydown.dialogEnter",this._enterHandler);}.bind(this);b.defer();},unbindCtrlEnterHandler:function(){if(!this._ctrlEnterHandler){return;}$j(document).off("keydown.dialogCtrlEnter");this._ctrlEnterHandler=null;},_getDialogForm:function(a){return a.parentNode.tagName.toLowerCase()=="form"&&a.parentNode.getAttribute("id")+"Dialog"==a.getAttribute("id")?a.parentNode:a;},_removeDuplicateElements:function(){var c=$(this.getContainer());if(!c){return;}var a=c.id;c.id="_"+a;var b=$(a);while(b){var d=this._getDialogForm(b);d.parentNode.removeChild(d);b=$(a);}c.id=a;},_fixElementPlacement:function(){this._removeDuplicateElements();if(this._attachedToRoot){return;}var c=$(this.getContainer());var d=this._getDialogForm(c);var a=$("mainContent");if(d.parentNode!=a){var b=$j(d).parents(".refreshable").first();if(b.length){BS.Refreshable.registerPoppingOutDialog(b.attr("id"),d.id);}a.appendChild(d);this._attachedToRoot=true;}},getFramedPageInfo:function(){var a=$j.Deferred();window.parentIFrame.getPageInfo(function(b){window.parentIFrame.getPageInfo(false);a.resolve(b);});return a.promise();},isEmbedded:function(){return"parentIFrame" in window;},showAt:function(a,c){this._fixElementPlacement();var b=$(this.getContainer());this.beforeShow();BS.Util.place(b,a,c);this._showDialog(b);},showAtFixed:function(a){this._fixElementPlacement();this.beforeShow();a.addClassName("modalDialogFixed");return this._showDialog(a).then(function(){this.positionAtFixed(a);this.recenterDialog();var c=$j(document).scrollTop();var b=$j(document).scrollLeft();$j(window).off("resize.modalDialog scroll.modalDialog").on("resize.modalDialog scroll.modalDialog",function(){this.positionAtFixed(a,$j(document).scrollTop()-c,$j(document).scrollLeft()-b);c=$j(document).scrollTop();b=$j(document).scrollLeft();}.bind(this));}.bind(this));},positionAtFixed:function(c,b,a){if(!c){return;}var d=this;var e=$j(c);function f(){e.position({my:"center",at:"center",of:window,using:function(g){var i=function(r,m,t){var q=$j(document)["scroll"+(r?"Left":"Top")](),l=e[r?"width":"height"](),n=e.position()[r?"left":"top"],u=r?(e.position().left+e.width()):(e.position().top+e.height()),o=r?(window.innerWidth||document.documentElement.clientWidth):(t||window.innerHeight||document.documentElement.clientHeight),p=q+o,s,k=r?(window.innerWidth&&window.innerWidth<document.documentElement.clientWidth):(window.innerHeight&&window.innerHeight<document.documentElement.clientHeight);if(l>o){if(typeof m==="undefined"){s=q;}else{if(m>0){if(p<=u){s=n;}else{s=p-l;}}else{if(q>=n){s=n;}else{s=q<0?0:q;}}}}else{if(k){s=q+(o-l)/2;}else{s=g[r?"left":"top"];}}return s;};var j=function(n){var m=e.height(),l=n.offsetTop-n.scrollTop<0?n.documentHeight:n.documentHeight-n.offsetTop+n.scrollTop,k=n.offsetTop-n.scrollTop>0?n.scrollTop:n.scrollTop-n.offsetTop;return k+(l-m)/2;};var h=parseInt(i(true,a));if(!d.isEmbedded()){e.css({top:parseInt(i(false,b)),left:h,visibility:"visible"});}else{e.css({visibility:"hidden"});d.getFramedPageInfo().then(function(k){e.css({top:parseInt(j(k)),left:h,visibility:"visible",display:"block"});},function(){e.css({top:parseInt(i(false,b)),left:h,visibility:"visible"});});}}});}if(BS.Browser.opera){e.css("visibility","hidden");setTimeout(f,0);}else{f();}},_showDialog:function(a){var b=function(){this.removeOverlappingDiv();this.resetPosition(a);this.afterClose();this.unbindCtrlEnterHandler();this._attachedToRoot=false;}.bind(this);return BS.Hider.showDivWithTimeout(a.id,{hideOnMouseOut:false,hideOnMouseClickOutside:this.hideOnMouseClickOutside,afterHideFunc:b,draggable:true,dragHandle:this.getDragHandle(),zIndex:this.zIndex}).then(function(){a.setAttribute("data-modal",true);this.showOverlappingDiv(a);}.bind(this));},isVisible:function(){return BS.Util.visible(this.getContainer());},showCentered:function(){var a=$(this.getContainer());return this.showAtFixed(a);},recenterDialog:function(){this._fixElementPlacement();var a=$(this.getContainer());var b=a.getDimensions();if(b.height>a.getAttribute("data-height")||0){this.positionAtFixed(a);}},close:function(){this.doClose();},doClose:function(){if(this.getContainer()){BS.Hider.hideDiv(this.getContainer().id);}},_overlappingDivId:function(){return"overlappingDiv";},getOverlappingDiv:function(){var d=this._overlappingDivId();var b=$(d);if(b){return b;}var a=$j("<div/>").attr("id",d).hide().appendTo($j("#mainContent"));var c=a.get(0);$j(c).width($j(document).width());$j(c).height($j(document).height());return c;},showOverlappingDiv:function(a){var c=this.getOverlappingDiv();var b=a.style.zIndex;c.style.zIndex=""+(parseInt(b,10)-1);if(!BS.Util.visible(c)){BS.Util.show(c);}},removeOverlappingDiv:function(){var c=$(this._overlappingDivId());if(c){var d;for(var b in BS.Hider.allDivs){var a=$(BS.Hider.allDivs[b]);if(a&&a.getAttribute("data-modal")){d=a;}}if(d){c.style.zIndex=""+(parseInt(d.style.zIndex,10)-1);}else{$("mainContent").removeChild(c);}}},resetPosition:function(a){$j(window).off("resize.modalDialog scroll.modalDialog");a.style.cssText="";},detach:function(){var b=$(this.getContainer());if(b==null){return;}var c=this._getDialogForm(b);var a=document.getElementById("mainContent");if(c.parentNode===a){a.removeChild(c);}}};BS.SimpleModalDialog=function(a){return OO.extend(BS.AbstractModalDialog,{getContainer:function(){return $(a);}});};BS.confirmDialog=OO.extend(BS.AbstractModalDialog,{hideOnMouseClickOutside:true,getContainer:function(){return $("confirmDialog");},show:function(a){this.options=OO.extend({title:"",text:"Are you sure?",actionButtonText:"OK",cancelButtonText:"Cancel",action:function(){},cancelAction:function(){}},a||{});this.setTitle();this.setText();this.setActionButtonText();this.setCancelButtonText();this.showCentered();this._focusOnActionButton();},doAction:function(){var a=this.options.action();var b=this;if(a){BS.Util.show("confirmProgress");a.done(function(){BS.Util.hide("confirmProgress");b.close();});}else{this.close();}},doCancelAction:function(a){this.options.cancelAction(a);this.close();},close:function(){this._resetActions();BS.AbstractModalDialog.close.call(this);},_resetActions:function(){this.options.action=function(){};this.options.cancelAction=function(){};},_focusOnActionButton:function(){$j(this.getContainer()).find(".submitButton").focus();},setTitle:function(){$j(this.getContainer()).find(".dialogTitle").text(this.options.title);},setText:function(){$j(this.getContainer()).find(".confirmDialog__content").html(this.options.text);},setActionButtonText:function(){$j(this.getContainer()).find(".submitButton").val(this.options.actionButtonText);},setCancelButtonText:function(){$j(this.getContainer()).find(".cancel").text(this.options.cancelButtonText);}});BS.DialogWithProgress=OO.extend(BS.AbstractModalDialog,{loaderDisplayTimeout:300,showProgress:function(a){this._loadingTimeoutId=setTimeout(function(){BS.LoadingDialog.setTitle(a);this._loadingTimeoutId=null;if(!this._showPromise){this._showPromise=BS.LoadingDialog.showCentered();}}.bind(this),0);},hideProgress:function(){if(this._loadingTimeoutId){clearTimeout(this._loadingTimeoutId);this._loadingTimeoutId=null;return Promise.resolve();}else{if(this._showPromise){return this._showPromise.then(function(){BS.LoadingDialog.close();this._showPromise=null;}.bind(this));}}},showCentered:function(){this.hideProgress().then(function(){BS.AbstractModalDialog.showCentered.apply(this,arguments);
}.bind(this));}});BS.LoadingDialog=OO.extend(BS.AbstractModalDialog,{getContainer:function(){return $("abstractLoadingDialog");},setTitle:function(a){$("abstractLoadingTitle").textContent=a||"Loading...";},showCentered:function(){$j("#abstractProgress").show();return BS.AbstractModalDialog.showCentered.call(this);}});BS.AbstractCopyMoveDialog=OO.extend(BS.DialogWithProgress,OO.extend(BS.AbstractWebForm,OO.extend(BS.AbstractModalDialog,{savingElemId:function(){return this._savingElemId||this.__baseId+"Progress";},containerId:function(){return this._containerId||this.__baseId+"FormDialog";},formElementId:function(){return this._formElementId||this.__baseId+"Form";},fetchUrl:function(){return this._fetchUrl||"/admin/%%.html".replace(/%%/,this.__baseId);},copyButtonId:function(){return this._copyButtonId||this.__baseId+"Button";},fetchParamName:null,getContainer:function(){return $(this.containerId());},formElement:function(){return $(this.formElementId());},setSaving:function(a){BS.Util[a?"show":"hide"](this.savingElemId());},showDialog:function(b){var a=this;this.showProgress();$j(BS.Util.escapeId(this.formElementId())).remove();BS.ajaxRequest(window["base_uri"]+this.fetchUrl(),{method:"GET",parameters:this._prepareRequestParameters.apply(this,[].slice.apply(arguments)),onComplete:function(c){a.hideProgress();a._onFetchDialogComplete(c);}});return false;},_prepareRequestParameters:function(b){var a={};a[this.fetchParamName]=b;return a;},_onFetchDialogComplete:function(a){$j("body").append(a.responseText);this.showCentered();$j(this.formElement().projectId).trigger("change").focus();this.bindCtrlEnterHandler(this.submitMove.bind(this));},cancelDialog:function(){this.close();},afterClose:function(){this.clearErrors();}})));
/*---
/js/bs/investigation.js
---*/
BS.ResponsibilityCommon={checkUserPermissionsOnChange:function(a,b,c){b.change(function(){var e=this.options[this.selectedIndex];var d=e?e.value:0;if(d){a.html("");var f=$j(BS.loadingIcon).appendTo("body").css({zIndex:100}).position({my:"left+4",at:"right",of:$j("#reactui-investigate").length?$j("#reactui-investigate"):b.parent()});BS.ajaxRequest(window["base_uri"]+"/investigationWarning.html",{method:"get",parameters:{projectId:c,userId:d},onComplete:function(g){a.html(g.responseText);f.remove();}});}});}};BS.ResponsibilityDialog=OO.extend(BS.AbstractWebForm,OO.extend(BS.AbstractModalDialog,{formElement:function(){return $("investigationForm");},getContainer:function(){return $("investigationFormDialog");},getUrl:function(){return window["base_uri"]+"/buildTypeInvestigationDialog.html";},showDialog:function(a,j,f,c,i){this._withoutReload=c;this._submitHandler=i;var h='Investigate "'+j.escapeHTML()+'"'+(j.length>20?"":" build configuration");$j("#investigationFormTitle").html(h);var e=$j("#investigationForm .modalDialogBody");e.html(BS.loadingIcon+"&nbsp;Loading...");this.showCentered();this.bindCtrlEnterHandler(this.submit.bind(this));function d(k){k=$j(k);if(!k.prop("checked")){k.click().trigger("change");new Effect.Highlight(k.next("label")[0]);}}function b(){if($j("#currentBuildType").data("successful")){var k=$j("#bt-remove-investigation");k.prop("selectedIndex",1).trigger("change");new Effect.Highlight(k.parent().parent().find("label")[0]);}}var g=this;BS.ajaxUpdater(e[0],this.getUrl(),{method:"get",evalScripts:true,parameters:{buildTypeId:a},onComplete:function(){g.showCentered();g._handleDefaults();g.hideMoreLinkIfNeeded();if(f){d("#bt-fix-investigate");}else{if($j("#bt-responsible option:selected").text()=="me"&&$j("#bt-giveup-investigate").is(":checked")){d("#bt-assign-investigate");b();}}}});return new Promise(function(l,k){this._resolve=l;this._reject=k;}.bind(this));},_handleDefaults:function(){var g=$j("#do-bt-investigate"),n=$j("#bt-investigate-section input[name=investigate]"),o=$j("#bt-assign-investigate"),e=$j("#bt-responsible"),m=$j("#bt-remove-investigation");n.change(function(){b(g);});g.change(function(){if(!$j(this).is(":checked")){c(n);}else{b(o);}});e.add(m).change(function(){b(o);b(g);});function b(p){return p.prop("checked",true);}function c(p){return p.prop("checked",false);}function h(p){p.prop("disabled",false);}function f(p){p.prop("disabled",true);}function a(){if(g.is(":checked")){h($j("#bt-submit"));}else{f($j("#bt-submit"));}}var k={};var j=$j("#bt-investigate-section");function d(q,p){p.find("select, input[type=text]").each(function(){q[this.id]=$j(this).val();});p.find("input[type=radio], input[type=checkbox]").each(function(){q[this.id]=$j(this).is(":checked");});}function i(q,p){p.find("select, input[type=text]").each(function(){$j(this).val(q[this.id]).trigger("change");});p.find("input[type=radio], input[type=checkbox]").each(function(){if(q[this.id]){b($j(this));}else{c($j(this));}});if(BS.ResponsibilityDialog.resetReactUiInvestigator){BS.ResponsibilityDialog.resetReactUiInvestigator();}}d(k,j);var l=$j("#bt-reset-investigate");n.add(e).add(m).change(function(){l.show().parent().addClass("modifiedParam");});l.click(function(){i(k,j);l.hide().parent().removeClass("modifiedParam");c(g);a();return false;});n.add(e).add(m).change(function(){a();});},moreConfigurations:function(){$j("#allBuildTypes").show();$j("#moreBuildTypes, #currentBuildType").hide();this._fixElementPlacement();return false;},hideMoreLinkIfNeeded:function(){var a=$j("#allBuildTypes input[type=checkbox]").length;if(a<=1){$j("#moreBuildTypes").hide();}},checkUserPermissionsOnChange:function(a){BS.ResponsibilityCommon.checkUserPermissionsOnChange($j("#bt-investigation-warning"),$j("#bt-responsible"),a);},submit:function(){var b=this;$j("#moreBuildTypes").hide();var a=$j("#responsibilityProgressIcon").show();BS.FormSaver.save(this,this.getUrl(),OO.extend(BS.ErrorsAwareListener,{onCompleteSave:function(){a.hide();if(typeof b._submitHandler==="function"){b._submitHandler();}if(b._resolve!=null){b._resolve();}if(b._withoutReload!==true){BS.reload(true);}else{b.close();}},onFailure:function(){a.hide();alert("Problem accessing server");}}));return false;},setButtonsEnabling:function(){var a=$j("#allBuildTypes input[type=checkbox]:checked").length>0;$j("#bt-submit").prop("disabled",!a);}}));BS.Responsibilities=OO.extend(BS.AbstractWebForm,{formElement:function(){return $("responsibilitiesFilter");},savingIndicator:function(){return $("respRefreshProgress");},submitFilter:function(){var a=this;this.setSaving(true);this.disable();BS.FormSaver.save(this,this.formElement().action,OO.extend(BS.SimpleListener,{onCompleteSave:function(){if($("responsibilitiesTable")){$("responsibilitiesTable").refresh("respRefreshProgress",null,function(){a.setSaving(false);a.enable();});}}}));return false;}});BS.Mutes=OO.extend(BS.AbstractWebForm,{formElement:function(){return $("mutesFilter");},savingIndicator:function(){return $("mutesRefreshProgress");},submitFilter:function(){var a=this;this.setSaving(true);this.disable();BS.FormSaver.save(this,this.formElement().action,OO.extend(BS.SimpleListener,{onCompleteSave:function(){if($("mutesTable")){$("mutesTable").refresh("mutesRefreshProgress",null,function(){a.setSaving(false);a.enable();});}}}));return false;}});BS.BulkInvestigateDialog=OO.extend(BS.AbstractWebForm,OO.extend(BS.AbstractModalDialog,{_submitUrl:null,getContainer:function(){return $("muteTestsFormDialog");},formElement:function(){return $("muteTestsForm");},getInnerContainer:function(){return $("mute-dialog-container");},getLoadingElement:function(){return $("mute-dialog-inner-progress")||$("mute-dialog-progress");},enableSaveOnScopeChange:function(){$j("#commentOrScopeChanged").prop("checked",true);this._enableOrDisable();},prepareOnShow:function(l,r){function w(y){return y.prop("checked",true);}function v(y){return y.prop("checked",false);}function m(y){y.prop("disabled",false);}function c(y){y.prop("disabled",true);}var h=this;var b=$j("#do-investigate"),o=$j("#muteTestsForm input[name=investigate]"),s=$j("#assign-investigate"),u=$j("#investigator"),a=$j("#remove-investigation");o.change(function(){w(b);});b.change(function(){if(!$j(this).is(":checked")){v(o);}else{w(s);}});u.add(a).change(function(){w(s);w(b);});var q=$j("#do-mute"),x=$j("#muteTestsForm input[name=mute]"),g=$j("#mute-mute"),t=$j("#mute-scope, #unmute, #unmute-time, #mute-in-bt-list input");x.change(function(){w(q);});q.change(function(){if(!$j(this).is(":checked")){v(x);}else{w(g);}});t.change(function(){w(g);w(q);});$j("#investigate-comment").on("keydown",function(){h.enableSaveOnScopeChange();});$j("#unmute-time").placeholder({text:"Click to select the date"});$j("#unmute-time").focus(function(){$j("#unmute-time").placeholder("hide");});$j("#mute-scope").change(function(){if(this.selectedIndex==1){$j("#mute-in-bt-list").show();if(r){var y=$j("#mute-in-bt-"+r);if(y.length&&!y.is(":checked")){w(y);$j("#mute-in-bt-list").animate({scrollTop:y.position().top},function(){new Effect.Highlight(y.parent()[0]);});}}}else{$j("#mute-in-bt-list").hide();}$j("#unmute-time").placeholder("refresh");});$j("#unmute").change(function(){if(this.selectedIndex==2){$j("#unmute-row").show();}else{$j("#unmute-row").hide();}$j("#unmute-time").datepicker(this.selectedIndex==2?"show":"hide");$j("#unmute-time").placeholder("refresh");});$j("#unmute-time").datepicker({minDate:+1,dateFormat:"dd.mm.yy",defaultDate:+7}).css({marginTop:4});var p={},k={};var d=$j("#investigate-section"),j=$j("#mute-section");function e(z,y){y.find("select, input[type=text]").each(function(){z[this.id]=$j(this).val();});y.find("input[type=radio], input[type=checkbox]").each(function(){z[this.id]=$j(this).is(":checked");});}function n(z,y){y.find("select, input[type=text]").each(function(){$j(this).val(z[this.id]).trigger("change");});y.find("input[type=radio], input[type=checkbox]").each(function(){if(z[this.id]){w($j(this));}else{v($j(this));
}});}e(p,d);e(k,j);var f=$j("#reset-investigate"),i=$j("#reset-mute");o.add(u).add(a).change(function(){f.show().parent().addClass("modifiedParam");});f.click(function(){n(p,d);f.hide().parent().removeClass("modifiedParam");v(b);h._enableOrDisable();return false;});x.add(t).change(function(){i.show().parent().addClass("modifiedParam");});i.click(function(){n(k,j);i.hide().parent().removeClass("modifiedParam");v(q);h._enableOrDisable();return false;});if(l){w(b);w(s);f.show().parent().addClass("modifiedParam");}o.add(u).add(a).add(x).add(t).change(function(){h._enableOrDisable();});h._enableOrDisable();},_enableOrDisable:function(){if($j(".investigate-no-permission").length>0){$("submit").disabled=true;return;}var b=$j("#do-investigate"),a=$j("#do-mute"),c=$j("#commentOrScopeChanged");var d=b.is(":checked")||a.is(":checked")||c.is(":checked");$("submit").disabled=!d;},_doShow:function(f,e,d,b,a,c){this._reenable(f);this._dialogClass(true,"wideDialog");this._withoutReload=a;this._submitHandler=c;this.showAtFixed($(this.getContainer()));this.bindCtrlEnterHandler(this.submit.bind(this));this._lastShowArgs={title:f,params:e,fixMode:d};if(!b){e=Object.extend({},e);e["init"]=1;}this._loadContent(window["base_uri"]+this._submitUrl,e,d);return false;},submit:function(){if(this.validate()){return this._submit(window["base_uri"]+this._submitUrl+"?post=true");}return false;},validate:function(){var b=$j("#mute-scope").val(),a=$j("#unmute").val(),d=$j("#investigate-comment").val();$j("#mute-dialog-container div.error-msg").html("");if($j("#mute-mute").is(":checked")){if(b=="C"){if($j("#mute-in-bt-list input:checked").length==0){return this.validationError("#bt-list-error","Please choose the build type");}}if(a=="T"){var c=$j("#unmute-time").val();if(c.length==0){return this.validationError("#unmute-time-error","Please specify the unmute date");}else{if(!/^\d{1,2}\.\d{1,2}\.\d{4}$/.match(c)){return this.validationError("#unmute-time-error","Please specify the correct unmute date");}}}}if(d.length>2000){return this.validationError("#comment-error","The comment is too long, only 2000 characters are possible.");}return true;},validationError:function(a,b){$j(a).html(b);return false;},_reenable:function(a){BS.Util.reenableForm(this.formElement());this.setTitle(a);if(!$j($(this.getContainer())).is(":visible")){this.getInnerContainer().innerHTML="";}},_loadContent:function(a,d,c){var b=this;BS.Util.show(this.getLoadingElement());BS.ajaxRequest(a,{method:"POST",parameters:d,onComplete:function(e){BS.Util.hide(b.getLoadingElement());$j(b.getInnerContainer()).html(e.responseText);b.showCentered();if(b._savedState){b._restoreForm();return;}if(c){setTimeout(function(){b._updateToFixedState();},500);}}});},_updateToFixedState:function(){var a=function(b){var d=$j(b).prop("checked");if(!d){$j(b).click();$j(b).trigger("change");var c=$j(b).next("label")[0];c&&new Effect.Highlight(c);}};a("#fix-investigate");a("#unmute-mute");$j("#investigate-comment").focus();$("submit").enable();},_submit:function(a){var b=this,c=$j("#investigate-saving");c.show();BS.FormSaver.save(this,a,OO.extend(BS.ErrorsAwareListener,{onSuccessfulSave:function(){c.hide();b.close();if(!b._withoutReload){b.smartReload();}if(typeof b._submitHandler==="function"){b._submitHandler();}},onGeneralError:function(d){alert(d.firstChild.nodeValue);}}));return false;},_dialogClass:function(c,b){var a=$j(this.getContainer());if(c){a.addClass(b);}else{a.removeClass(b);}},setTitle:function(a){$j("#muteTestsFormTitle").html(a);},getQuery:function(){var b=window.location.search.substring(1),d=b.split("&"),c={};for(var a=0;a<d.length;a++){var e=d[a].split("=");c[e[0]]=e[1];}return c;},reopenBuildResultsPopup:function(){var d=$j("div.summaryContainer").filter(":visible").parent();if(!d.length){return false;}var c=d.attr("id");var a=d.position();if(!c||!a){return false;}var b=BS.BuildResultsPopupTracker(c.substr("popupRes".length)).getPopup();if(!b){return false;}BS.Hider.hideAll();b._showWithDelay(a.left,a.top);return true;},smartReload:function(){var a=window.location.href,d=window["base_uri"];if(!a.startsWith(d)){return this.fallbackReload();}a=a.substr(d.length);var e=this.getQuery(),c=e["tab"];if(a.startsWith("/viewChain.html")||c=="buildTypeChains"||c=="projectBuildChains"||c=="dependencies"){return this.reloadSubtree("allChains");}if(a.startsWith("/viewLog.html")){return this.reloadSubtree("buildResults");}if(a=="/"||a.startsWith("/overview.html")||(a.startsWith("/project.html")&&(!c||c=="projectOverview"))||(a.startsWith("/viewType.html"))){if(this.reopenBuildResultsPopup()){return;}return this.fallbackReload();}if(a.startsWith("/project.html")){if(c==="flakyTests"){if(BS.FlakyTestDetector){BS.FlakyTestDetector.refreshSortablesNoArgs();return;}else{BS.Log.warn("BS.FlakyTestDetector unavailable; sort order may not be preserved.");return this.reloadSubtree("flakyTests");}}return this.reloadSubtree("projectContainer");}if(a.startsWith("/changes.html")){if(this._lastTestId){var b=$("testNameId"+this._lastTestId).up(".refreshable");return this.reloadSubtree(b);}return this.fallbackReload();}return this.fallbackReload();},reloadSubtree:function(c){var a=$(c),b=$("loadingWarning");if(b){b.style.display="block";}a.refresh(null,null,function(){if(b){b.style.display="none";}});BS.Hider.hideAll();},fallbackReload:function(){BS.reload(true);},checkUserPermissionsOnChange:function(a){BS.ResponsibilityCommon.checkUserPermissionsOnChange($j("#test-investigation-warning"),$j("#investigator"),a);}}));BS.BulkInvestigateMuteTestDialog=OO.extend(BS.BulkInvestigateDialog,{_submitUrl:"/tests/bulkInvestigate.html",show:function(e,h,g,a,f){var i=_.size(e);if(e["projectId"]){--i;}var c=(h?"Fix ":"Investigate / Mute ")+i+" Test"+(i==1?"":"s");if(g){var b=0;for(var d in e){if(e.hasOwnProperty(d)&&g[d]){b++;}}if(b!==0){e["remove-investigation"]=1;e["unmute"]="M";e["comment"]=b===i?(i==1?"This test is flaky!":"All these tests are flaky!"):"Some of these tests are flaky!";}}return this._doShow(c,e,h,false,a,f);},showForTest:function(b,c,d,h,g,a){var f=g?"Fix 1 Test":"Investigate / Mute 1 Test";var e={};e[b]=c;e["projectId"]=h||BS.TestGroup.findProjectIdByGroupId(d);if(a){if(typeof a.responsibilityRemovalMethod==="number"){e["remove-investigation"]=a.responsibilityRemovalMethod;}else{if(typeof a.responsibilityRemovalMethod==="string"){e["remove-investigation"]=parseInt(a.responsibilityRemovalMethod);}}if(a.unmuteOptionType){e["unmute"]=a.unmuteOptionType;}if(a.investigatorId){e["investigatorId"]=a.investigatorId;}if(a.comment){e["comment"]=a.comment;}}this._lastTestId=b;return this._doShow(f,e,g);},showForBuildProblem:function(d,a,g,b,c){var f=g?"Fix 1 Build Problem":"Investigate / Mute 1 Build Problem";var e={};e["BuiPro"+d]=a;return this._doShow(f,e,g,false,b,c);},reloadDialog:function(){var a=this._lastShowArgs;a.params["projectId"]=$j("#scopeProjectId").val();a.params["origProjectId"]=$j("#scopeProjectId")[0].form.origProjectId.value;this._saveForm();return this._doShow(a.title,a.params,a.fixMode,true,this._withoutReload);},_saveForm:function(){var b={};var a=$j("#mute-dialog-container");$j("select, textarea",a).not("#scopeProjectId").add("#unmute-time").each(function(){b[this.id]=$j(this).val();});$j("input[type=radio]",a).each(function(){b[this.id]=$j(this).is(":checked");});this._savedState=b;},_restoreForm:function(){var b=this._savedState;var a=$j("#mute-dialog-container");$j("select, textarea",a).not("#scopeProjectId").add("#unmute-time").each(function(){var c=$j(this),d=c.val(),e=b[this.id];if(d!=e){c.val(e).trigger("change");}});$j("input[type=radio]",a).each(function(){var c=$j(this),d=c.is(":checked"),e=b[this.id];if(d!=e){c.prop("checked",e).trigger("change");}});this._savedState=null;}});
/*---
/js/bs/changeBuildStatus.js
---*/
BS.ChangeBuildStatusDialog=OO.extend(BS.AbstractWebForm,OO.extend(BS.AbstractModalDialog,{formElement:function(){return $("changeBuildStatus");},getContainer:function(){return $("changeBuildStatusDialog");},showDialog:function(c,a,e,b){this.noReload=b;var d=(a?"successful":"failed");$("changeBuildStatusTitle").innerHTML="Mark build "+d+$$(".changeBuildStatus-why")[0].innerHTML;$("changeBuildStatusSubmitButton").value="Mark "+d;this.formElement().changeBuildStatus.value=c;this.formElement().status.value=a?"NORMAL":"FAILURE";this.showCentered();this.bindCtrlEnterHandler(this.submit.bind(this));this._activateComment();this.clearErrors();this.formElement().down(".changeBuildStatus-errorText").innerHTML="";this.formElement().down(".changeBuildStatus-warningText").innerHTML=!e?"Running build may overwrite the status change later":"";return new Promise(function(g,f){this._resolve=g;this._reject=f;}.bind(this));},_activateComment:function(){var a=this.formElement().comment;a.disabled=false;a.focus();a.select();},submit:function(){var a=this;BS.FormSaver.save(this,this.formElement().action,OO.extend(BS.ErrorsAwareListener,{onStatusError:function(b){this._processError(b);},onBuildError:function(b){this._processError(b);},onCommentError:function(b){a.highlightErrorField(a.formElement().comment);this._processError(b);a._activateComment();},_processError:function(b){a.formElement().down(".changeBuildStatus-errorText").innerHTML=b.firstChild.nodeValue;},onSuccessfulSave:function(){if(!a.noReload){BS.reload(true);}else{a.close();}if(a._resolve!=null){a._resolve();}},onFailure:function(){alert("Problem accessing server");}}));return false;},_f:null}));
/*---
/js/bs/tree.js
---*/
(function(){function a(){$j("ul.tree").each(function(){d(this);this.className=this.className.replace(/ ?unformatted ?/," ");});}function d(f){var l,k;var o,n,m;var h,q,g;for(l=0;l<f.childNodes.length;l++){if(f.childNodes[l].tagName&&f.childNodes[l].tagName.toLowerCase()=="li"){var p=f.childNodes[l];o=document.createElement("span");n=document.createElement("span");m=document.createElement("span");o.appendChild(n);n.appendChild(m);o.className="a "+p.className.replace("closed","spanClosed");o.onmouseover=function(){};n.className="b";n.onclick=e;m.className="c";q=p.childNodes.length;h=0;g=null;for(k=0;k<p.childNodes.length;k++){if(p.childNodes[k].tagName&&p.childNodes[k].tagName.toLowerCase()=="div"){h=k+1;continue;}if(p.childNodes[k].tagName&&p.childNodes[k].tagName.toLowerCase()=="ul"){g=p.childNodes[k];q=k;break;}}for(k=h;k<q;k++){m.appendChild(p.childNodes[h]);}if(p.childNodes.length>h){p.insertBefore(o,p.childNodes[h]);}else{p.appendChild(o);}if(g!=null){if(d(g)){$j(p).addClass("children");$j(o).addClass("children");}}}}if(p){$j(p).addClass("last");$j(o).addClass("last");return true;}else{return false;}}function e(i,j){i=this;while(i!=null&&(!i.tagName||i.tagName.toLowerCase()!="li")){i=i.parentNode;}var h=$j(i);var f=h.children("ul").get(0);var g=h.children("span").get(0);if(j!=null){if(j=="open"){c(g,i);}else{if(j=="close"){b(g,i);}}}else{if(f!=null){if(!i.className.match(/(^| )closed($| )/)){b(g,i);}else{c(g,i);}}}}function c(g,f){$j(g).removeClass("spanClosed");$j(f).removeClass("closed");}function b(g,f){$j(g).addClass("spanClosed");$j(f).addClass("closed");}window.autoInit_trees=a;})();BS.VCS={_vcsTreeHandlers:[],_vcsTreeCallbacks:[],registerTreePopup:function(c,e,h,b,a,d){var f=this;this.registerCallback(c,h,b);this._vcsTreeHandlers[c]=function(){BS.LazyTree.ignoreHashes=true;var j=window["base_uri"]+"/buildTypeVcsBrowser.html?lazy-tree-update=true&id="+e+"&treeId="+c;BS.LazyTree.treeUrl=f._applyAdditionalOptions(j,d);var i=new BS.Popup("vcsTreePopup",{hideOnMouseOut:false,hideOnMouseClickOutside:true,shift:{x:0,y:20},url:BS.LazyTree.treeUrl});i.showPopupNearElement($(a));};if(b){var g={updateVisibility:function(){if($j(BS.Util.escapeId(b)).is(":disabled")){$j(BS.Util.escapeId(a)).hide();}else{$j(BS.Util.escapeId(a)).show();}}};BS.VisibilityHandlers.attachTo(b,g);}},showTree:function(a){(this._vcsTreeHandlers[a])();},registerTree:function(a,b,d,f,c){var e=this;this.registerCallback(b,f);this._vcsTreeHandlers[b]=function(){BS.LazyTree.ignoreHashes=true;BS.LazyTree.treeUrl=window["base_uri"]+"/buildTypeVcsBrowser.html?lazy-tree-update=true&id="+d+"&treeId="+b;BS.LazyTree.treeUrl=e._applyAdditionalOptions(BS.LazyTree.treeUrl,c);BS.LazyTree.loadTree(a);};},_applyAdditionalOptions:function(b,a){if(a.vcsRootId){b+="&vcsRootId="+a.vcsRootId;}if(a.dirsOnly){b+="&dirsOnly="+a.dirsOnly;}if(a.rootDirName){b+="&rootDirName="+encodeURIComponent(a.rootDirName);}return b;},fileChosen:function(b,a,d){var c=this._vcsTreeCallbacks[a];if(c){c(b,d);}},registerCallback:function(b,c,a){if(a){this._vcsTreeCallbacks[b]=function(d,e){$j(BS.Util.escapeId(a)).val(d);BS.Highlight(e,{restorecolor:"#ffffff"});};}else{this._vcsTreeCallbacks[b]=function(h,k){var e=c.indexOf(".")!=-1;if(e){var g=c.split(".");var j=g[g.length-1];var f=window;for(var d=0;d<g.length-1;d++){f=f[g[d]];}f[j](h,b,k);}else{window[c](h,b,k);}};}return"BS.VCS.fileChosen";}};BS.LazyTree={treeUrl:null,ignoreHashes:false,options:{},getUrl:function(){var b=(this.treeUrl)?this.treeUrl:document.location.href;var a=b.indexOf("#");if(a>=0){b=b.substring(0,a);}return b;},getHash:function(){var a=window.location.hash;if(a){if(this.ignoreHashes||!a.startsWith("#!")){return"";}a=a.substring(2);}return a;},setHash:function(a){if(!this.ignoreHashes){window.location.hash="#!"+a;}},loadTree:function(a){var b=this;a=$(a);this.initNavigation(a);$j("<span>",{css:{display:"none"},html:BS.loadingIcon+"&nbsp;Loading...",appendTo:a}).fadeIn("slow");BS.ajaxRequest(b.getUrl(),{parameters:"lazy-tree-update=1&lazy-tree-open="+b.getHash(),method:"get",onComplete:function(d){a.innerHTML="";a.insert(d.responseText);var c=$j(a);if(b.options.fullWidthClick){c.addClass("tree-full-width-click");}c.find("a:first").focus();$j(document).trigger("bs.treeLoaded",[a,b.options]);}});},toggleShow:function(b){var a=$("U"+b);if(a){if(a.visible()){a.hide();this.updateClass(b,"open","closed");this.removeHash(b);if(this.isErrorNode(a)){a.remove();}}else{a.show();this.updateClass(b,"closed","open");this.addHash(b);}}else{if(this.updateClass(b,"closed","open")){this.loadSubtree(b);this.addHash(b);}}},updateClass:function(d,c,b){d=$(d);var a=d.className.split(" ");if(a.indexOf(c)==-1&&a.indexOf(b)!=-1){return false;}a.splice(a.indexOf(c),1);a.push(b);d.className=a.join(" ");return true;},addHash:function(b){var a=this.getHash();if(!a){this.setHash(b);}else{this.setHash(a+","+b);}},removeHash:function(d){var c=this.getHash();if(!c){return;}var b=c.split(",");var a=b.indexOf(d);if(a>=0){b.splice(a,1);}this.setHash(b.join(","));},loadSubtree:function(e){var b=$(e);var a=this;var d=$j("<i/>").css({marginLeft:"16px",display:"none"}).append(BS.loadingIcon).append("&nbsp;Loading...").appendTo(b);setTimeout(function(){d.show();},200);var c=[];while(b&&b.className.lastIndexOf("lazy-tree")==-1){if(b.className.lastIndexOf("lazy-subtree")==-1){c.push(b.id);}b=b.parentNode;}c.reverse();BS.ajaxRequest(this.getUrl(),{parameters:"lazy-tree-update=1&lazy-tree-root="+e+"&lazy-tree-path="+c.join(","),method:"get",onComplete:function(g){d.remove();var f=$(e);if(f){$(e).insert(g.responseText);$j(document).trigger("bs.subtreeLoaded",[$(e),a.options]);}}});},isErrorNode:function(b){var a=b.childNodes;return a&&a.length==1&&a[0].className=="tree-error";},initNavigation:function(c){c=$j(c);var b=c.attr("id");function f(i){return i.hasClass("open");}function d(i){return i.hasClass("leaf");}function h(k,j){if(k.attr("id")==b){return null;}var i;if(j&&f(k)){i=k.children("div:visible:first");if(i.length){return i;}}i=k.next();if(i.length){return i;}return h(k.parents("div:visible:first"),false);}function a(k){var i=k.prev();if(i.length){var j=i.find("div:visible:last");if(j.length){return j;}return i;}i=k.parents("div.open:visible:first");if(i.length){return i;}return null;}function e(j){if(!f(j)&&!d(j)){var i=j.attr("id");if(i){BS.LazyTree.toggleShow(i);}}return null;}function g(j){if(f(j)&&!d(j)){var i=j.attr("id");if(i){BS.LazyTree.toggleShow(i);}}return null;}c.on("keydown",function(l){var k=l.keyCode;if(k!=Event.KEY_DOWN&&k!=Event.KEY_UP&&k!=Event.KEY_RIGHT&&k!=Event.KEY_LEFT){return true;}var j=c.find(":focus");if(!j.length){return true;}var m=j.closest("div");var i;switch(k){case Event.KEY_DOWN:i=h(m,true);break;case Event.KEY_UP:i=a(m);break;case Event.KEY_RIGHT:i=e(m);break;case Event.KEY_LEFT:i=g(m);break;}if(i){i.find("a:first").focus();}return false;});if(this.options.fullWidthClick){c.on("click",".a",function(m){var j=$j(m.target);if(j.prop("tagName")!=="A"&&!j.attr("onclick")){var k=$j(m.currentTarget);if(!k.attr("onclick")){var i=k.find("a:first");if(i.length){var l=i.attr("href");if(l){window.location.href=l;}}}}});}}};BS.FileBrowse={onFileChanged:function(a){},error:function(a){this.setSaving(false);$j("#uploadError").text(a).show();},clear:function(){var a=$j(this.getContainer());a.find("input[type=file]").val("");$j("#uploadError").hide();},show:function(){this.clear();this.showCentered();return false;},validate:function(){var c=$j("#fileName").val(),b=$j("#file\\:fileToUpload").val();if(c==""){this.error("Please set the file name");return false;}var a=$j("#destination");if((!a.length||a.val()==a.attr("default"))&&!this.checkFileNotExists(c)){return false;}if(b==""){this.error("Please select a file to upload");return false;}this.setSaving(true);return true;},deleteFile:function(c,d,b,e){var a=(!b)?'Delete "'+e+'"?':b+"\n"+"Delete anyway?";if(!confirm(a)){return false;}BS.ajaxRequest(c,{method:"post",parameters:{action:"delete",fileName:e},onComplete:function(){document.location.href=d;
}});return false;},startEdit:function(){var a=this._toggleEdit();a.focus();return false;},_toggleEdit:function(){var a=$j("#edit-area").toggle().siblings(".fileContent").toggle().end();$j(".fileOperations").toggle();$j("#modifiedMessage").toggle();return a;},cancelEdit:function(){this._toggleEdit();},save:function(a,b){BS.ajaxRequest(a,{method:"post",parameters:{action:"edit",fileName:b,content:$j("#edit-area").val()},onComplete:function(){BS.reload();}});},setFiles:function(b,a){this.files=b;this.caseInsensitiveFileNames=a;},prepareFileUpload:function(){var b=this.onFileChanged;var a=$j(this.getContainer()),d=false,c="";$j("#fileName").on("input",function(){c=this.value;d=!!this.value.length;return false;});if(window.attachEvent){$j("#fileName").on("keyup change",function(){if(!this.value.length){d=false;}else{if(this.value!==c){d=true;c=this.value;}}});}a.find("input[type=file]").change(function(){var f=$j(this).val();if(f&&!d){var g=(f.indexOf("\\")>=0?f.lastIndexOf("\\"):f.lastIndexOf("/"));var e=f.substring(g);if(e.indexOf("\\")===0||e.indexOf("/")===0){e=e.substring(1);}$j("#fileName").val(e);b(e);}});},checkFileNotExists:function(b){for(var a=0;a<this.files.length;++a){if(b==this.files[a]||(this.caseInsensitiveFileNames&&b.toUpperCase()==this.files[a].toUpperCase())){return confirm('File "'+b+'" already exists. Replace it?');}}return true;},closeAndRefresh:function(a){this.setSaving(false);this.close();$j("#refreshing").show();this.refresh(a);},autoRunOperation:function(a){var c=window.location.hash;if(c&&!c.startsWith("#!")){var b=this;$j(function(){if(a&&c.startsWith("#edit")){b.startEdit&&b.startEdit(a);}if(c.startsWith("#upload")){var d=$j("#destination");var e=c.substr(7);if(e.startsWith(":")){e=e.substr(1);}if(e.include("!")){e=e.substr(0,e.indexOf("!"));}if(e){var f=d.val();if(!f.endsWith("/")){f+="/";}f+=e;d.val(f);}b.show&&b.show();}});if(c.include("!")){window.location.hash="#"+c.substr(c.indexOf("!"));}else{window.location.hash="";}}}};
/*---
/js/bs/issues.js
---*/
BS.IssueDetails=function(b,c,a,d){BS.Popup.call(this,b,{issueId:c,providerId:a,projectExternalId:d,shift:{x:-80},zIndex:200,url:window["base_uri"]+"/issueDetailsPopup.html?"+Object.toQueryString({issueId:c,providerId:a,projectId:d})});};_.extend(BS.IssueDetails.prototype,BS.Popup.prototype);
/*---
/js/bs/pluginProperties.js
---*/
BS.PluginPropertiesForm=OO.extend(BS.AbstractWebForm,{serializeParameters:function(){var e=BS.Util.serializeForm(this.formElement());var f=BS.Util.getPasswordInputs(this.formElement());if(!f){return e;}for(var c=0;c<f.length;c++){var b=f[c].name;if(b.indexOf("prop:")!=0){continue;}var a="prop:encrypted:"+f[c].id;e+="&"+a+"=";var d=$(a).value;if(d==""||f[c].value!=f[c].defaultValue){d=BS.Encrypt.encryptData(f[c].value,this.formElement().publicKey.value);}e+=d;}return e;},propertiesErrorsHandler:function(b,a){BS.PluginPropertiesForm.showError(b,a.firstChild.nodeValue);},showError:function(d,c){var a=$(d),b=$("error_"+d);if(b){b.innerHTML=c.escapeHTML();}if(a&&a.type&&(a.type=="text"||a.type=="password")){a.addClassName("errorField");}}});BS.MultilineProperties={init:function(b,c,a,d){BS.MultilineProperties.addProperty(b,c,function(i){var h=document.getElementById(b);var l=$j(h);if(c){var g=h.value.split("\n").length;var e=BS.CodeMirror.fromTextArea(h,{lineWrapping:a,mode:d,autofocus:i===true,readOnly:h.disabled});l.data("cm",e);e.on("change",function(){l.trigger("cm-change",e.getValue());});l.on("cm-set-value",function(n,m){e.setValue(m);e.refresh();});l.on("cm-show",function(n,m){e.refresh();});if(h.form){var k=h.form.onsubmit;if(k){h.form.onsubmit=function(){e.save();return k.apply(this,arguments);};}}var j=h.getAttribute("onkeydown");if(j!=null){e.on("keydown",new Function("_","event",j));}e.on("beforeChange",function(n,p){var m=p.text.some(function(q){return/\u00A0/.test(q);});if(m){var o=p.text.map(function(q){return q.replace(/\u00A0/g," ");});p.update(null,null,o);}});var f=document.getElementById("wrapToggle");f.addEventListener("click",function(){a=!a;f.classList[a?"add":"remove"]("wrapToggleOn");e.setOption("lineWrapping",a);BS.User.setBooleanProperty("wrapLines",a);});if(l.data("editableObjId")!=null){BS.AvailableParams.initAutocompleteOnCMFocus(h);}}else{l.off("keypress paste").on("keypress paste",function(){BS.MultilineProperties.sanitize(this);});}});},_init:function(){if(!this._properties){this._properties=[];}},_findProperty:function(a){for(var b=0;b<this._properties.length;b++){var c=this._properties[b];if(c.name==a){return c;}}return null;},clearProperties:function(){this._properties=null;},addProperty:function(a,b,e){this._init();var c=this._findProperty(a);if(c){c.visible=false;c.codeMirror=b;c.initFunc=e;}else{var d={};this._properties.push(d);d.visible=false;d.name=a;d.codeMirror=b;d.initFunc=e;}},setVisible:function(a,c){var b=this._findProperty(a);if(b){b.visible=c;}},isVisible:function(a){var b=this._findProperty(a);if(b){return b.visible;}return false;},updateVisible:function(){var a=this;if(this._properties){this._properties.forEach(function(b){b.visible&&a.doShow(b.name,false);});}BS.VisibilityHandlers.updateVisibility("mainContent");},show:function(b,a){this.doShow(b,a);BS.MultilineProperties.setVisible(b,true);BS.MultilineProperties.updateVisible();},doShow:function(a,i){var h=this._findProperty(a);if(!h){return;}var b=$(a+"_Container");if(!b){return;}var c=$(a+"_LinkContainer");var g=c?BS.Util.hide(c):Promise.resolve();var d=$(a+"_NoteContainer");if(d){d.style.opacity=0;BS.Util.show(d);g.then(function(){d.style.opacity=1;});}var f=$(a);if(!b){return;}var e=$("note_"+a);if(e&&e.hasClassName("smallNote_hidden")){e.removeClassName("smallNote_hidden");}if(h.initFunc&&!h.inited){b.style.opacity=0;b.style.height=0;}BS.Util.show(b);ReactUI.onShow(b,function(){if(h.initFunc&&!h.inited){h.initFunc(i);h.inited=true;b.style.opacity=null;b.style.height=null;}if(!h.codeMirror){b.style.width=null;b.style.height=null;if(i&&!f.disabled){f.focus();}}});},sanitize:function(a){if(a.value.match(/\u00A0/)){a.value=a.value.replace(/\u00A0/g," ");}}};Event.observe(window,"resize",function(){BS.MultilineProperties.updateVisible();});
/*---
/js/bs/serverLink.js
---*/
BS.ServerUnavailableModalDialog=OO.extend(BS.AbstractModalDialog,{zIndex:1000,_wasClosed:false,_disabled:false,_getCurrentDate:function(){var c=new Date();var b=(c.getHours()<10)?("0"+c.getHours()):c.getHours();var a=(c.getMinutes()<10)?("0"+c.getMinutes()):c.getMinutes();return $j.datepicker.formatDate("dd M yy",c)+" "+b+":"+a;},getContainer:function(){return $("shutdownDialog");},available:function(){return $("shutdownDialog");},displayShutdownNote:function(){if(this._shutdownNoteIsDisplayed||this._wasClosed||this._disabled||!$("shutdownDialog")){return;}this._shutdownNoteIsDisplayed=true;BS.Util.hide("onCommunicationFailure");BS.Util.hide("onAuthFailure");BS.Util.show("onServerShutdown");$("shutdownDetails").innerHTML="Server is unavailable since "+this._getCurrentDate();this.showCentered();},displayFailureNote:function(){if(this._failureNoteIsDisplayed||this._wasClosed||this._disabled||!$("shutdownDialog")){return;}this._failureNoteIsDisplayed=true;BS.Util.hide("onServerShutdown");BS.Util.hide("onAuthFailure");BS.Util.show("onCommunicationFailure");$("shutdownDetails").innerHTML="Server is unavailable since "+this._getCurrentDate();this.showCentered();},displayAuthFailureNote:function(){if(this._authFailureNoteIsDisplayed||this._wasClosed||this._disabled||!$("shutdownDialog")){return;}this._authFailureNoteIsDisplayed=true;BS.Util.hide("onServerShutdown");BS.Util.hide("onCommunicationFailure");BS.Util.show("onAuthFailure");$("shutdownDetails").innerHTML="You are logged out since "+this._getCurrentDate();this.showCentered();},afterClose:function(){this._wasClosed=true;},reset:function(){this._wasClosed=false;this._shutdownNoteIsDisplayed=false;this._failureNoteIsDisplayed=false;this._authFailureNoteIsDisplayed=false;},disable:function(){this._disabled=true;},enable:function(){this._disabled=false;}});BS.ServerLink=OO.extend(BS.AbstractModalDialog,{_shutdown:false,_failuresNum:0,_authFailureNums:0,_onMaintenanceMode:null,_scheduleReloadAfterServerRestart:function(b){if(!this._reloadTimeout){var a=Math.floor((Math.random()*60)+30);BS.Log.info(b+", page will be reloaded in "+a+" seconds.");this._reloadTimeout=setTimeout(function(){BS.reload(true);},a*1000);}},_onFailure:function(){if(++this._failuresNum>1){if(this._shutdown){BS.ServerUnavailableModalDialog.displayShutdownNote();}else{BS.ServerUnavailableModalDialog.displayFailureNote();}}},_onAuthFailure:function(){this._authFailureNums++;if(this._authFailureNums>3){BS.ServerUnavailableModalDialog.displayAuthFailureNote();}if(!this._tryToAuthenticateIframe){BS.Log.info("Opening iframe");this._tryToAuthenticateIframe=document.createElement("iframe");this._tryToAuthenticateIframe.setAttribute("src",window["base_uri"]+"/authenticationTest.html");this._tryToAuthenticateIframe.setAttribute("style","width:0;height:0;border:0; border:none; visibility:hidden; position:absolute");document.body.appendChild(this._tryToAuthenticateIframe);}else{if(this._authFailureNums%5===0){document.body.removeChild(this._tryToAuthenticateIframe);this._tryToAuthenticateIframe=null;}}},_onSuccess:function(){this._shutdown=false;this._failuresNum=0;this._authFailureNums=0;BS.Log.info("The server is available again");if(this._tryToAuthenticateIframe){document.body.removeChild(this._tryToAuthenticateIframe);this._tryToAuthenticateIframe=null;BS.CSRF.refreshCSRFToken();}if(BS.ServerUnavailableModalDialog.available()){BS.Log.info("Closing 'Server Unavailable' dialog");BS.ServerUnavailableModalDialog.close();BS.ServerUnavailableModalDialog.reset();}},onShutdown:function(){this._shutdown=true;},isConnectionAvailable:function(){return this._failuresNum==0&&this._authFailureNums==0;},getTotalFailuresNum:function(){return this._failuresNum+this._authFailureNums;},subscribeOnMaintenanceMode:function(a){this._onMaintenanceMode=a;},unsubscribeOnMaintenanceMode:function(){this._onMaintenanceMode=null;},waitUntilServerIsAvailable:function(c){var a=this;var b=BS.periodicalExecutor(function(){var d=$j.Deferred();a.getServerInfo(function(f){if(f.status==200){var g=f.responseXML.documentElement;if(!g){BS.Log.error("Successful connection from the server with unknown version");d.resolve();return;}var e=g.getAttribute("buildNumber");var h=g.getAttribute("startTime");if(e!=a._buildNumber){b.stop();return;}if(h!=a._serverStartTime){BS.Log.info("Server was restarted ("+a._serverStartTime+" -> "+h+")");BS.CSRF.refreshCSRFToken();}a._onSuccess();b.stop();c();}else{if((f.status==503||f.status==502)&&a._onMaintenanceMode){a._onMaintenanceMode();}if(f.status==401){a._onAuthFailure();}else{a._onFailure();}d.resolve();}});return d;},BS.internalProperty("teamcity.ui.serverAvailability.pollInterval")*1000);setTimeout(b.start.bind(b),BS.internalProperty("teamcity.ui.serverAvailability.pollInterval")*1000);},getServerInfo:function(a){BS.ajaxRequest(window["base_uri"]+"/app/rest/ui/server?fields=startTime,buildNumber",{method:"GET",onComplete:function(c){if(c.status==200){var d=c.responseXML.documentElement;if(!d){return;}var b=d.getAttribute("buildNumber");if(BS.ServerLink._buildNumber!=null&&b!=BS.ServerLink._buildNumber){BS.ServerLink._scheduleReloadAfterServerRestart("Server was upgraded ("+BS.ServerLink._buildNumber+" -> "+b+")");}}if(a!=null){a(c);}}});},init:function(){var a=this;this.getServerInfo(function(b){if(b.status==200&&b.responseXML){var c=b.responseXML.documentElement;a._buildNumber=c.getAttribute("buildNumber");a._serverStartTime=c.getAttribute("startTime");BS.Log.info("Server version: "+b.responseText);}});}});$j(document).ready(function(){setInterval(BS.ServerLink.getServerInfo,25*60*1000);BS.ServerLink.init();});
/*---
/js/bs/activation.js
---*/
(function(){function a(e,d){this.id=e;this.url=d+"&noCache="+(new Date()).getTime()+"&server="+window["base_uri"];}a.prototype.done=function(d){this.indicator.style.backgroundColor=d;if(this.oncomplete){this.oncomplete(this.status);}};a.prototype.doneR=function(){if(window.opera||/loaded|complete/.test(this.transport.readyState)){this.status=1;this.doneL();}};a.prototype.doneL=function(){this.status=this.status|this.transport.width;if(this.status>0){this.done("green");}else{this.done("orange");}};a.prototype.doneE=function(){this.status=-1;this.done("silver");};a.prototype.go=function(){this.transport=document.getElementById(this.id);this.parent=document.getElementById(b.PANELID);if(this.transport){this.dispose();}this.transport=new Image();this.transport.id=this.id;if(BS.Browser.opera){this.transport.onreadystatechange=this.doneR.bind(this);}else{this.transport.onload=this.doneL.bind(this);}this.transport.onerror=this.doneE.bind(this);this.transport.onabort=this.doneE.bind(this);this.transport.style.display="none";this.indicator=document.createElement("div");this.indicator.className="activationIndicator";this.indicator.appendChild(this.transport);this.parent.appendChild(this.indicator);this.transport.src=this.url;};a.prototype.dispose=function(){if(BS.Browser.opera){this.transport.onreadystatechange=function(){};}else{this.transport.onload=function(){};}this.transport.onerror=function(){};this.transport.onabort=function(){};if(this.transport.parentNode){this.transport.parentNode.removeChild(this.transport);}if(this.indicator&&this.indicator.parentNode){this.indicator.parentNode.removeChild(this.indicator);}};function c(k){this.panel=document.getElementById(b.PANELID);if(!this.panel){this.parent=document.getElementsByTagName("body").item(0);this.panel=document.createElement("div");this.panel.className=b.PANELID;this.panel.setAttribute("id",b.PANELID);this.parent.appendChild(this.panel);this.panel.style.display="block";}this.sequential=BS.Browser.webkit;this.id="id_"+Math.random();var j=63330;var e=j+9;var d="http://127.0.0.1";this.responseCount=0;this.successes=0;this.connects=0;this.requests=new Array(e-j);var g=this.done.bind(this);for(var f=j;f<=e;f++){var h=d+":"+f+"/"+k;var i=new a("r_"+this.id+"_"+f,h);i.oncomplete=g;this.requests[f-j]=i;if(!this.sequential){i.go();}}this.index=0;if(this.sequential){this.go();}}c.prototype.go=function(){this.requests[this.index++].go();};c.prototype.done=function(d){this._processingResponse=true;if(this._timeout){clearTimeout(this._timeout);}this.responseCount++;if(d>=0){this.connects++;}if(d>0){this.successes++;}if(this.responseCount>=this.requests.length){this._timeout=setTimeout(this.notify.bind(this),2000);}this._processingResponse=false;if(this.sequential&&(this.index<this.requests.length)){this.go();}};c.prototype.notify=function(){if(this._processingResponse){return;}if(this.successes==0){if(this.connects==0){BS.ErrorDialog.showNoIdeRespondedError();}else{BS.ErrorDialog.showCanNotFindFileError();}}if(this.panel&&this.panel.parentNode&&this.panel.childElementCount<=this.requests.length){this.panel.parentNode.removeChild(this.panel);}this._timeout=null;for(var d=0;d<this.requests.length;d++){this.requests[d].oncomplete=function(){};this.requests[d].dispose();}};var b={};b.PANELID="activationPanel";b.doOpen=function(d){new c(d);};BS.Activator=b;})();BS.ErrorDialog=OO.extend(BS.AbstractWebForm,OO.extend(BS.AbstractModalDialog,{getTitle:function(){return $("errorFormTitle");},getContainer:function(){return $("errorFormDialog");},formElement:function(){return $("errorForm");},getBody:function(){return $j("#errorFormDialog").find("div.modalDialogBody").get(0);},show:function(b,a){this.getTitle().innerHTML=b;this.getBody().innerHTML=a;this.showCentered();},showNoIdeRespondedError:function(){var a="<div>"+"<div>Make sure TeamCity plugin is installed, and you are logged in to TeamCity from within the IDE.</div>"+"<br>"+"<div>"+"You can download the plugin using one of these links:"+"<ul>"+"<li><a title='Download plugin for IntelliJ Platform IDEs' "+"href='"+window["base_uri"]+"/update/TeamCity-IDEAplugin.zip'>IntelliJ Platform plugin</a></li>"+"<li><a title='Download Addin for Visual Studio' "+"href='"+window["base_uri"]+"/update/vsAddinWebInstaller.exe'>Addin for Visual Studio</a></li>"+"<li><a title='Copy the link location and use it as the Eclipse update site' "+"href='"+window["base_uri"]+"/update/eclipse/'>Eclipse Plugin (update link)</a></li>"+"</ul>"+"</div>";if(window.opera){a+="<div>You seem to be using the Opera browser. Please <a href='#' id='allowOperaXSS'>click here</a> to allow Opera to connect to TeamCity and try again.</div>";}a+="</div>";this.show("No IDE responded",a);$j("#allowOperaXSS").click(function(){$j('<iframe src="http://127.0.0.1:63330/file" style="position: fixed; width: 100%; height: 300px; top: 0; z-index: 1000"/>').appendTo(document.body);return false;});},showCanNotFindFileError:function(){var a="<div>IDE cannot locate the requested file.</div>";this.show("Error",a);}}));
/*---
/js/bs/datepicker.js
---*/
(function(b){var a=b.datepicker._gotoToday;b.datepicker._gotoToday=function(c){var e=b(c);var d=this._getInst(e.get(0));a.call(this,c);b.datepicker._selectDate(c,b.datepicker._formatDate(d,d.selectedDay,d.selectedMonth,d.selectedYear));};})(jQuery);
/*---
/js/bs/tags.js
---*/
BS.TagsEditingMixin={init:function(a){var b=a.afterClose;a.afterClose=function(){b&&b.call(a);BS.TagsEditingMixin.afterClose.call(a);};a.showTags=function(f,c,d){if(ReactUI){ReactUI.renderTagsFilters(this.formId+"_availableTags",{buildTypeId:d,onSelect:BS.Tags.triggerAppendTags,suppressLabel:true});}else{$(this.formId+"_availableTags").innerHTML="";if($(f)){$(this.formId+"_availableTags").innerHTML=$(f).innerHTML;var e=$j($(this.formId+"_availableTags")).find(".all-tags-switch");e.attr("id",e.attr("data-id"));}}if(c){$j(BS.Util.escapeId(this.formId)+" .tagsApplyAll").show();}$j(document).off("bs.appendTag").on("bs.appendTag",function(h,g){a.appendTag(g);});};},afterClose:function(){$j(document).off("bs.appendTag");$j(BS.Util.escapeId(this.formId+"_availableTags")).find(".all-tags-switch").removeAttr("id");}};BS.Tags=OO.extend(BS.AbstractModalDialog,{formId:"editBuildTagsForm",getContainer:function(){return $(this.formId+"Dialog");},showEditDialog:function(i,d,g,j,f,c,a){var b=$(this.formId);var e=this;b.editTagsForPromotion.value=i;b.buildTagsInfo.value=d;$("editBuildTagsFormTitle").innerHTML='Edit tags for build&nbsp;<span id="editTagsBuildNumber"></span>';ReactUI.renderBuildNumber("editTagsBuildNumber",{buildId:i,hideStar:true,withLink:true,className:"titleBuildNumber"});var h=b.buildPrivateTagsInfo;if(h){h.value=g;}this.showTags(f,j,a);this.showCentered();$j("#buildTagsInfoEditTags").focus();this.bindCtrlEnterHandler(this.submitTags.bind(this));this._doNotReload=c;if(c){return new Promise(function(l,k){e._resolve=l;e._reject=k;});}return false;},triggerAppendTags:function(a){$j(document).trigger("bs.appendTag",a);},appendTag:function(a){BS.Util.addWordToTextArea($j(BS.Util.escapeId(this.formId)+" textarea")[0],a);},submitTags:function(){var a=$(this.formId);var b=this;Form.disable(a);BS.Util.show("savingTags");BS.ajaxRequest(a.action,{parameters:BS.Util.serializeForm(a),onFailure:function(){b._reject&&b._reject();},onComplete:function(){BS.Util.hide("savingTags");BS.Tags.close();if(!b._doNotReload){BS.reload(true);}Form.enable(a);b._resolve&&b._resolve(a.querySelector("#buildTagsInfoEditTags").value.replace(/\n/g," ").replace(/ +/g," ").trim().split(" "));}});return false;}});BS.TagsEditingMixin.init(BS.Tags);BS.FavoriteBuilds={loadingMore:false,tagBuild:function(f,e,c,b){var a=$j("#"+c).hasClass("addToFavorite");var d=document.createElement("form");d.innerHTML="<input type='hidden' value='"+e+"' name='favoriteBuild'/><input type='hidden' value='"+a+"' name='makeFavorite'/>";BS.ajaxRequest(f,{parameters:BS.Util.serializeForm(d),onComplete:function(){if(b){BS.reload(true);}else{if(a){$j("#"+c).removeClass("addToFavorite");}else{$j("#"+c).addClass("addToFavorite");}}}});},loadMore:function(){if(this.loadingMore){return;}this.loadingMore=true;$j("#showMoreFavoriteBuildsProgress").css("visibility","visible");$j("#count").val(parseInt($j("#count").val())+50);$j("#favoriteBuildsForm").submit();}};
/*---
/js/bs/backgroundLoader.js
---*/
BS.BackgroundLoader={_started:false,_requests:[],load:function(c,b,a){this._requests.push({placeholder:$j(c)[0],markupUrl:b,params:a});if(!this._started){this._started=true;this._computeNext();}},remove:function(c){var a=$j(c)[0];function b(d){return d.placeholder===a;}if(this._requests.some(b)){this._requests=this._requests.filter(function(d){return !b(d);});}},_computeNext:function(){var c=BS.BackgroundLoader;if(c._requests.length==0){c._started=false;return;}var b=c._requests.shift();var d=b.placeholder;if(!document.contains(d)){c._computeNext();}var a=b.markupUrl;BS.ajaxRequest(a,{method:"GET",parameters:Object.toQueryString(b.params),onSuccess:function(h){var e=h.responseText;if(e!==""&&document.contains(d)){var g=$j(d).attr("class");var f=$j(e);$j(d).replaceWith(f);if(g){$j(f).addClass(g);}}c._computeNext();},onFailure:function(e){BS.Log.error(e.responseText);c._computeNext();}});}};
/*---
/js/bs/bs-clipboard.js
---*/
BS.Clipboard=function(b,c){var a=new Clipboard(b,c||{});if(!(c&&c.skipDefaultHandlers)){a.on("success",function(d){BS.Tooltip.showMessage(d.trigger,{shift:{x:10,y:18},hideDelay:300},"Copied!");});a.on("error",function(d){BS.Tooltip.showMessage(d.trigger,{shift:{x:10,y:18},hideDelay:300},BS.Clipboard.fallbackMessage(d.action));});jQuery("body").on("mouseleave",b,function(){BS.Tooltip.hidePopup();});}return a;};BS.Clipboard.fallbackMessage=function(c){var a="";var b=c==="cut"?"X":"C";if(document.documentElement.classList.contains("ua-mac")){a="Press \u2318-"+b+" to "+c;}else{a="Press Ctrl-"+b+" to "+c;}return a;};BS.Clipboard.installGlobalHandler=function(){var a=function(c){var b=document.createElement("textarea");b.innerHTML=c;return b.value;};BS.Clipboard(".copy2Clipboard",{text:function(c){var d=c.getAttribute("data-clipboard-text");if(!d){var b=c.getAttribute("data-clipboard-id");if(b&&$(b)){d=a($(b).innerHTML);}}if(!d){d=c.innerHTML;}if(c.getAttribute("data-strip-tags")=="true"){d=d.replace(/<br\/?>\r?\n?/g,"\n").stripTags().trim();}return d;}});};
/*---
/js/bs/blocks.js
---*/
BS.Blocks=Class.create({_blocks:{},blocksType:"",collapsedByDefault:true,mustPersistState:true,initialize:function(){this._blocks={};},getBlockContentElement:function(a){},onHideBlock:function(a,b){},onShowBlock:function(a,b){},toggleBlock:function(b,a){this._realToggle(b,a);this._saveState();},restoreSavedBlocks:function(){if(!this.mustPersistState){return;}var b=BS.Blocks._saved[this.blocksType];if(!b){return;}var c=b.split(":");for(var a=0;a<c.length;a++){if(c[a]&&c[a]!="null"){this.changeState(c[a],true,this.collapsedByDefault);}}},_saveState:function(b){if(!this.mustPersistState){if($j.isFunction(b)){b();}return;}var c="";for(var a in this._blocks){c+=a+":";}BS.ajaxRequest(window["base_uri"]+"/ajax.html",{parameters:"blocksType="+this.blocksType+"&state="+c,onComplete:function(){if($j.isFunction(b)){b();}}});},_realToggle:function(d,a,b){b=b||"";var c=this.getBlockContentElement(d);if(!c){return;}BS.blockRefreshTemporary();if(b=="collapse"||this.isVisible(c)){this.changeState(d,a,false);}else{if(b=="expand"||!this.isVisible(c)){this.changeState(d,a,true);}}c=null;},isExpanded:function(b){var a=this.getBlockContentElement(b);if(!a){return false;}return this.isVisible(a);},changeState:function(d,a,b){var c=this.getBlockContentElement(d);if(!c){return;}if(b){this.doShow(d,c);if(this.collapsedByDefault){this._addBlockData(d);}else{this._deleteBlockData(d);}this.onShowBlock(c,d);}else{this.doHide(d,c);if(this.collapsedByDefault){this._deleteBlockData(d);}else{this._addBlockData(d);}this.onHideBlock(c,d);}},isVisible:function(a){return BS.Util.visible(a);},doShow:function(b,a){$j(a).show();},doHide:function(b,a){$j(a).hide();},_addBlockData:function(a){this._blocks[a]=true;},_deleteBlockData:function(a){delete this._blocks[a];}});BS.Blocks._saved={};BS.BaseMultiElementBlocks=new (Class.create(BS.Blocks,{collapsedIcon:"",expandedIcon:"",iterateHandles:function(b,a){},iterateBlocks:function(a){},collapseAll:function(){var a=this;this.iterateBlocks(function(b){if(a.isExpanded(b)){a._realToggle(b,true,"collapse");}});this._saveState();},expandAll:function(){var a=this;this.iterateBlocks(function(b){if(!a.isExpanded(b)){a._realToggle(b,true,"expand");}});this._saveState();},isVisible:function(a){return a.length&&BS.Util.visible(a[0]);},doShow:function(c,a){a.each(function(){BS.Util.show(this);});var b=this;this.iterateHandles(c,function(d){if($j(d).is("span.handle")){$j(d).removeClass("handle_collapsed").addClass("handle_expanded");}else{if(d){d.src=window["base_uri"]+b.expandedIcon;}}});},doHide:function(c,a){a.each(function(){BS.Util.hide(this);});var b=this;this.iterateHandles(c,function(d){if($j(d).is("span.handle")){$j(d).addClass("handle_collapsed").removeClass("handle_expanded");}else{if(d){d.src=window["base_uri"]+b.collapsedIcon;}}});}}))();
/*---
/js/bs/collapseExpand.js
---*/
BS.CollapsableBlocks={registerBlock:function(c,a){var b=this._blocks(a);var d=c.getId();b[d]=c;},unregisterBlocks:function(a){if(a){delete this._allBlocks[a];}},collapseAll:function(a,b){var d=this._blocks(b);for(var e in d){if(!d.hasOwnProperty(e)){continue;}var c=d[e];if(c.isExpanded(e)){if(c.hideBlock){c.hideBlock();}else{c.changeState(e,true,false);if(a){c._saveState();}}}}return false;},expandAll:function(a,b){var d=this._blocks(b);for(var e in d){if(!d.hasOwnProperty(e)){continue;}var c=d[e];if(!c.isExpanded(e)){if(c.showBlock){c.showBlock();}else{c.changeState(e,true,true);if(a){c._saveState();}}}}return false;},_blocks:function(a){a=a||"default";this._allBlocks[a]=this._allBlocks[a]||{};return this._allBlocks[a];},_allBlocks:{}};
/*---
/js/bs/blockWithHandle.js
---*/
BS.BlockWithHandle=Class.create(BS.Blocks,{initialize:function($super,c,b,e,d){var a;$super();this.blocksType=c+b;this.blockId=b;this.collapsedByDefault=e;if(!(a=this.getHandle())){return;}this._cssOnly=a.hasClassName("handle_collapsed")||a.hasClassName("handle_expanded");this.getHandle().on("click",this.toggle.bindAsEventListener(this));if(!d){this.restoreSavedBlocks();}},getId:function(){return this.blockId;},getHandle:function(){return $("blockHandle"+this.blockId);},toggle:function(){if(!this.getBlockContentElement(this.blockId)){this.getHandle().hide();return;}BS.blockRefreshTemporary();this.getHandle().show();if(this.getHandle().hasClassName("handle_expanded")){this.hideBlock();}else{this.showBlock();}},showBlock:function(){this.changeState(this.blockId,true,true);this._saveState();},hideBlock:function(){this.changeState(this.blockId,true,false);this._saveState();},onHideBlock:function(){var a=this.getHandle();if(a){a.removeClassName("handle_expanded").addClassName("handle_collapsed");}},onShowBlock:function(){var a=this.getHandle();if(a){a.removeClassName("handle_collapsed").addClassName("handle_expanded");}},getBlockContentElement:function(){return $("btb"+this.blockId);},_deleteBlockData:function(){this._blocks={};},_addBlockData:function(){this._blocks["_"]=true;}});(function(a){a.fn.make_collapsable=function(b){b=b||{};var d=b["registerForExpandAll"];var c=b["onStateChange"]||Prototype.emptyFunction;this.each(function(){if(this._simple_block){return;}$(this).identify();this._simple_block=new BS.SimpleBlock(this,this.getAttribute("data-blockId"),this.getAttribute("data-collapsedByDefault"),this.getAttribute("data-collapsed"),c);if(d){BS.CollapsableBlocks.registerBlock(this._simple_block,d);}});return this;};})(jQuery);BS.SimpleBlock=Class.create(BS.BlockWithHandle,{initialize:function($super,b,a,d,e,c){this.elementId=b.identify();this.onStateChange=c;if(!a){a=this.elementId;}if(e==null){$super(a,"",d);}else{$super(a,"",d,true);this.changeState(this.blockId,true,e!="true");}},getId:function(){return this.elementId;},getHandle:function(){return $(this.elementId).down(".handle");},getBlockContentElement:function(a){if(!$(this.elementId)){BS.Log.warn("Cannot find block element "+this.elementId);}return $(this.elementId).next();},onShowBlock:function($super,a,b){$super(a,b);$(this.elementId).addClassName("exp");this.onStateChange($(this.elementId),true);},onHideBlock:function($super,a,b){$super(a,b);$(this.elementId).removeClassName("exp");this.onStateChange($(this.elementId),false);}});BS.BuildTypeBlock=Class.create(BS.BlockWithHandle,{initialize:function($super,b,a){this.headerId=a+"-div";$super(b,a,false,true);},onShowBlock:function($super,a,b){$super(a,b);this.updateHeader(true);},onHideBlock:function($super,a,b){$super(a,b);this.updateHeader(false);},updateHeader:function(b){var e=BS.Util.escapeId(this.headerId),d=$j(e);if(d.length){d.toggleClass("exp");var c=d.find(".problemsSummary");if(b){c.hide();}else{c.show();}if(!b&&!c.length&&BS.ProblemsSummary){var a=this.blockId;BS.ProblemsSummary.requestBuildTypeUpdate(a);}}else{BS.Log.info("Could not find element "+this.headerId);}}});BS.ProjectBlock=Class.create(BS.BlockWithHandle,{initialize:function($super,b,a,d,c){this.projectId=a.substr("ovr_".length);this.projectExternalId=d;$super(b,a,c,false);this.clickOnHeaderShouldToggle();this._initialized=true;},clickOnHeaderShouldToggle:function(){var a=$("p_"+this.projectId).down(".projectHeader");a.on("click",function(c){var b=Event.element(c);if(!b.classList.contains("handle")&&b.tagName!="A"){this.toggle();}}.bindAsEventListener(this));},showBlock:function(){this.changeState(this.blockId,true,true);this._saveState(function(){if(this._initialized&&BS.lazyLoadProject){BS.lazyLoadProject(this.projectId,this.projectExternalId,!this.collapsedByDefault);}}.bind(this));},onShowBlock:function($super,b,c){var a=this.projectId;$super(b,c);jQuery("#ph_"+a).addClass("exp");},onHideBlock:function($super,b,c){$super(b,c);var a=this.projectId;jQuery("#ph_"+a).removeClass("exp");}});
/*---
/js/bs/blocksWithHeader.js
---*/
BS.BlocksWithHeader=Class.create(BS.Blocks,{blocksType:"blocks",collapsedByDefault:false,initialize:function($super,b,c){$super();this.blocksType="Block_"+b;var a=$(b);if(!a){return;}this.headerId=b;if(!a.title&&a.className.indexOf("no_title")==-1){a.title="Click to expand/collapse this block";}this.collapsedByDefault=a.className.indexOf("expanded")==-1;a.on("click",this._onclick.bindAsEventListener(this));a=null;if(!c){this.restoreSavedBlocks();}},getId:function(){return this.headerId;},show:function(){this.changeState(this.headerId,true,true);this._saveState();},_onclick:function(a){this.toggleBlock(this.headerId,false);},getBlockContentElement:function(c){var b=$(c);if(!b||!b.parentNode){return;}$(b.parentNode).cleanWhitespace();var a=b.nextSibling;if(!a){alert("No contentDiv for "+b.id);}return a;},onHideBlock:function(a,b){this._setHandleExpanded(b,false);},onShowBlock:function(a,b){this._setHandleExpanded(b,true);},_setHandleExpanded:function(g,b){var f=$(g);var e=b?/^collapsed_.+$/:/^expanded_.+$/;var d=b?/^collapsed/:/^expanded/;var c=b?"collapsed":"expanded";var a=b?"expanded":"collapsed";f.classNames().filter(function(h){return e.test(h);}).each(function(h){f.addClassName(h.replace(d,a));f.removeClassName(h);});f.addClassName(a);f.removeClassName(c);}});
/*---
/js/bs/adminActions.js
---*/
BS.SaveConfigurationListener=OO.extend(BS.ErrorsAwareListener,{onSaveProjectErrorError:function(a){alert(a.firstChild.nodeValue);},onProjectNotFoundError:function(){BS.reload(true);},onBuildTypeNotFoundError:function(){BS.reload(true);},onMaxNumberOfBuildTypesReachedError:function(a){alert(a.firstChild.nodeValue);}});BS.DisablingTriggerDialog=OO.extend(BS.AbstractModalDialog,{options:{},getContainer:function(){return $("disablingTriggerFormDialog");},formElement:function(){return $("disablingTriggerForm");},show:function(a){this.options=a;this.setTitle();this.setText();this.setButtonCaption();this.showCentered();},setTitle:function(){$j(this.getContainer()).find(".dialogTitle").text(this.options.title);},setText:function(){$j(this.getContainer()).find(".dialog_content").html(this.options.text);},setButtonCaption:function(){$j(this.getContainer()).find("#disableTriggerSubmit")[0].value=this.options.buttonCaption;},submitForm:function(){let removeQueued=this.formElement().removeQueued.checked;this.options.requestFunc(removeQueued);return false;}});BS.AdminActions={url:window["base_uri"]+"/admin/action.html",_doDeleteAjaxRequest:function(b,a){BS.ajaxRequest(this.url,{parameters:b,onComplete:function(d){var c=BS.XMLResponse.processErrors(d.responseXML,a);if(!c){BS.XMLResponse.processRedirect(d.responseXML);}}});},_alertFirstChildValue:function(a){alert(a.firstChild.nodeValue);},deleteBuildType:function(b,a,c){if(!a&&!confirm("Are you sure you want to delete this build configuration and all related data?")){return false;}this._doDeleteAjaxRequest("buildTypeId="+b+"&removeBuildType=1"+(a?"&forceDelete=1":"")+(c?"&cameFromUrl="+encodeURIComponent(c):""),{onReferencesExistError:function(d){var e=d.firstChild.nodeValue+"\nAre you sure you want to delete this build configuration?";if(confirm(e)){BS.AdminActions.deleteBuildType(b,true,c);}},onUndeletableReferencesExistError:this._alertFirstChildValue,onRunningBuildsExistError:this._alertFirstChildValue});return false;},deleteBuildTypeTemplate:function(a){BS.confirm("Are you sure you want to delete this template?",function(){this._doDeleteAjaxRequest("templateId="+a+"&removeTemplate=1",{cannotBeRemovedError:this._alertFirstChildValue});}.bind(this));return false;},deleteProject:function(b,a){if(!a&&!confirm("Are you sure you want to delete this project and all related data (build history, artifacts, etc.)?")){return false;}this._doDeleteAjaxRequest("projectId="+b+"&removeProject=1"+(a?"&forceDelete=1":""),{onProjectRemoveFailedError:this._alertFirstChildValue,onReferencesExistError:function(c){var d=c.firstChild.nodeValue+"\nAre you sure you want to delete this project?";if(confirm(d)){BS.AdminActions.deleteProject(b,true);}},onUndeletableReferencesExistError:this._alertFirstChildValue,onRunningBuildsExistError:this._alertFirstChildValue});return false;},deleteVcsRoot:function(b,a){if(!confirm("Are you sure you want to delete this VCS root?")){return false;}BS.Util.hideSuccessMessages();BS.Util.show("vcsRootProgress_"+b);BS.ajaxRequest(this.url,{parameters:"removeVcsRoot="+b,onComplete:function(d){var c=BS.XMLResponse.processErrors(d.responseXML,{onReferencesExistError:function(e){alert(e.firstChild.nodeValue);},onRemoveFailedError:function(e){alert(e.firstChild.nodeValue);}});if(!c){if(a){a();}else{BS.AdminActions._refreshAllRoots();}}else{BS.Util.hide("vcsRootProgress_"+b);}}});return false;},detachVcsRoot:function(b,c,a){if(!confirm(a?a:"Are you sure you want to detach this VCS root?")){return;}BS.Util.hideSuccessMessages();BS.ajaxRequest(this.url,{parameters:"detachVcsRoot="+b+"&settingsId="+c,onComplete:function(){BS.AdminActions._refreshVcsRoot(b);}});},deleteBuildTrigger:function(c,a,b){if(!confirm("Are you sure you want to delete this trigger?")){return false;}BS.Util.hideSuccessMessages();BS.ajaxRequest(this.url,{parameters:"removeBuildTrigger="+c+"&buildTypeExternalId="+a,onComplete:function(e){var d=BS.XMLResponse.processErrors(e.responseXML,{onBuildTypeNotFoundError:function(f){alert(f.firstChild.nodeValue);},onTriggerNotFoundError:function(f){alert(f.firstChild.nodeValue);}});if(!d){b&&b();}}});return false;},deleteUsers:function(d,c){var a="";for(var b=0;b<d.length;b++){a+=d[b]+":";}BS.ajaxRequest(this.url,{parameters:"removeUsers="+a,onComplete:function(){if(c){c();}}});return false;},toggleVcsRootUsages:function(b,c){$j("#"+c+"_usages").toggle();var a=$j(b).parent().toggleClass("usageHl");a.parent().find(".vcsRoot").toggleClass("bold");return false;},_refreshVcsRoot:function(a){$("vcsRootContainer_"+a).refresh("vcsRootProgress_"+a);},_refreshAllRoots:function(){BS.reload(true);},deleteIssueProvider:function(a,b){if(!confirm("Are you sure you want to remove an issue tracker connection?")){return;}BS.Util.hideSuccessMessages();BS.ajaxRequest(this.url,{parameters:"deleteIssueProvider=1&providerId="+a+"&projectId="+b,onComplete:function(){BS.reload(true);}});},setParametersDescriptorEnabled:function(g,a,b,f,c){let url=this.url;var d=function(h){BS.ajaxRequest(url,{parameters:"id="+g+"&setEnabled="+a+"&enabled="+b+"&descriptorName="+f+"&removeQueued="+h,onSuccess:function(){if(c){c();}else{BS.reload(true);}}});};var e="Trigger"===f;if(!b&&e){BS.DisablingTriggerDialog.show({requestFunc:d,title:"Disable Trigger",text:"Are you sure you want to disable this trigger?",buttonCaption:"Disable"});}else{d(false);}},setHealthItemVisibility:function(e,f,h,g,c,d){var b=this.url;var a=function(){BS.ajaxRequest(b,{parameters:"setVisible="+g+"&type="+e+"&categoryId="+f+"&itemId="+h+(c?"&applyGlobally=true":""),onComplete:function(){if(d){d();}}});};if(!g&&c){BS.confirmDialog.show({text:"Are you sure you want to hide this item for all users? It is possible to restore the visibility later under 'Administration > Server Health'.",actionButtonText:"Hide",cancelButtonText:"Cancel",title:"Hide Server Health item",cancelAction:function(i){if(i){i.stopPropagation();i.preventDefault();}},action:a});}else{a();}return false;},hideHealthItemFromPopup:function(e,c){var d=document.getElementById(e);d&&(d.hidden=true);var a=document.getElementById(c);if(a&&a.querySelectorAll(".inplaceHealthStatusItem:not([hidden])").length===0){BS.Hider.hideDiv(c);}var b=document.querySelector('[id^="container_hi_"]');b&&b.refresh();},regenerateAllIds:function(a){BS.RegenerateForm.showDialog(a);return false;},checkCanMove:function(b,c,a){BS.ajaxRequest(this.url,{parameters:"checkCanMove=true&targetId="+b+"&"+c,onComplete:function(j){var m=j.responseXML;var q=[];var r=[];var l={clashingCleanupDisableRules:0,clashingOverriddenRules:0};var p=[];if(m){var d=m.getElementsByTagName("vcsRoot");var g=m.getElementsByTagName("template");var n=m.getElementsByTagName("clashingDisableRules");var f=m.getElementsByTagName("clashingOverriddenRules");var h=m.getElementsByTagName("reason");for(var k=0;k<d.length;k++){var o=d[k];q.push(o.getAttribute("name"));}for(k=0;k<g.length;k++){o=g[k];r.push(o.getAttribute("name"));}for(k=0;k<n.length;k++){o=n[k];l.clashingCleanupDisableRules=o.getAttribute("total");}for(k=0;k<f.length;k++){o=f[k];l.clashingOverriddenRules=o.getAttribute("total");}for(k=0;k<h.length;k++){o=h[k];p.push(o.firstChild.nodeValue);}}if(a){a(q,r,l,p);}}});return false;},listBranches:function(b,c){var a=b.indexOf("internal:")==0;BS.ajaxRequest(this.url,{parameters:"listBranches=true&"+(a?"internalBuildTypeId="+b.substring("internal:".length):"buildTypeId="+b),onComplete:function(k){var f=k.responseXML;if(f){var d=[];var h=f.getElementsByTagName("branch");for(var g=0;g<h.length;g++){var j=h[g];d.push({name:j.getAttribute("name"),is_default:"true"==j.getAttribute("is_default")});}if(c){c(d);}}}});},prepareProjectIdGenerator:function(e,c,a,d,b){this._doPrepare("project",e,c,a,d,b);},prepareBuildTypeIdGenerator:function(e,c,a,d,b){this._doPrepare("buildType",e,c,a,d,b);},prepareTemplateIdGenerator:function(e,c,a,d,b){this._doPrepare("template",e,c,a,d,b);},prepareVcsRootIdGenerator:function(e,c,a,d,b){this._doPrepare("vcsRoot",e,c,a,d,b);},prepareCustomIdGenerator:function(a,f,d,b,e,c){this._doPrepare(a,f,d,b,e,c);
},_doPrepare:function(g,f,d,a,e,b){var c=this;f=$(f);if(!f){return;}if(!e){f.setAttribute("generated",f.value);c._prepareIdGenerator(g,f,d,a);}else{c._prepareEdit(f,b);c._createRegenerateLink(g,f,d,a);}},_prepareEdit:function(c,b){b=$(b||"changeExternalIdWarning");b=$j(b||"");var a=c.value;$j(c).on("keyup change",function(){if(this.value!=a){b.show();}else{b.hide();}}).attr("originalId",a);},_createRegenerateLink:function(f,e,d,b){var c=this,a=$j(e);$j("<a>",{href:"#","class":"regenerate",title:"Regenerate the ID based on the current name and parent projects' names",click:function(){var g=a.attr("originalId");c._prepareIdGenerator(f,e,d,b,g,true,function(){a.trigger("keyup").focus();});return false;},html:"Regenerate ID",insertAfter:a});},_prepareIdGenerator:function(c,a,i,e,h,d,k){var b=0,j=0;i=$(i);function g(m){try{return m instanceof HTMLElement;}catch(l){return(typeof m==="object")&&(m.nodeType===1)&&(typeof m.style==="object")&&(typeof m.ownerDocument==="object");}}function f(){var n=a.value,m=a.getAttribute("generated"),l=i.value;if(!d){if(n&&n!=m){return;}}function o(p){a.value=p;a.setAttribute("generated",p);$j(a).trigger("keyup");}if(l){(function(p){var q=g(e)?e.value:e;BS.ajaxRequest(window["base_uri"]+"/generateId.html",{parameters:{object:c,parentId:q,name:l,currentId:h},onComplete:function(r){if(p>=j){j=p;o(r.responseText);k&&k();}}});})(b++);}else{if(n==m){o("");}}}if(!d){$j(i).on("keyup",f);if(g(e)){$j(e).on("change",f);}}f();},prepareSubstitutor:function(f,a,c,d,b){f=$(f);c=$(c);if(!f||!c){return;}var e=this;e._setParsedData(f,a,d,{});e._fillTextarea(f,c,null);$j(f).on("keyup",function(){e.regenerateAll(a,c,f,true,b);});},_setParsedData:function(d,a,b){var e=[],c={};this._parsedData=e;e.clash=false;_.each(b,function(h){if(!h||!h.length){return;}var g=h[0],i=h[1],f=h[2];e.push([g,i,f]);if(c[i]){e.clash=true;}c[i]=true;});},_parseTextarea:function(c){var a={},b=c.value.split(/\n/);_.each(b,function(e){if(e&&e[0]!="#"){var d=e.indexOf("=>");if(d>=0){var g=$j.trim(e.substr(0,d)),f=$j.trim(e.substr(d+2));if(g.include(":")){g=g.replace(/:\s+/,":");}a[g]=f;}}});return a;},_fillTextarea:function(d,b,a){if(!a){this._prevFilled={};}var c=this._prevFilled,e=this._parsedData;var f=[];_.each(e,function(l){var j=l[0],m=l[1],g=l[2],i;var k=j+":"+m;var h=e.clash?j+":"+m:m;if(a&&c[k]!=a[h]){i=a[h];}else{i=m;c[k]=i;}f.push(indentString(g)+(e.clash?j+": ":"")+m+" => "+i);});b.value=f.join("\n");},createHiddenMappingIfNecessary:function(c){c=$j(c);var b=$j("textarea",c);var e=this._parsedData;if(!e||e.clash){b.attr("name","mapping");return;}var a=this._parseTextarea(b[0]);var d=[];_.each(e,function(h){var g=h[0],i=h[1],f=a[i];if(f){d.push(g+": "+i+" => "+f);}});$j("<input>",{type:"hidden",name:"mapping",value:d.join("\n"),insertAfter:c});},regenerateAll:function(f,h,a,c,d){if(d){d(false);}var e=this._prevFilled,i=this._parsedData;var b={};if(c){var g=this._parseTextarea(h);_.each(i,function(m){var k=m[0],n=m[1];var l=k+":"+n;var j=i.clash?k+":"+n:n;if(g&&e[l]!=g[j]){b[j]=true;}});}BS.ajaxRequest(window["base_uri"]+"/admin/regenerate.html",{method:"GET",parameters:{projectId:f,returnDefaults:"true",currentId:$(a).value,forCopy:c},onComplete:function(q){var n=JSON.parse(q.responseText),m=n.project,p=n.vcsRoot,l=n.buildType;if(n.error){$j("#error_newProjectExternalId").html(n.error.escapeHTML());return;}else{$j("#error_newProjectExternalId").html("");}function o(t){if(b[t.trim()]){return null;}if(i.clash){var r=t.indexOf(":"),s=t.substr(0,r).trim(),u=t.substr(r+1).trim();if(s=="project"){return m[u];}else{if(s=="vcsRoot"){return p[u];}else{return l[u];}}}else{u=t.trim();return m[u]||l[u]||p[u];}}h=$(h);var j=[];if(c){var k=h.value.split(/\n/);_.each(k,function(s){var u,t;if(s&&s[0]!="#"){var r=s.indexOf("=>");if(r>=0){u=s.substr(0,r);}}if(u){t=o(u);}if(t){j.push(u+"=> "+t);}else{j.push(s);}});}else{_.each(i,function(u){var t=u[0],v=u[1],r=u[2],s=(t=="project")?m[v]:(t=="vcsRoot")?p[v]:l[v];j.push(indentString(r)+(i.clash?t+": ":"")+v+" => "+s);});}h.value=j.join("\n");_.each(i,function(s){var r=s[0],u=s[1];var t;if(s[0]=="project"){t=m[u];}else{if(s[0]=="vcsRoot"){t=p[u];}else{t=l[u];}}e[r+":"+u]=t;});if(d){d(true);}}});return false;},showOrHideActions:function(a,b){var c=$j(a);c.change(function(){setTimeout(function(){if(c.filter(":checked").length>0){$j(b).show();}else{$j(b).hide();}},100);});},setProjectEditable:function(a,b){if(!b){if(!confirm("This will disable editing of the project and subprojects settings via the web interface. Are you sure?")){return false;}}BS.ajaxRequest(window["base_uri"]+"/admin/action.html",{parameters:{projectId:a,editable:b},onComplete:function(){BS.reload(true);}});return false;},setBuildTypeEditable:function(a,b){if(!b){if(!confirm("This will disable editing of the configuration settings via the web interface. Are you sure?")){return false;}}BS.ajaxRequest(window["base_uri"]+"/admin/action.html",{parameters:{buildTypeId:a,editable:b},onComplete:function(){BS.reload(true);}});return false;},setTemplateEditable:function(b,a){if(!a){if(!confirm("This will disable editing of the configuration template settings via the web interface. Are you sure?")){return false;}}BS.ajaxRequest(window["base_uri"]+"/admin/action.html",{parameters:{templateId:b,editable:a},onComplete:function(){BS.reload(true);}});return false;}};function indentString(a){return(new Array((parseInt(a,10)||0)+1)).join("  ");}BS.AttachBuildTypeForm=OO.extend(BS.AbstractWebForm,OO.extend(BS.AbstractModalDialog,{setSaving:function(a){if(a){BS.Util.show("attachBuildTypeProgress");}else{BS.Util.hide("attachBuildTypeProgress");}},getContainer:function(){return $("attachBuildTypeFormDialog");},formElement:function(){return $("attachBuildTypeForm");},showDialog:function(a){this.formElement().vcsRootId.value=a;this.showCentered();this.bindCtrlEnterHandler(this.submit.bind(this));$("chooseBuildTypeSelector").fill(a);BS.jQueryDropdown($("chooseBuildTypeSelector")).ufd("changeOptions");},submit:function(){var a=this.formElement().buildTypeId.selectedIndex;var b=this.formElement().buildTypeId.options[a].value;var c=this.formElement().vcsRootId.value;this.setSaving(true);BS.Util.hideSuccessMessages();BS.ajaxRequest(BS.AdminActions.url,{parameters:"attachVcsRoot="+c+"&buildTypeId="+b,onComplete:function(){BS.AdminActions._refreshVcsRoot(c);BS.AttachBuildTypeForm.setSaving(false);BS.AttachBuildTypeForm.close();}});return false;}}));BS.BaseAssignRoleDialog=OO.extend(BS.AbstractModalDialog,{getFormElement:function(){},getTitle:function(){},show:function(b,a){this.showCentered();this.bindCtrlEnterHandler(this.save.bind(this));this.getFormElement().role.onchange();this._rolesHolderIds=b;this._oncompletefunction=a;$(this.getFormElement().id+"Title").innerHTML=this.getTitle();},_clearAll:function(){var b=this.getFormElement();var a=$j(b.projectId);var c=$j(b).find(".inplaceFilterDiv").find("input");a.children().remove();this._prevValue=c.val();c.val("");},save:function(){BS.Util.hideSuccessMessages();if($j(this.getFormElement).find(".projectsRow").is(":visible")){var d=false;var b=this.getFormElement().projectId.options;for(var c=0;c<b.length;c++){if(b[c].selected){d=true;}}if(!d){alert("Please select at least one project.");return false;}}if(this.getFormElement().replaceRoles&&this.getFormElement().replaceRoles.checked&&!confirm("Are you sure you want to completely replace all of the current roles with newly selected roles?")){return false;}Form.disable(this.getFormElement());BS.Util.show("savingRole");var a="";for(c=0;c<this._rolesHolderIds.length;c++){a+="&rolesHolderId="+this._rolesHolderIds[c];}var e=this;BS.ajaxRequest(this.getFormElement().action,{parameters:BS.Util.serializeForm(this.getFormElement())+a,onComplete:function(){BS.Util.hide(e.getFormElement().id+"_savingRole");e._oncompletefunction();Form.enable(e.getFormElement());e.close();}});return false;},_roles:{},_projects:[],clearAll:function(){this._roles={};this._projects=[];},addProject:function(e,b,a,c,d){this._projects.push({id:e,externalId:b,name:a,fullName:c,level:d});
},addRole:function(c,a,b){this._roles[c]={name:a,isProjectBased:b,visibleProjects:{},disabledProjects:{}};},isProjectBased:function(a){return this._roles[a].isProjectBased;},setVisible:function(b,a){this._roles[b].visibleProjects[a]=true;},setVisibleDisabled:function(b,a){this.setVisible(b,a);this._roles[b].disabledProjects[a]=true;},isVisible:function(b,a){var c=this._roles[b];return c.visibleProjects[a];},isDisabled:function(b,a){return this._roles[b].disabledProjects[a];},roleChanged:function(){var b=this.getFormElement().role;var a=b.selectedIndex;var c=b.options[a].value;this.loadProjects(c,this.isProjectBased(c));$(this.getFormElement().id+"_roleName").innerText=b.options[a].text;},loadProjects:function(d,a){var e={};var c=this.getFormElement().projectId;var m=$j(this.getFormElement());while(c.options.length>0){var j=c.options[0].selected;if(j){e[c.options[0].value]=true;}c.options[0]=null;}if(d=="SYSTEM_ADMIN"){m.find(".globalText").html("<b>&lt;Root&gt;</b> project");}else{m.find(".globalText").html("Global (cannot be associated with any project)");}if(!a){m.find(".globalScopeRow").show();m.find(".projectsRow").hide();m.find(".roleScopeInput").val("global");return;}else{m.find(".globalScopeRow").hide();m.find(".projectsRow").show();m.find(".roleScopeInput").val("perProject");}this._clearAll();var f=this._projects;var b=document.createDocumentFragment();for(var g=0;g<f.length;g++){var l=f[g];if(!this.isVisible(d,l.id)){continue;}var h=new Option(l.name,l.externalId,false,e[l.externalId]);h.setAttribute("data-filter-data",l.level);h.setAttribute("data-title",l.fullName);h.setAttribute("title",l.fullName);h.className="inplaceFiltered";if(this.isDisabled(d,l.id)){h.disabled="disabled";}b.appendChild(h);}c.appendChild(b);b=null;BS.expandMultiSelect($j(c));BS.InPlaceFilter.prepareFilter(c.id);var k=m.find(".inplaceFilterDiv").find("input");this._prevValue&&k.val(this._prevValue);BS.InPlaceFilter.applyFilter("assignRole_projectId",k.get(0),null,true);},showRolesDescription:function(){var a=this.getFormElement().role;var b=a.options[a.selectedIndex].value;var c=window["base_uri"]+"/rolesDescription.html?";for(var d=0;d<a.options.length;d++){c+="role="+a.options[d].value+"&";}c+="#"+b;BS.Util.popupWindow(c,"_blank",{width:550,height:600});}});BS.AssignRoleDialog=OO.extend(BS.BaseAssignRoleDialog,{getContainer:function(){return $("assignRoleDialog");},getFormElement:function(){return $("assignRole");},getProgressIndicator:function(){return $("assignRole_saving");},getTitle:function(){if(this._rolesHolderIds.length>1){return"Assign roles to "+this._rolesHolderIds.length+" users";}return"Assign roles";},show:function(b,a){BS.BaseAssignRoleDialog.show.call(this,b,a);this.expandMultiSelect();},roleChanged:function(){BS.BaseAssignRoleDialog.roleChanged.call(this);this.expandMultiSelect();},expandMultiSelect:function(){parseInt($j("#assignRole_projectId").attr("size"),10)>0||BS.expandMultiSelect($j("#assignRole_projectId"));}});BS.UnassignRoleDialog=OO.extend(BS.BaseAssignRoleDialog,{getContainer:function(){return $("unassignRoleDialog");},getFormElement:function(){return $("unassignRole");},getProgressIndicator:function(){return $("unassignRole_saving");},getTitle:function(){if(this._rolesHolderIds.length>1){return"Unassign roles from "+this._rolesHolderIds.length+" users";}return"Unassign roles";}});BS.UnassignRolesForm=OO.extend(BS.AbstractWebForm,{getFormElement:function(){return $("unassignRolesForm");},selectAll:function(a){if(a){BS.Util.selectAll(this.getFormElement(),"unassign");}else{BS.Util.unselectAll(this.getFormElement(),"unassign");}},selected:function(){var b=Form.getInputs(this.getFormElement(),"checkbox","unassign");for(var a=0;a<b.length;a++){if(b[a].checked){return true;}}return false;},setSaving:function(a){if(a){BS.Util.show("unassignInProgress");}else{BS.Util.hide("unassignInProgress");}},submit:function(){if(!this.selected()){alert("Please select at least one role.");return false;}BS.confirm("Are you sure you want to unassign selected roles?",function(){BS.FormSaver.save(this,this.formElement().action,OO.extend(BS.ErrorsAwareListener,{onCompleteSave:function(){$("authorityRolesContainer").refresh();}}));}.bind(this));return false;}});BS.AvailableParams={url:window["base_uri"]+"/admin/parameterAutocompletion.html",attachPopups:function(d,c){var b=[],a;for(a=1;a<arguments.length;a++){b.push(arguments[a]);}if($j.inArray("buildTypeParams",b)===-1){b.push("buildTypeParams");}$j(document).ready(function(){$j(b).each(function(f,g){var e="."+g+":not(.disableBuildTypeParams):not([type=password])";BS.AvailableParams.attachPopupsTo(d,e);});});},buildSourceUrl:function(a){return a&&this.url+"?"+a;},setElementCompletionObjId:function(a,c){var b=$j(a);if(!b.hasClass("js_dynamicSource")){BS.Log.warn("The element has no js_dynamicSource class required to update completion parameters");}$j(a).data("editableObjId",c);},autocompleteCM:function(b,g,f){BS.AvailableParams.initAutocomplete(b.get(0));var d=b.hasClass("js_dynamicSource");var a=b.data("cm");var c=BS.AvailableParams.buildSourceUrl(b.data("editableObjId"))||this.url;var e=function(h,l){if(d){c=BS.AvailableParams.buildSourceUrl(b.data("editableObjId"))||c;}var k=a.getCursor();var i=a.getRange(g,k);if(f){i=i.slice(1);}if(i.indexOf("%")>=0){l({list:[],from:g,to:k});return;}if(i){var j=new URL(c);j.searchParams.set("term",i);c=j.toString();}return $j.getJSON(c).then(function(m){var n=[];var o=null;m.forEach(function(r){if(!r.selectable){o=r;return;}var p=o;o=null;var q=document.createElement("span");q.innerHTML=r.label;n.push({text:"%"+q.textContent+"%",render:function(s){s.innerHTML=(p?'<div class="codemirror-autocomplete-separator">'+p.label+"</div>":"")+'<div class="codemirror-autocomplete-item">'+r.label+'<span class="ui-autocomplete-meta-info">'+r.meta+"</span>"+"</div>";}});});if(n.length===0){n=[{text:a.getRange(g,k),displayText:"No suggestions found",className:"codemirror-autocomplete-nothing"}];}l({list:n,from:g,to:k});});};e.async=true;a.showHint({hint:e,completeOnSingleClick:true,completeSingle:false});},initAutocomplete:function(b){if(b._autocompleteInited){return;}b._autocompleteInited=true;b=$j(b);var c=b.hasClass("js_dynamicSource");var a=b.data("cm");if(a){a.on("changes",function(){if(b.data("autoCompletingPercent")){return;}var g=a.getCursor();var f=a.getRange({line:g.line,ch:0},g);var e=BS.AvailableParams.getTermStart(f,f.length);if(e!=null){BS.AvailableParams.autocompleteCM(b,{line:g.line,ch:e},true);b.data("autoCompletingPercent",true);a.on("endCompletion",function(){b.data("autoCompletingPercent",false);});}});a.addKeyMap({"Ctrl-Space":function(){var h=a.getCursor();var g=a.getRange({line:h.line,ch:0},h);var e=g.match(/\S*$/);var f=e?e[0]:"";BS.AvailableParams.autocompleteCM(b,{line:h.line,ch:h.ch-f.length});}});}else{var d=b.data("editableObjId");b.autocomplete({minLength:0,insertItemWithFocus:false,source:BS.AvailableParams.sourceForElement(b,BS.AvailableParams.buildSourceUrl(d)||url,c),select:BS.AvailableParams.selectForElement(b),more:BS.AvailableParams.moreForElement(b,BS.AvailableParams.buildSourceUrl(d)||url,c),completeOnCtrlSpace:true});}},initAutocompleteOnCMFocus:function(b){var a=$j(b).data("cm");if(a){if(a.hasFocus()){BS.AvailableParams.initAutocomplete(b);}else{a.on("focus",function(){BS.AvailableParams.initAutocomplete(b);});}}},attachPopupsTo:function(c,a){var b=$j(a);b.data("editableObjId",c);b.each(function(){var g=this.parentNode.className;if(g.indexOf("completionIconWrapper")==-1&&g.indexOf("posRel")==-1){var d=$j(this);var h=BS.Util.wrapRelative(d);if(d.hasClass("js_max-width")||d.prop("style").width=="100%"){h.css("display","block");}}BS.AvailableParams.showCompletionAvailableImage(this);if(internalProps["teamcity.ui.editSettings.showResolveValueIcon"]&&$j(this).val().search(/%[^%]+%/m)!=-1){var e=$j('<i class="icon-eye-open resolveValue" title="Click to see evaluated value"></i>');e.appendTo(this.parentNode);var f=this;e.on("click",function(){var j=$j(f).val();
var i=new BS.Popup("resolvedValues",{url:window["base_uri"]+"/admin/resolveValue.html",parameters:c+"&value="+encodeURIComponent(j),method:"get"});i.showPopupNearElement($j(f)[0],{delay:0,hideOnMouseClickOutside:true,hideOnMouseOut:false,shift:{x:0,y:$j(f).outerHeight(true)}});});}else{$j(this).parent().find(".resolveValue").remove();}});b.each(function(){BS.AvailableParams.initAutocompleteOnCMFocus(this);});b.on("focus",function(){BS.AvailableParams.initAutocomplete(this);});},sourceForElement:function(b,a,c){return function(g,f){if(c){a=BS.AvailableParams.buildSourceUrl(b.data("editableObjId"))||a;}var e=BS.AvailableParams.sliceForCompletion(b);if(e){b.data("ctrlSpace",false);}else{if(b.data("ctrlSpace")){e=BS.AvailableParams.sliceForCtrlSpaceCompletion(b);}else{if(b.data("showAll")){e=BS.AvailableParams.sliceForShowAllCompletion(b);}}}b.data("sliced_text",e);if(e!==null){var d=BS.AvailableParams.showLoadingImage(b);$j.getJSON(a+(a.indexOf("?")<0?"?":"&")+"term="+encodeURIComponent(e.term),null,function(h){BS.Util.fadeOutAndDelete(d);f(h);});}else{f(null);}};},selectForElement:function(a){return function(d,e){var c=a.data("sliced_text");var b;if(c!==null){b=c.before_length+e.item.value.length+1;this.value=c.before+e.item.value+"%"+c.after;BS.AvailableParams.setCursorPosition(a[0],b);}return false;};},moreForElement:function(b,a,c){return function(g,f){if(c){a=BS.AvailableParams.buildSourceUrl(b.data("editableObjId"))||a;}var e=b.data("sliced_text");if(e!==null){var d=BS.AvailableParams.showLoadingImage(b);$j.getJSON(a+(a.indexOf("?")<0?"?":"&")+"term="+encodeURIComponent(e.term)+"&from="+encodeURIComponent(g),null,function(h){BS.Util.fadeOutAndDelete(d);f(h);});}else{f(null);}};},showCompletionAvailableImage:function(c){if(c.className&&c.className.indexOf("__popupAttached")!=-1){return;}var d=c.id;c.className+=" __popupAttached";var a=this.appendCompletionImageTo(c.parentNode);var b={updateVisibility:function(){var e=$(d);a.style.visibility=(e.disabled||e.readOnly)?"hidden":"visible";}};b.updateVisibility();BS.VisibilityHandlers.attachTo(d,b);},_completionImage:null,appendCompletionImageTo:function(b){function a(){var d=$j('<span class="tc-icon icon16 tc-icon_params paramsPopupHandle" title="Parameter references are supported in this field, type % to see available parameters"></span>');d.on("click",function(){$j(this).prevAll("input, textarea").each(function(){var f=$j(this);var e=f.data("cm");if(e){e.focus();BS.AvailableParams.autocompleteCM(f,e.getCursor());}else{f.focus().data("showAll",true).autocomplete("search");}});});return d;}this._completionImage=this._completionImage||a();var c=this._completionImage.clone(true);c.appendTo(b);return c[0];},showLoadingImage:function(c){c=$j(c);var a=c.position();var b=c.attr("id")+"_completion_img";return $j("<i>").attr({id:b,className:"icon-refresh icon-spin ring-loader-inline"}).css({width:16,height:16,position:"absolute",left:a.left+c.outerWidth(true)-40,top:a.top+2}).insertAfter(c);},getCursorPosition:function(e){var d=document.getElementById(e);var a=d.selectionStart;var f,b,g=0;if(a||a===0){return a;}else{if(document.selection&&document.selection.createRangeCollection){f=document.selection.createRange();if(f===null){return 0;}else{b=f.duplicate();if(d.tagName.toLowerCase()==="textarea"){b.moveToElementText(d);b.setEndPoint("EndToEnd",f);var j=b.text.length-f.text.length;var h=d.value;for(var c=0;c<j;c++){if(h.charAt(c)==="\n"){g++;}}return j-g;}else{a=0-b.moveStart("character",-100000);return a+f.text.length;}}}else{return 0;}}},setCursorPosition:function(c,a){if(c.setSelectionRange){c.focus();c.setSelectionRange(a,a);}else{if(c.createTextRange){var b=c.createTextRange();b.collapse(true);b.moveEnd("character",a);b.moveStart("character",a);b.select();}}},getTermStart:function(d,c){var b,e;e=0;b=-1;for(var a=0;a<c;a++){if(d.charAt(a)==="%"){b=a;e++;}}if(e%2===0){return null;}else{if(b===-1){return null;}else{return b;}}},sliceForCompletion:function(a){a=$j(a);var c=a.val(),b=BS.AvailableParams.getCursorPosition(a.attr("id")),d=BS.AvailableParams.getTermStart(c,b);return d!=null?{before:c.slice(0,d+1),before_length:d+1,term:c.slice(d+1,b),after:c.slice(b,c.length)}:null;},sliceForCtrlSpaceCompletion:function(b){b=$j(b);var e=b.val(),d=BS.AvailableParams.getCursorPosition(b.attr("id")),a,f;for(a=d-1;a>=0;a--){f=e.charAt(a);if(f===" "||f==="\n"||f==="\t"){a++;break;}}if(a===-1){a=0;}return{before:e.slice(0,a)+"%",before_length:a+1,term:e.slice(a,d),after:e.slice(d,e.length)};},sliceForShowAllCompletion:function(a){a=$j(a);var c=a.val(),b=BS.AvailableParams.getCursorPosition(a.attr("id"));return{before:c.slice(0,b)+"%",before_length:b,term:"",after:c.slice(b,c.length)};}};BS.ArchiveProjectDialog=OO.extend(BS.AbstractWebForm,OO.extend(BS.AbstractModalDialog,{formElement:function(){return $("archiveProjectForm");},getContainer:function(){return $("archiveProjectFormDialog");},archiveText:"Archive",unarchiveText:"Dearchive",showArchiveProjectDialog:function(b,c){var a=this.archiveText;var d="Are you sure you want to archive this project (and its subprojects, if any)?";if(c){BS.Util.show("removeFromQueueDiv");this.formElement().archiveAction.value="archive";}else{BS.Util.hide("removeFromQueueDiv");this.formElement().archiveAction.value="unarchive";d="Are you sure you want to unarchive this project (and its subprojects, if any)?";a=this.unarchiveText;}this.formElement().projectId.value=b;this.formElement().ArchiveSubmitButton.value=a;$("archiveProjectFormTitle").innerHTML=a+" project";$("message").innerHTML=d;this.showCentered();this.bindCtrlEnterHandler(this.submit.bind(this));},submit:function(){BS.Util.show("archiveProgressIcon");BS.FormSaver.save(this,this.formElement().action,OO.extend(BS.ErrorsAwareListener,{onCompleteSave:function(){BS.Util.hide("archiveProgressIcon");BS.reload(true);},onFailure:function(){BS.Util.hide("archiveProgressIcon");alert("Problem accessing server");}}));return false;}}));
/*---
/js/bs/advancedOptions.js
---*/
BS.bindShowHideAdvancedOptions=function(b,d,c){var a=document.getElementById(b),e="advanced_hidden";a._advancedOptions={containerId:b,init:function(){var f=this.advancedSettingChanged();this.showAdvanced(c||f,false);},advancedSettingChanged:function(){return $j(a).find(".advancedSetting .valueChanged:visible").length>0;},showAdvanced:function(f,h){var j=$j(a).find(".advancedSetting");var i=$j("#advancedSettingsToggle_"+this.containerId);var l=i.find("a");if(f){j.removeClass(e);if(h){j.css("color");j.addClass("advancedSettingHighlight strongHighlight");setTimeout(function(){j.removeClass("strongHighlight");},1000);}}else{j.addClass(e).removeClass("advancedSettingHighlight");}if(j.length>0){i.show();l.text(f?"Hide advanced options":"Show advanced options");var g=this;l.off("click").on("click",function k(){BS.User.setBooleanProperty(d,!f,{afterComplete:function(){g.showAdvanced(!f,true);BS.VisibilityHandlers.updateVisibility(a);}});});BS.MultilineProperties.updateVisible();}else{i.hide();}}};a._advancedOptions.init();};
/*---
/js/bs/runBuild.js
---*/
BS.RunBuildDialog=OO.extend(BS.AbstractWebForm,OO.extend(BS.DialogWithProgress,OO.extend(BS.FileBrowse,{formId:"runBuild",tabs:["general-tab","dependencies-tab","changes-tab","properties-tab","comment-tab"],sectionContent2Header:{customConfigParams:"configurationParametersHeader",customBuildSystemProps:"systemPropertiesHeader",customBuildEnvVars:"environmentVariablesHeader"},newParameterCounter:0,newParameterNumber:0,customControls:{},CustomControls:{},updateTimer:null,_parameterHighlightStatus:{},redirectToQueued:false,getRefreshUrl:function(){return window["base_uri"]+"/runCustomBuild.html";},_customParametersContainerId:"properties-tab",serializeParameters:function(b){b=OO.extend({tabsFilter:function(){return true;},customParameterFilter:function(){return true;},extra:{}},b||{});var e=[];e.push(BS.Util.serializeForm($("runCustomBuildHidden")));for(var c=0;c<this.tabs.length;c++){var a=this.tabs[c];if(!b.tabsFilter(a)){continue;}var d=$(a);if(!d){continue;}if(d.id==this._customParametersContainerId){e.push(this.serializeCustomParameters(b.customParameterFilter));}else{e.push(BS.Util.serializeForm(d));}}e.push(Object.toQueryString(b.extra));return e.filter(function(f){return f&&f.length>0;}).inject("",function(g,f){return g+(g.length>0?"&":"")+f;});},serializeCustomParameters:function(c){var b=this._customParametersContainerId;if(!$(b)){return"";}var a={};for(var i in this.customControls){if(c&&!c(i)){continue;}var g=this.customControls[i];var d=g.getFormSerializeName();try{var h=g.getControlValue();if(h){a[d]=h;}}catch(f){BS.Log.error("Failed to get value of control: "+d+". "+f);}}Form.getElements($(b)).filter(function(e){if(!e||!e.name){return false;}var j=e.name;return((!c)||c(j))&&(j=="name"||j=="value"||j.endsWith(".name")||j.endsWith(".value")||j=="customParameterNames"||j.startsWith("marker_"));}).each(function(l){var k=$(l);if(!k){return;}var j=k.name;if(!j){return;}var m=k.getValue();if(m==null||m==undefined){return;}var e=a[j];if(!e){e=[];}e.push(m);a[j]=e;});return Object.toQueryString(a);},getAddControlFunction:function(a,b){var c={id:b,containerId:a,getFormSerializeName:function(){return b;},errorsProcessor:{}};c.getControlValue=function(){var d=$(c.id);if(d==null){return null;}return d.getValue();};BS.RunBuildDialog.customControls[b]=c;return function(d){if(d.getControlValue){c.getControlValue=d.getControlValue.bind(d);}if(d.errorsProcessor){for(var e in d.errorsProcessor){c.errorsProcessor[e]=d.errorsProcessor[e].bind(d.errorsProcessor);}}};},getContainer:function(){return $("runBuildDialog");},formElement:function(){return $("runBuild");},savingIndicator:function(){return $("runBuildProgress");},eachCustomControl:function(b){for(var c in this.customControls){var a=this.customControls[c];b(a);}},setupEventHandlers:function(){var a=this;this.setUpdateStateHandlers({updateState:function(){a.updateParametersState();},saveState:function(){a.submit();}});},updateParametersState:function(){var a=this;var b=this.serializeCustomParameters();if(!b||b.length==0){return;}BS.ajaxRequest(this.formElement().action,{method:"post",parameters:a.serializeParameters({extra:{checkChanged:"true"}}),onComplete:function(j){var c=j.responseXML;if(!c){return;}var h=c.getElementsByTagName("changes");if(h&&h.length==1&&h[0]){var g=h[0].getElementsByTagName("change");var f={};for(var e=0;e<g.length;e++){f[g[e].getAttribute("id")]=true;}for(var d in a.customControls){a.setParameterHighlightStatus(a.customControls[d].containerId,!!f[d]);}a.showValidationErrors(c);}}});},showValidationErrors:function(h){var a=BS.XMLResponse._xmlErrorsXml(h);var c=false;var j=[];for(var g=0;g<a.length;g++){var l=a[g][0];var b=a[g][1];if(l.indexOf("parameter_")==0){if(l.indexOf("!")>0){c=true;var k=l.split("!");if(k==2){var m=k[0];var d=k[1];var f=this.customControls[m];var e="on"+d+"Error";if(f!=null&&f.errorsProcessor[e]){f.errorsProcessor[e](b);}else{if($(f)){j.push($(f));BS.PluginPropertiesForm.showError(f,b);}else{j.push($(f));BS.PluginPropertiesForm.showError(m,b);}}}}else{j.push($j(".error#error_"+l)[0]);BS.PluginPropertiesForm.showError(l,b);c=true;}}}$j(this.formElement()).find(".error").each(function(n,o){if(o.id.startsWith("error_")&&j.indexOf(o)<0){o.innerHTML="";}});return c;},submit:function(){var a=$j("#personal").length>0&&$j("#personal")[0].checked;var b=$j('#runBuildDialog input[name="file:personalPatch"]').val();$j("input[name=personalPatchUploaded]").val("");if(b==""||!a){this.doSubmit();}else{$j("#personalPatchHiddenIframe").off("load");$j("#personalPatchHiddenIframe").on("load",function(){$j("input[name=personalPatchUploaded]").val("true");var c=BS.XMLResponse.processErrors($j("#personalPatchHiddenIframe")[0].contentWindow.document,{},function(e,d){alert("Error uploading patch file: "+d.firstChild.nodeValue);});if(!c){BS.RunBuildDialog.doSubmit();}});$j("#personalPatchUploadForm")[0].submit();}return false;},doSubmit:function(){var a=this;if($j("#customBuild-parameterName").val()){this.addParameter();}this.clearErrors();if(this.beforeTrigger){this.beforeTrigger();}BS.FormSaver.save(this,this.formElement().action,OO.extend(BS.ErrorsAwareListener,{onNo_build_typeError:function(b){alert(b.firstChild.nodeValue);},onInvalid_agentError:function(b){alert(b.firstChild.nodeValue);},onRevisionsNotAvailableError:function(b){alert(b.firstChild.nodeValue);},onAddToQueueErrorError:function(b){alert(b.firstChild.nodeValue);},onInvalidSubmitParametersError:function(b){alert(b.firstChild.nodeValue);},onAutoGeneratedBranchNameError:function(b){if(confirm(b.firstChild.nodeValue)){a.formElement().forceAutoGeneratedBranch.value="true";a.submit();}},onCompleteSave:function(f,h,e){var c=a.showValidationErrors(h);e=e||c;if(f.isVisible()){f.setSaving(false);f.enable();if(!e){f.close();}}if(c){BS.RunBuildDialog.showTab("properties-tab");}if(e){if(a._reject){a._reject("An error occurred in attempt to trigger build");}return;}BS.Hider.hideAll();var b=h.documentElement;if(b!=null){var d=b.getElementsByTagName("queuedBuilds");if(d&&d.length>0){var i=d.item(0).getElementsByTagName("queuedBuild");if(i&&i.length==1){var g=i.item(0).getAttribute("itemId");}}}BS.RunBuild.resolve(g);if(g&&a.redirectToQueued){document.location.href=window["base_uri"]+"/viewQueued.html?itemId="+g;}else{if(f.formElement().redirectTo.value!=""){document.location.href=f.formElement().redirectTo.value;}}}}));},addParameter:function(){var g=$j("#customBuild-paramType").val(),a=$j("#customBuild-parameterName").val(),j=$j("#customBuild-parameterValue").val(),l,d;if(g==="system"){l=$("customBuildSystemProps");}else{if(g==="env"){l=$("customBuildEnvVars");}else{l=$("customConfigParams");g="config";}}d=$j(BS.Util.escapeId(this.sectionContent2Header[l.id]));var e=$("newParamTemplate").firstChild.nodeValue;e=this._replacePattern(e,{"\\[prefix\\]":g+"."});e=this._replacePattern(e,{"\\[id\\]":this.newParameterCounter++});l.insert({bottom:e});this.getTabByElement(l).addClass("modifiedParam");d.show();var b=this._childElements(l);var h=b[b.length-1];var f=this._childElements(h);var i=$(f[0]).firstDescendant();var k=$(f[1]).firstDescendant().firstDescendant();i.value=a;k.value=j;var c=function(m){if(m.keyCode==Event.KEY_RETURN){Event.stop(m);}};i.on("keypress",c.bindAsEventListener(this));BS.VisibilityHandlers.attachTo(k.id,{updateVisibility:function(){jQuery(k).textAreaExpander(0,100,"updateVisibility");}});$j("#customBuild-paramType").val("conf");$j("#customBuild-parameterName").val("").focus();$j("#customBuild-parameterValue").val("");this.newParameterNumber++;BS.AvailableParams.attachPopupsTo("settingsId=buildType:"+this.formElement().buildTypeId.value,$j(k));BS.VisibilityHandlers.updateVisibility(this.formElement());},_replacePattern:function(d,c){var a=d;for(var b in c){a=a.replace(new RegExp(b,"g"),c[b]);}return a;},removeParameter:function(a){var b=a.parentNode;b.removeChild(a);if(!$j(b).children().size()){$j(BS.Util.escapeId(this.sectionContent2Header[b.id])).hide();}this.newParameterNumber--;this._parameterHighlightStatus={};
BS.VisibilityHandlers.updateVisibility(this.formElement());},resetParameter:function(b){var a=this.customControls[b];if(!a){return;}this.flipParameter(b);this.setParameterHighlightStatus(a.containerId,false);},resetAllParameters:function(){$j("#properties-tab tr.modifiedParam td.edit a").click();$j("#customBuild-parameterName").val("");$j("#customBuild-parameterValue").val("");},flipParameter:function(e){var d=this.customControls[e];if(!d){return;}var b=this;var c=this.serializeParameters({tabsFilter:function(f){return f==b._customParametersContainerId;},customParameterFilter:function(f){return false;},extra:{reset:1,flipControl:e}});var a=$(e).hasClassName("__popupAttached");$("refresh_container_"+e+"_div").refresh(null,c,function(){if(a){BS.VisibilityHandlers.updateVisibility(b.formElement());BS.AvailableParams.attachPopupsTo("settingsId=buildType:"+b.formElement().buildTypeId.value,BS.Util.escapeId(e));}});},setParameterHighlightStatus:function(a,d){if(!a){return;}if(this._parameterHighlightStatus[a]==d){return;}this._parameterHighlightStatus[a]=d;var c=$(a).up("tr");if(d){c.addClassName("modifiedParam");}else{c.removeClassName("modifiedParam");}d|=this.newParameterNumber>0;if(!d){for(var b in this._parameterHighlightStatus){if(this._parameterHighlightStatus[b]){d=true;break;}}}if(d){this.getTabByElement(c).addClass("modifiedParam");}else{this.getTabByElement(c).removeClass("modifiedParam");}},_childElements:function(a){var b=[];for(var c=0;c<a.childNodes.length;c++){var d=a.childNodes[c];if(d.nodeType==1){b.push(d);}}return b;},updateChangesContainer:function(a,b){BS.RunBuildDialog.disable();var c=this.serializeParameters({extra:{updateChanges:"true",userAction:b||""}});return new Promise(function(d){BS.ajaxRequest(this.formElement().action,{parameters:c,onComplete:function(){$(a).refresh($("changesProgress"),null,function(){ReactUI.getSandbox(BS.RunBuildDialog.getContainer()).mutate(function(){BS.RunBuildDialog.enable();d();});});}});}.bind(this));},highlightSettingRevisions:function(){var b=$j("#buildSettingsMode").val();if(b==="vcs"){$j(".customDialogSettingsRevision").removeClass("notFixedSettingsRevision");}else{$j(".customDialogSettingsRevision").addClass("notFixedSettingsRevision");}var a=$j("#buildSettingsMode").parents("tr");this._toggleHighlight(a,b!=="default");},updateComment:function(a){if(a!=null&&a.length>0){this.formElement().buildComment.value=a;}},appendTag:function(a){BS.Util.addWordToTextArea(this.formElement().buildTagsInfo,a);},show:function(){this.propertiesTabInited=false;this._parameterHighlightStatus={};this.newParameterNumber=0;this.showCentered();this.bindCtrlEnterHandler(this.submit.bind(this));$j("#customBuild-parameterName").unbind("keyup").on("keyup",BS.EditParameterDialog.createParamNameChangeHandler($j("#customBuild-parameterName"),$j("#customBuild-paramType")));$j("#customBuild-parameterName").placeholder({text:"&lt;Name>"});$j("#customBuild-parameterValue").placeholder({text:"&lt;Value>"});BS.VisibilityHandlers.attachTo("customBuild-parameterName",{updateVisibility:function(){$j("#customBuild-parameterName").placeholder("refresh");}});BS.VisibilityHandlers.attachTo("customBuild-parameterValue",{updateVisibility:function(){$j("#customBuild-parameterValue").placeholder("refresh");}});var a=BS.EditParameterDialog.createParamTypeChangeHandler($j("#customBuild-paramType"),$j("#customBuild-parameterName"));var b=function(){a();$j("#customBuild-parameterName").placeholder("refresh");};$j("#customBuild-paramType").off("change").on("change",b).off("keyup").on("keyup",function(c){if(BS.EditParameterDialog.canChangeSelectValue(c)){b();}});this.setupEventHandlers();BS.VisibilityHandlers.updateVisibility(this.formElement());},highlightCustomAgent:function(a){var b=jQuery(a).parents("td");this._toggleHighlight(b,true);},highlightDependency:function(a,c){var d=a.options[a.selectedIndex].value!=c;var b=jQuery(a).closest("tr");this._toggleHighlight(b,d);},highlightChanges:function(a){var b=jQuery(a).parents("td");this._toggleHighlight(b,true);},_toggleHighlight:function(b,a){if(a){b.addClass("modifiedParam");}else{b.removeClass("modifiedParam");}this.highlightModifiedTabs();},afterClose:function(){this._detachVisibilityHandlers();if(this.updateTimer){clearTimeout(this.updateTimer);}this.customControls={};ReactUI.unmountContainer("runBranchSelector_container");},_detachVisibilityHandlers:function(){BS.VisibilityHandlers._collectElements($("runCustomBuildDiv")).forEach(function(a){BS.VisibilityHandlers.detachFrom(a.id);});},showTab:function(c){var a=this.tabs.indexOf(c);if(a<0||!$(this.tabs[a])){return false;}for(var d=0;d<this.tabs.length;++d){if(this.tabs[d]!=c){jQuery(BS.Util.escapeId(this.tabs[d])).hide();}}jQuery(BS.Util.escapeId(c)).show();jQuery("#runCustomBuildDiv ul li").removeClass("selected");jQuery("#runCustomBuildDiv ul li#tab-"+a).addClass("selected");if(c!="properties-tab"||jQuery("#properties-tab .paramName").length<=500){BS.VisibilityHandlers.updateVisibility("runCustomBuildDiv");}this.recenterDialog();var b=this;window.setTimeout(function(){if(c=="properties-tab"&&!b.propertiesTabInited){BS.AvailableParams.attachPopups("settingsId=buildType:"+b.formElement().buildTypeId.value);b.propertiesTabInited=true;}},0);return false;},getTabByElement:function(b){var d=jQuery(b).closest("#runCustomBuildContentDiv .tabContent");var c=d.attr("id");var a={"general-tab":"#tab-0","dependencies-tab":"#tab-1","changes-tab":"#tab-2","properties-tab":"#tab-3","comment-tab":"#tab-4"}[c];return jQuery(a);},highlightModifiedTabs:function(){var a=this;jQuery("#runCustomBuildDiv .modifiedParam").each(function(){a.getTabByElement(this).addClass("modifiedParam");});}})));BS.TagsEditingMixin.init(BS.RunBuildDialog);BS.RunBuild={progressMessage:"Adding to queue...",lastRequestID:0,_options:function(a){var b={buildTypeId:null,redirectTo:"",redirectToQueuedBuild:false,branchName:null,afterTrigger:null,beforeTrigger:null,modificationId:null,dependOnPromotionIds:null,isCustomRunDialogForRunButton:false,init:false,stateKey:"",initFromBuild:null,queryString:function(){var c="";if(this.redirectTo!=null){c+="&redirectTo="+encodeURIComponent(this.redirectTo);}if(this.modificationId!=null){c+="&modificationId="+this.modificationId;}if(this.branchName!=null){c+="&branchName="+encodeURIComponent(this.branchName);if(this.branchName!="<default>"){this.stateKey=this.stateKey+"_"+encodeURIComponent(this.branchName);}}if(this.dependOnPromotionIds!=null){c+="&dependOnPromotionIds="+this.dependOnPromotionIds;}if(this.initFromBuild!=null){c+="&initFromBuild="+this.initFromBuild;}if(this.isCustomRunDialogForRunButton){c+="&customRunDialogForRunButton=true";}if(this.init){c+="&init=true";}if(this.stateKey!=""){c+="&stateKey="+this.stateKey;}return c;},afterShowDialog:function(){if(this.modificationId!=null&&this.modificationId>0){BS.RunBuildDialog.showTab("changes-tab");}else{BS.RunBuildDialog.showTab("properties-tab");}}};return OO.extend(b,a||{});},createPromise:function(){const a=new Promise(function(c,b){this._resolve=c;this._reject=b;}.bind(this));this._promise=a;return a;},resolve:function(a){if(this._resolve!=null){this._resolve(a?a.split(/:/g)[0]:null);}},runOnAgent:function(c,a,b){var d=this._options(b);BS.ProgressPopup.showProgress(c,this.progressMessage,{shift:{x:-65,y:20}});BS.ajaxRequest(window["base_uri"]+"/ajax.html",{parameters:"add2Queue="+a+"&validate=true"+d.queryString(),onComplete:function(e){BS.RunBuild.onComplete(c,a,d,e);}});return this.createPromise();},runCustomBuild:function(a,b){var c=this._options(b);c.afterShowDialog=b.afterShowDialog||function(){};return this._runCustomBuildImpl(a,c);},onComplete:function(c,j,k,b){var d=function(l){BS.WarningPopup.showWarning(c,{x:-250,y:20},"",{innerHTML:l});};BS.ProgressPopup.hidePopup(0,true);if(BS.EventTracker){BS.EventTracker.checkEvents();}var e=this;var g=BS.XMLResponse.processErrors(b.responseXML,{action_showRunCustomBuildDialog:function(){var l=e._options(k);l.isCustomRunDialogForRunButton=true;
l.afterShowDialog=e._options().afterShowDialog;l.stateKey=l.stateKey||"prompt";l.init=true;l.preservePromise=true;BS.RunBuild._runCustomBuildImpl(j,l);},onNo_agents_can_editError:function(n){var m=n.firstChild.nodeValue.replaceAll(/\n/g,"<br>");var l=base_uri+"/admin/editRequirements.html?id=buildType:"+j;m=m.replace("tweak build configuration requirements.","<a href='"+l+"'>tweak build configuration requirements</a>.");d(m);},onNo_agentsError:function(m){var l=m.firstChild.nodeValue.replaceAll(/\n/g,"<br>");l=l.replace("tweak build configuration requirements.","ask admin to tweak build configuration requirements.");d(l);}},function(m,l){BS.WarningPopup.showWarning(c,{x:-250,y:20},l.firstChild.nodeValue);});var i=b.responseXML.documentElement;if(i!=null){var h=i.getElementsByTagName("queuedBuilds");if(h&&h.length>0){var a=h.item(0).getElementsByTagName("queuedBuild");if(a&&a.length==1){var f=a.item(0).getAttribute("itemId");}}}if(!g){this.resolve(f);if(k.redirectToQueuedBuild&&f){document.location.href=window["base_uri"]+"/viewQueued.html?itemId="+f;}else{if(k.redirectTo&&k.redirectTo.length>0){document.location.href=k.redirectTo;}else{if(k.afterTrigger){k.afterTrigger();}}}}},_runCustomBuildImpl:function(a,c){var b=$j("#runBuild .modalDialogBody");var e=BS.RunBuildDialog;e.showProgress("Run Custom Build");e.redirectToQueued=c.redirectToQueuedBuild||false;e.beforeTrigger=c.beforeTrigger;var d=++this.lastRequestID;BS.ajaxUpdater(b[0],e.getRefreshUrl(),{method:"get",evalScripts:true,parameters:"buildTypeId="+a+c.queryString(),onComplete:function(){if(d!==this.lastRequestID){return;}e.showCentered();if($(e.formId+"_availableTags")){e.showTags($j("#comment-tab .tagsContainer").attr("id"),false,a);}e.show();c.afterShowDialog();}.bind(this)});if(!c.preservePromise){this.createPromise();}return this._promise;},setTitleSuffix:function(a){if(this.initialTitle===undefined){this.initialTitle=$("runBuildTitle").textContent;}$("runBuildTitle").textContent=this.initialTitle+a;}};BS.PromoteBuildDialog=OO.extend(BS.AbstractWebForm,OO.extend(BS.AbstractModalDialog,{getContainer:function(){return $("promoteBuildDialog");},formElement:function(){return $("promoteBuild");},resolve:function(a){if(this._resolve!=null){this._resolve(a);}this.close();},showDialog:function(b,a){$("promoteBuildDialogContent").innerHTML="";this.showCentered();BS.Util.show("promoteBuildDialogContentProgress");BS.ajaxUpdater("promoteBuildDialogContent",window["base_uri"]+"/promoteBuildDialog.html",{method:"get",evalScripts:true,parameters:"buildId="+b,onComplete:function(){BS.Util.hide("promoteBuildDialogContentProgress");BS.PromoteBuildDialog.recenterDialog();}});this.isNewUI=a;return new Promise(function(d,c){this._resolve=d;this._reject=c;}.bind(this));}}));
/*---
/js/bs/stopBuild.js
---*/
if(BS.AbstractModalDialog&&BS.AbstractWebForm){BS.StopBuildDialog=OO.extend(BS.AbstractWebForm,OO.extend(BS.AbstractModalDialog,{operationKind:0,formElement:function(){return $("stopBuildForm");},getContainer:function(){return $("stopBuildFormDialog");},handleBuildNotFound:function(){$j("#removeQueuedBuildComment").hide();$j("#submitRemoveQueuedBuild").hide();this.refreshPageAfterClose=true;},afterClose:function(){if(this.refreshPageAfterClose){this.refreshPageAfterClose=false;$j("#removeQueuedBuildComment").show();$j("#submitRemoveQueuedBuild").show();$j("#moreToStopFragment").hide();BS.reload(true);}},showStopBuildDialog:function(g,e,b,h,d,a){this.noReload=a;if(g.length==0){alert("Please select at least one build.");return;}this.enable();this.operationKind=b;this.stayOnPage=d;this.formElement().operationKind.value=b;if(!!h&&$(h)){$("moreToStopRetryNotice").innerHTML=$(h).innerHTML;$("moreToStopRetryNotice").hidden=false;}else{$("moreToStopRetryNotice").innerHTML="";$("moreToStopRetryNotice").hidden=true;}switch(b){case 1:var f=g.length>1?g.length+" builds":'build&nbsp;<span id="stopBuildNumber"></span>';$("stopBuildFormTitle").innerHTML="Remove "+f+"&nbsp;from the queue";this.formElement().submit.value="Remove";break;case 2:$("stopBuildFormTitle").innerHTML='Stop running build&nbsp;<span id="stopBuildNumber"></span>';this.formElement().submit.value="Stop";break;case 3:$("stopBuildFormTitle").innerHTML="Remove this build";this.formElement().submit.value="Remove";break;}var c=document.getElementById("stopBuildNumber");if(c!=null){ReactUI.renderBuildNumber(c,{buildId:g[0],hideStar:true,withLink:true,className:"titleBuildNumber"});}$("moreToStopFragment").innerHTML="";$("moreToStop").style.display="none";this.formElement().kill.value=g.join(",");if(g.length==1){$("moreToStop").style.display="block";this.disable();BS.ajaxUpdater("moreToStopFragment",window["base_uri"]+"/promotionGraph.html",{parameters:"buildPromotionId="+new String(g[0])+"&jsp=moreToStop.jsp"+"&operationKind="+b,evalScripts:true,onComplete:function(){$("moreToStop").style.display="none";if(b==3){$j("#reAddSection").hide();}BS.StopBuildDialog.initSelectAll();BS.StopBuildDialog.initDependencyCheckbox();BS.StopBuildDialog.enable();}});}this.formElement().comment.value=e!=null&&e.length>0?e:this.formElement().comment.defaultValue;this.showCentered();$(this.formElement().comment).activate();this.bindCtrlEnterHandler(this.killBuild.bind(this));this.setSaving(false);this.killPromise=$j.Deferred();return this.killPromise.promise();},savingIndicator:function(){return $("stopBuildIndicator");},killBuild:function(c){if(c){this.formElement().kill.value=c;}if(this.formElement().comment.value==this.formElement().comment.defaultValue){this.formElement().comment.value="";}if(this.isVisible()){this.setSaving(true);this.disable();}var a=this;var b=this.serializeParameters();BS.ajaxRequest(this.formElement().action,{parameters:b,onSuccess:function(h){var m=BS.Util.documentRoot(h);var g=function(){if(a.isVisible()){a.setSaving(false);a.enable();a.close();}if(BS.EventTracker){BS.EventTracker.checkEvents();}if(BS.QueuedBuildsPopup&&BS.QueuedBuildsPopup.isShown()){BS.QueuedBuildsPopup.hidePopup();}};switch(a.operationKind){case 1:if(BS.Queue){var k=m.getElementsByTagName("unqueuedBuild");if(k&&k.length>0){var d=[];for(var j=0;j<k.length;j++){var l=k[j].firstChild.nodeValue;d.push(l);}BS.Queue.removeQueuedBuilds(d,g);}else{BS.Queue.refreshQueuedBuilds(g);}return;}a.setCancelling();g();return;case 2:var f=m.getElementsByTagName("stoppedBuild");if(f){for(var j=0;j<f.length;j++){var o=f[j].firstChild.nodeValue;a.setStopping(o);}}g();return;case 3:if(!a.noReload){if(a.stayOnPage){window.location.reload();}else{var n=m.getElementsByTagName("bt")[0].firstChild.nodeValue;var e=window["base_uri"]+"/viewType.html?buildTypeId="+n;window.location=e;}}if(a.killPromise!=null){a.killPromise.resolve();}g();return;}},onFailure:function(){if(a.isVisible()){a.setSaving(false);a.enable();}alert("Sorry, error accessing the server");}});return false;},setStopping:function(b){var a=function(d){var c=$("stopBuild:"+b+":link");if(c){c.innerHTML=d;c.addClassName("stopping");}};this.killPromise&&this.killPromise.resolve(true);a('<span class="stopping">Stopping</span>');if($("stopBuild:"+b+":message")){$("stopBuild:"+b+":message").innerHTML="This build has already been stopped by <em>you</em>";}setTimeout(function(){a('<span class="stopping" title="TeamCity cannot stop this build. Please log in to the build agent and resolve the situation manually.">Cannot stop</span>');},5*60*1000);},setCancelling:function(){this.killPromise&&this.killPromise.resolve(true);},initSelectAll:function(){var a=this;$j("#killAll").change(function(){a.changeOtherBuilds(this.checked);});},changeOtherBuilds:function(b){var a=$j("#moreToStopFragment input[name='kill']");a.each(function(){this.checked=b;});},initDependencyCheckbox:function(){var a=this;$j("#withUnsharedDeps").change(function(){a._selectAndDisableDependentBuilds(this.checked);BS.User.setBooleanProperty("stopBuildWithUnsharedDependencies",this.checked);});},_selectAndDisableDependentBuilds:function(a){var b=$j("#moreToStopFragment input[data-dependent-build='true']");b.each(function(){if($j(this).attr("data-safe-remove")){this.checked=a;}this.disabled=a;});}}));}
/*---
/js/bs/customControl.js
---*/
BS.CustomControl={AbstractControl:{getControlValue:function(){throw"Not Implemented";},errorsProcessor:{onComplexError:function(a){}}}};
/*---
/js/bs/parameters.js
---*/
BS.TypedParameters={};BS.TypedParameters.create=function(){return{containerId:"contextId",submitUrl:"",components:{},extra:{},AbstractControl:OO.extend(BS.CustomControl.AbstractControl,{}),AbstractSubmitResult:{},register:function(b){var a=OO.extend(this.AbstractControl,{id:b,getControlValue:function(){var c=$(a.id);if(c==null){return null;}return c.getValue();}});this.components[b]=a;return function(c){if(c.getControlValue){a.getControlValue=c.getControlValue.bind(c);}if(c.errorsProcessor){for(var d in c.errorsProcessor){a.errorsProcessor[d]=c.errorsProcessor[d].bind(c.errorsProcessor);}}};},getInternalValues:function(){var a={};for(var c in this.components){var b=this.components[c];a["custom_control:"+c]=b.getControlValue();}return a;},AbstractSubmitValuesParameters:{onComplete:function(a){},onError:function(a){},onFailure:function(){}},getSubmitValues:function(c){var b=this;var a=OO.extend(this.getInternalValues(),{contextId:b.containerId});c=OO.extend(this.AbstractSubmitValuesParameters,c);BS.ajaxRequest(b.submitUrl,{method:"post",parameters:Object.toQueryString(a),onComplete:function(d){c.onComplete(d.responseJSON);},onFailure:function(){c.onFailure();},onException:function(f,d){c.onError(d);}});},AbstractErrorInfo:{"some_control_id":{"mainError":"text","errors":{"k":"v"}}},updateErrors:function(b){var a=false;for(var e in this.components){var c=b[e];var d=this.components[e];if(c){a=true;this.showControlError(e,d,c);}else{this.hideControlError(e);}}return a;},hideErrors:function(){for(var a in this.components){this.hideControlError(a);}},_controlErrorElements:function(b,a){$j("#"+b+"_container span.error").each(a);},showControlError:function(c,b,a){if(a.mainError){this._controlErrorElements(c,function(){$j(this).text(a.mainError);});}},hideControlError:function(a){this._controlErrorElements(a,function(){$j(this).html("");});},createFormSaver:function(a,d){var c=this;if(!a){a=BS.PasswordFormSaver;}var b=a.save.bind(a);return OO.extend(a,{save:function(f,i,g,e){var h=this;if(!_.any(c.components)){b.apply(h,[f,i,g,e]);return;}g.onBeginSave(f);c.getSubmitValues({onComplete:function(n){if(d){c.hideErrors();var s=c.updateErrors(n.errors);if(s){g.onCompleteSave(f,$j("<empty/>"),true,"custom controls save");return;}}var m=f.serializeParameters();var q={};var p=false;for(var o in n.nameToValues){p=true;q["prop:"+o]=n.nameToValues[o];}if(!p){g.onCompleteSave(f,$j("<empty/>"),true,"custom controls save");BS.reload(true);return;}var r=Object.toQueryString(q);var j=m+"&"+r;var l=OO.extend(g,{onBeginSave:function(){}});var t=OO.extend(f,{serializeParameters:function(){return j;}});b.apply(h,[t,i,l,e]);},onError:function(j){g.onError(f,j);},onFailure:function(){g.onFailure(f);}});}});}};};
/*---
/js/bs/editParameters.js
---*/
BS.BaseSaveParameterListener=OO.extend(BS.SaveConfigurationListener,{onBeginSave:function(a){a.formElement().parameterName.value=BS.Util.trimSpaces(a.formElement().parameterName.value);a.clearErrors();a.hideSuccessMessages();a.disable();a.setSaving(true);}});BS.EditParameterForm=OO.extend(BS.AbstractWebForm,{setSaving:function(a){if(a){BS.Util.show("userParamsSaving");}else{BS.Util.hide("userParamsSaving");}},formElement:function(){return $("editParamForm");},saveParameter:function(){this.formElement().submitAction.value="updateParameter";var a=this;BS.FormSaver.save(this,this.formElement().action,OO.extend(BS.BaseSaveParameterListener,{onEmptyParameterNameError:function(b){$("error_parameterName").innerHTML=b.firstChild.nodeValue.escapeHTML();a.highlightErrorField($("parameterName"));},onParameterSpecError:function(b){$("error_parameterSpec").innerHTML=b.firstChild.nodeValue.escapeHTML();a.highlightErrorField($("parameterSpec"));},onParameterValueError:function(b){$("error_parameterValue").innerHTML=b.firstChild.nodeValue.escapeHTML();a.highlightErrorField($("parameterValue"));},onPasswordConversionError:function(b){var c=b.firstChild.nodeValue.escapeHTML();if(confirm(c)){$("parameterValue").value="";a.saveParameter();}},onCompleteSave:function(c,d,b){BS.ErrorsAwareListener.onCompleteSave(c,d,b);c.enable();if(!b){a.updateParamLists();BS.EditParameterDialog.close();}}}));return false;},doRemoveParameter:function(b,d){var c=this;var a=this.formElement().action+"&submitBuildType=1&submitAction=removeParameter&removedPropertyId="+b+"&paramType="+d;BS.ajaxRequest(a,{onComplete:function(f){var e=$j(f.responseXML).find("error");if(e.length>0){e.each(function(g,h){alert($j(h).text());});}else{c.updateParamLists();BS.EditParameterDialog.close();}}});},removeParameter:function(a,b){if(!confirm("Are you sure you want to delete this parameter?")){return;}this.doRemoveParameter(a,b);},resetParameter:function(a,b){if(!confirm("Are you sure you want to reset the parameter to its template value?")){return;}this.doRemoveParameter(a,b);},updateParamLists:function(){BS.reload(true);},toggleInheritedParams:function(b,a){$j("#"+a+" .inheritedParam").each(function(){if(b){this.show();}else{this.hide();}});if(b){$j("#"+a+" .parametersTable").show();}else{$j("#"+a+" .parametersTable").each(function(){if($j(this).find(".ownParam").size()==0){$j(this).hide();}});}}});BS.EditParameterDialog=OO.extend(BS.AbstractModalDialog,{getContainer:function(){return $("editParamFormDialog");},showSpecEditFields:function(b,a){if(b){BS.Util.hide("parameterSpecHolderExpand");BS.Util.show("parameterSpecHolderEdit");}else{BS.Util.show("parameterSpecHolderExpand");BS.Util.hide("parameterSpecHolderEdit");}if(a){this.updateVisibilityHandlers();}},showDialog:function(c,f,b,h,l,e,n,g,d){BS.EditParameterForm.clearErrors();if(l){BS.EditParameterForm.disable();}else{BS.EditParameterForm.enable();}var a=c.firstChild?c.textContent:"";var k=f.firstChild?f.textContent:"";var m=n.firstChild?n.textContent:"";var i=a.length==0;var j=function(o){o=o.replace(/##10##/g,"\n");o=o.replace(/##13##/g,"\r");return o;};k=j(k);m=j(m);$("currentName").value=a;$("parameterName").value=a;$("currentNameWithPrefix").value=a;$j("#paramType").val(b).ufd("changeOptions");$("parameterSpec").value=m;$("editParamFormTitle").innerHTML=i?"Add New Parameter":(l||h?"View Parameter":"Edit Parameter");if(g){$j("#editParamForm .submitButton").val("Save");}else{if(h&&!d){$j("#editParamForm .submitButton").val("Override");}else{if(d){$j("#editParamForm .submitButton").val("Copy");}else{$j("#editParamForm .submitButton").val("Save");}}}this.showSpecEditFields(m.length>0);this.showCentered();$("parameterValue").value=k;this.bindCtrlEnterHandler(function(){BS.EditParameterForm.saveParameter();});if(l){return;}Form.Element.enable($("parameterValue"));if(h){Form.Element.disable($("parameterName"));Form.Element.disable($("parameterSpec"));Form.Element.disable($("editParameterSpec"));$("inheritedParamName").show();if($("parameterSpec").value.indexOf("readOnly='true'")>=0){Form.Element.disable($("parameterValue"));}else{$("parameterValue").focus();}}else{if(e){Form.Element.disable($("parameterName"));Form.Element.enable($("parameterSpec"));Form.Element.enable($("editParameterSpec"));$("parameterValue").focus();}else{if(!i){Form.Element.enable($("parameterName"));Form.Element.enable($("parameterSpec"));Form.Element.enable($("editParameterSpec"));$("parameterValue").focus();}else{Form.Element.enable($("parameterName"));Form.Element.enable($("parameterSpec"));Form.Element.enable($("editParameterSpec"));$("inheritedParamName").hide();$("parameterName").focus();}}}BS.AvailableParams.attachPopups($("editableObjectId").value,"buildTypeParams");this.updateVisibilityHandlers();},updateVisibilityHandlers:function(){BS.VisibilityHandlers.updateVisibility(this.getContainer());},cancelDialog:function(){this.close();},completionItemSelected:function(c,d){var b=$j(this).data("sliced_text");var a=b.before_length+d.item.value.length+1;this.value=b.before+d.item.value+"%"+b.after;$j("#parameterValue").attr({selectionStart:a,selectionEnd:a});return false;},removeSystemPrefix:function(a){return a.replace(/^system\./,"");},removeEnvPrefix:function(a){return a.replace(/^env\./,"");},removeSystemAndEnvPrefixes:function(a){return a.replace(/^((system|env)\.)*/,"");},removePrefixes:function(a,b){if(a==="system"){return BS.EditParameterDialog.removeEnvPrefix(b);}else{if(a==="env"){return BS.EditParameterDialog.removeSystemPrefix(b);}else{return BS.EditParameterDialog.removeSystemAndEnvPrefixes(b);}}},createParamTypeChangeHandler:function(a,b){return function(){var f=a.val(),e=b.val(),d=e,c=BS.AvailableParams.getCursorPosition(b.attr("id"));e=this.removePrefixes(f,e);e=this.addTypePrefixMaybe(f,e);if(d!==e){$j(b).val(e);BS.AvailableParams.setCursorPosition(b.get(0),c);}}.bind(BS.EditParameterDialog);},createParamNameChangeHandler:function(b,a){return function(){var c=b.val();a.val(/^env\./.test(c)?"env":/^system\./.test(c)?"system":"conf").trigger("change");};},splitAt:function(b,a){return{prefix:b.slice(0,a),suffix:b.slice(a+1,b.length)};},addTypePrefixMaybe:function(b,a){if(this.hasTypePrefix(b,a)){return a;}else{return b+"."+a;}},hasTypePrefix:function(a,b){return a==="conf"||b.substring(0,a.length+1)===a+".";},canChangeSelectValue:function(a){return a.keyCode===$j.ui.keyCode.UP||a.keyCode===$j.ui.keyCode.DOWN||a.keyCode===$j.ui.keyCode.PAGE_UP||a.keyCode===$j.ui.keyCode.PAGE_DOWN||a.keyCode===$j.ui.keyCode.HOME||a.keyCode===$j.ui.keyCode.END||a.keyCode===67||a.keyCode===69||a.keyCode===83;}});BS.EditParametersSpecDialog=OO.extend(BS.AbstractWebForm,OO.extend(BS.AbstractModalDialog,{formElement:function(){return $("parameterSpecEditForm");},getContainer:function(){return $("parameterSpecEditFormDialog");},showDialog:function(a){var b=this;$("error_parameterSpec").update("");BS.Util.show("parameterSpecEditFormContentLoading");BS.ajaxUpdater("parameterSpecEditFormContent",this.formElement().action,{method:"get",evalScripts:true,parameters:{spec:encodeURIComponent(a),init:1},onComplete:function(f){BS.Util.hide("parameterSpecEditFormContentLoading");var e=f.responseXML;if(e){var d=false;var c=function(g){$("error_parameterSpec").update(g.escapeHTML());d=true;};BS.XMLResponse.processErrors(e,{onSPEC_ERRORError:function(){c("Failed to parse parameter specification");},onUNKNOWN_TYPEError:function(){c("Unknown parameter type");},onNO_EDITORError:function(){c("Specified parameter type does not support edit");}});if(d){return;}}b.initializeParameterEdit();b.showCentered();b.bindCtrlEnterHandler(b.submitDialog.bind(b));BS.Util.reenableForm(b.formElement());b.updateSelectedType();BS.VisibilityHandlers.updateVisibility(b.formElement());BS.MultilineProperties.updateVisible();}});return false;},updateSelectedType:function(){var c=this;var a=$("specParameterTypeChooser").value;if(a==""){a="--not_selected--";var b=true;}var d="type="+a;$("parameterSpecEditFormSubmit").disabled=b;$("parameterSpecEditFormSubmit").title=b?"Select parameter type":"";
$("specParameterEditorContainer").refresh(null,d,function(){c.showCentered();BS.VisibilityHandlers.updateVisibility(c.formElement());BS.MultilineProperties.updateVisible();});},initializeParameterEdit:function(){jQuery("#specParameterTypeChooser").change(this.updateSelectedType.bind(this));},closeDialog:function(){this.close();},submitDialog:function(){var a=this;BS.Util.show("parameterSpecEditFormSaving");BS.FormSaver.save(this,this.formElement().action,OO.extend(BS.ErrorsAwareListener,{onCompleteSave:function(f,g,e){BS.Util.hide("parameterSpecEditFormSaving");var d=BS.XMLResponse.processErrors(g,{},BS.PluginPropertiesForm.propertiesErrorsHandler);BS.ErrorsAwareListener.onCompleteSave(f,g,e);if(d){BS.Util.reenableForm(a.formElement());return;}var b=g.getElementsByTagName("paramter-spec")[0];var c=b.getAttribute("spec");if(c){$("parameterSpec").value=c;BS.EditParameterDialog.showSpecEditFields(true);BS.EditParameterDialog.updateVisibilityHandlers();}f.close();}}));return false;}}));
/*---
/js/bs/branch.js
---*/
/*
 * Copyright 2000-2021 JetBrains s.r.o.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

// Facility for build branches.

BS.Branch = {
  WILDCARD_NAME: "__all_branches__",  // BranchUtil.WILDCARD_BRANCH
  DEFAULT_NAME: "<default>",         // BranchUtil.DEFAULT_BRANCH_NAME and Branch.DEFAULT_BRANCH_NAME
  UNSPECIFIED_NAME: "<unspecified>",          // BranchUtil.DEFAULT_BRANCH_NAME and Branch.DEFAULT_BRANCH_NAME
  STORAGE_PREFIX: "jb.teamcity.branch.", // Prefix for localStorage / sessionStorage keys

  baseUrl: null,                      // The URL where branch links should lead to (by default, build type overview page).
  _branches: {},                      // Holds the branches per project (on a current page).

  filterHistoryByBranch: null,        //will be set during branch selector processing
  branchParamPrefix: 'branch_',       // we encode branch in URL in the following format: branch_<externalProjectId>=<branchName>

  _allBranchesTabNames : [
    "buildTypeStatusDiv",
    "buildTypeChains",
    "buildTypeHistoryList",
    "buildTypeChangeLog",
    "buildTypeIssueLog",
    "projectBuildChains",
    "testDetails",
    "projectChangeLog",
    "buildTypeStatistics",
    "stats"
  ],

  _activeBranchesTabNames: [
    "projectOverview",
    "buildTypeBranches",
    "pendingChangesDiv"
  ],

  _wildcardName: function(options, noEscaping){
    var wildcardName = options.wildcardDisplayName;
    var tab = options.tab;
    if (!wildcardName) {
      wildcardName = this._allBranchesTabNames.indexOf(tab) > -1  ?
                     "&lt;All branches&gt;" :
                     "&lt;Active branches&gt;";
    }
    return !noEscaping ? wildcardName : wildcardName.replace('&lt;','<').replace('&gt;','>');
  },

  saveBranch: function(projectExternalId, selectedBranch) {
    var branch = this.getNonWildCardBranch(selectedBranch);
    var key = this.STORAGE_PREFIX + projectExternalId;
    branch != null
      ? localStorage.setItem(key, branch)
      : localStorage.removeItem(key);
    this.registerProjectBranch(projectExternalId, selectedBranch);
  },

  _addChangeHandler: function(options, selectedBranch) {
    var projectInternalId = options.projectInternalId;
    var projectExternalId = options.projectExternalId;
    this.saveBranch(projectExternalId, selectedBranch);

    var search = BS.Branch._getSearch(window.location.search, selectedBranch, projectExternalId);
    if (!BS.Branch.getBranchGroupId(selectedBranch)) {
      search = search.replace(/tab=buildTypeBranches/g, "tab=buildTypeStatusDiv");    // See TW-22583.
    }

    var that = this;

    if (options.save) {  // overview page
      BS.User.setProperty("ui.overview.branch." + projectInternalId, selectedBranch, {
        afterComplete: function() {
          that.registerProjectBranch(projectExternalId, selectedBranch);
          BS.Projects.updateProjectView(projectInternalId, projectExternalId, options.isFirst, true);
        }
      });
    } else if (options.replace) {
      var parser = document.createElement('a');
      parser.href = window.location.href;
      parser.search = search;
      window.location.replace(parser.href);
    } else {
      window.location.search = search;
    }
  },

  isDefault: function(branch, defaultBranchVcsName) {
    return branch == this.DEFAULT_NAME || branch == defaultBranchVcsName
  },

  _discoverName: function(branch, defaultBranchVcsName){
    if (branch == this.WILDCARD_NAME){
      return "<All branches>";
    }
    if (this.isDefault(branch, defaultBranchVcsName)) {
      return "<Default branch>";
    }
    return branch;
  },

  stringifyBranch: function(selected) {
    if (!selected) {
      return this.WILDCARD_NAME;
    }
    if (selected.groupFlag) {
      return '__' + selected.internalName + '__';
    }
    if (selected.default) {
      return this.DEFAULT_NAME;
    }
    if (selected.unspecified) {
      return this.UNSPECIFIED_NAME;
    }
    return selected.name;
  },

  parseBranch: function(userBranch, defaultBranchVcsName) {
    if (!userBranch || userBranch === this.WILDCARD_NAME) {
      return null
    }

    var name = this._discoverName(userBranch, defaultBranchVcsName);
    var groupId = this.getBranchGroupId(userBranch);
    var isGroup = groupId != null;

    return {
      name: isGroup ? '<Branch group>' : name,
      internalName: isGroup ? groupId : name,
      default: this.isDefault(userBranch, defaultBranchVcsName),
      groupFlag: isGroup
    }
  },

  renderReactDropdown: function(userBranch, id, handleLoad, options, minimalistic) {
    ReactUI.renderConnected(id, ReactUI.BranchSelect, {
      className: 'branch-search',
      old: true,
      minimalistic: minimalistic,
      projectOrBuildTypeNode: options.buildTypeExternalId != null
                              ? {nodeType: 'bt', id: options.buildTypeExternalId}
                              : {nodeType: 'project', id: options.projectExternalId},
      buildTypeInternalId: options.buildTypeInternalId,
      projectInternalId: options.projectInternalId,
      activeOnly: this._allBranchesTabNames.indexOf(options.tab) == -1,
      includeSnapshots: options.includeSnapshots,
      includeSubprojects: options.includeSubprojects,
      selected: this.parseBranch(userBranch),
      onSelect: function(selected, replace) {
        options.replace = replace;
        BS.Branch._addChangeHandler(options, BS.Branch.stringifyBranch(selected));
      },
      onLoad: handleLoad
    });
  },

  installRestDropdownToBreadcrumb: function(userBranch, options) {
    if (!document.getElementById('restPageTitle')) {
      return;
    }

    function handleLoad(data) {
      if (data.shouldBeVisible){
        $j(wrapper).css('display', 'inline-block');
      }
      BS.Branch.filterHistoryByBranch = data.shouldBeVisible;
      BS.Branch.defaultBranchVcsName = data.defaultBranchVcsName;
      document.dispatchEvent(new CustomEvent("tc.branchSelectorIsReady", {
        bubbles: true,
        detail: {
          hasBranches: data.shouldBeVisible,
          defaultBranchVcsName: data.defaultBranchVcsName
        }
      }));
    }

    var tabsContainer = $j("#tabsContainer3");
    var branchInBreadcrumbsSelector = $j("#restPageTitle .branch-search");

    if (branchInBreadcrumbsSelector.length > 0) {
      return;
    }

    var tab = options.tab;

    this.registerProjectBranch(options.projectExternalId, userBranch);

    var self = this;

    window.setTimeout(function(){
      self.injectBranchParamToLinks(tabsContainer, options.projectExternalId);
    }, 150);

    if (tab != undefined && this._allBranchesTabNames.indexOf(tab) == -1  && this._activeBranchesTabNames.indexOf(tab) == -1){
      return; // we don't need branch selector on this tab
    }

    var name = this._wildcardName(options, true);
    var initialName = userBranch;
    if (userBranch == this.WILDCARD_NAME){
      userBranch = name;
    }

    var visibility = (userBranch !== undefined && userBranch != name && userBranch !=  this.DEFAULT_NAME) ? 'inline-block' : 'none';

    var id = 'branchSelect_' + options.projectExternalId || options.buildTypeExternalId;

    var wrapper = $j("<div class='branchSearchWrapper' style='display:" + visibility + ";'><div id='" + id + "'></div></div></div>").insertAfter('#restPageTitle .selected');

    this.renderReactDropdown(
      initialName,
      id,
      handleLoad,
      options,
      true
    );
  },

  renderBuildList: function(userBranch, isAllBranches, renderFn){
    if (isAllBranches || userBranch == undefined || userBranch == 'undefined' || userBranch.trim().length == 0) {
      renderFn();
      return;
    }

    if (BS.Branch.filterHistoryByBranch != null) {
      renderFn(BS.Branch.parseBranch(userBranch, BS.Branch.defaultBranchVcsName));
    } else {
      document.addEventListener('tc.branchSelectorIsReady', function (e) {
        var hasBranches = e.detail.hasBranches;
        var defaultBranchVcsName = e.detail.defaultBranchVcsName;
        renderFn(hasBranches ? BS.Branch.parseBranch(userBranch, defaultBranchVcsName) : null);
      }, false);
    }
  },

  registerProjectBranch: function(projectExtId, userBranch) {
    var key = this.STORAGE_PREFIX + projectExtId;
    if (userBranch === this.WILDCARD_NAME) {
      this._branches[projectExtId] = null;
      sessionStorage.removeItem(key);
    } else if (userBranch != null) {
      this._branches[projectExtId] = userBranch;
      sessionStorage.setItem(key, userBranch);
    }
  },

  createHandleLoad: function(paneId) {
    return function(data) {
      var pane = $j(paneId);
      if (data.shouldBeVisible) {
        pane.css('display', 'inline-block');
      }
    }
  },

  installRestDropDownToProjectPane: function(paneId, userBranch, options) {
    var pane = $j(paneId);
    var handleLoad = this.createHandleLoad(paneId);

    options.save = true;

    var name = this._wildcardName(options, true);
    var initialName = userBranch;
    if (userBranch == this.WILDCARD_NAME){
      userBranch = name;
    } else {
      this.registerProjectBranch(options.projectExternalId, userBranch);
    }

    var innerId = paneId + '_inner';
    pane.append('<div id="' + innerId + '"></div>');
    pane.click(function(e) {
      e.stopPropagation();
    });
    this.renderReactDropdown(
      initialName,
      innerId,
      handleLoad,
      options
    );
  },

  _isBranchesTab: function(search) {
    var params = new URLSearchParams(search || location.search);
    return params.get('tab') === 'buildTypeBranches';
  },

  /**
   * <p>Adds the branch parameter to all anchor elements referencing a project
   * or a build configuration, depending on currently selected branch. If no
   * branch is selected, {@link WILDCARD_NAME} value is used.</p>
   *
   * <p>If you need an anchor element within the <code>container</code> to
   * be skipped by this method, add <code>js_ignore-branch</code> class to such
   * an anchor.</p>
   *
   * @param {jQuery} container
   * @param {String} projectExternalId
   * @external jQuery
   */
  injectBranchParamToLinks: function(container, projectExternalId) {
    var /**String*/ branch = this.getBranch(projectExternalId);
    if (branch == null) {
      return;
    }
    var isCustomBranchGroup = branch != this.WILDCARD_NAME && BS.Branch.getBranchGroupId(branch);
    // TW-63088
    if (!isCustomBranchGroup && BS.Branch._isBranchesTab()) {
      return
    }

    var /**BS.Branch*/ that = this;
    container.find("a:not(.js_ignore-branch)").each(function() {
      var /**HTMLAnchorElement*/ link = this;
      var /**String*/ href = link.getAttribute("href");

      if (!href || href.startsWith("#") || href.startsWith("javascript:")) {
        return;
      }

      // One more exception. See TW-22583.
      if (!isCustomBranchGroup && BS.Branch._isBranchesTab(link.search)) {
        // TW-63088
        link.addEventListener('click', function(e) {
          if (e.button === 0 && !e.altKey && !e.ctrlKey && !e.metaKey && !e.shiftKey) {
            BS.Branch.saveBranch(projectExternalId, null);
          }
        });
        return;
      }

      /*-
       * Inject branch parameter into links in breadcrumb.
       */
      if (href.indexOf("viewType.html") >= 0 || href.indexOf("project.html") >= 0 || href.indexOf("viewLog.html") >= 0 || href.indexOf("viewQueued.html") >= 0) {
        link.search = that._getSearch(link.search, branch, projectExternalId);
      }
    });
  },

  getLink: function(buildTypeExternalId, projectExternalId, branch) {
    var url = this.baseUrl;
    if (!url) {
      url = window["base_uri"] + "/viewType.html?buildTypeId=" + buildTypeExternalId;
    }
    return this._getUrl(url, branch, projectExternalId);
  },

  setLink: function(link, buildTypeExternalId, projectExternalId, branch) {
    if (link.getAttribute('href') == "#") {
      link.setAttribute("href", this.getLink(buildTypeExternalId, projectExternalId, branch));
    }
  },

  _getSearch: function(search, branch, projectExternalId) {
    var query = search.toQueryParams();
    for (var param in query) {
      if (param.indexOf(this.branchParamPrefix) != -1) { // remove all other branch_ parameters
        delete query[param];
      }
    }
    query[this.branchParamPrefix + projectExternalId] = branch;  // No need to escape. toQueryString() will do that.
    return Object.toQueryString(query);
  },

  _getUrl: function(url, branch, projectExternalId) {
    var parser = document.createElement('a');
    parser.href = url;
    parser.search = this._getSearch(parser.search, branch, projectExternalId);
    return parser.href
  },

  getNonWildCardBranch: function(branch) {
    return branch !== this.WILDCARD_NAME ? branch : null;
  },

  getBranch: function(projectExternalId, noStorage) {
    var branch = this._branches[projectExternalId]
      || window.location.search.toQueryParams()[this.branchParamPrefix + projectExternalId]
      || !noStorage && sessionStorage.getItem(this.STORAGE_PREFIX + projectExternalId)
      || !noStorage && localStorage.getItem(this.STORAGE_PREFIX + projectExternalId)
      || null;
    return this.getNonWildCardBranch(branch);
  },

  addBranchToParams: function(params, projectExternalId) {
    var branch = this.getBranch(projectExternalId, true);
    if (branch) {
      params[this.branchParamPrefix + projectExternalId] = branch;
    }
  },

  addAllBranchesFromStorage: function(storage, params) {
    Object.keys(storage).filter(function (key) {
      return key.indexOf(BS.Branch.STORAGE_PREFIX ) === 0;
    }).forEach(function (key) {
      var projectExternalId = key.slice(BS.Branch.STORAGE_PREFIX.length);
      params[BS.Branch.branchParamPrefix + projectExternalId] = storage.getItem(key);
    }.bind(this));
  },

  getAllBranches: function() {
    var params = {};
    try {
      this.addAllBranchesFromStorage(localStorage, params);
      this.addAllBranchesFromStorage(sessionStorage, params);
    } catch (e) {
      //Ignore errors
    }
    Object.keys(this._branches).forEach(function(key) {
      params[BS.Branch.branchParamPrefix + key] = BS.Branch._branches[key] || BS.Branch.WILDCARD_NAME;
    });
    return params;
  },

  isCustomBranch: function(branch) {
    return branch && !(branch == this.WILDCARD_NAME || branch == this.DEFAULT_NAME || BS.Branch.getBranchGroupId(branch) != null);
  },

  getBranchGroupId: function(userBranch) {
    if (
      userBranch
      && userBranch !== BS.Branch.WILDCARD_NAME
      && userBranch.startsWith("__")
      && userBranch.endsWith("__")
    ) {
      return userBranch.substring(2, userBranch.length - 2);
    }
    return null;
  }
};

/*---
/js/bs/vcsSettings.js
---*/
BS.EditVcsUsername=OO.extend(BS.AbstractModalDialog,{getContainer:function(){return $("editVcsSettingsDialog");},showEditDialog:function(b,a,c){BS.Util.hide("vcsRootSelector");$("editVcsSettingsTitle").innerHTML=c;$("vcsUsername").value=a;$("vcsUsernameKey").value=b;this.showCentered();this.bindCtrlEnterHandler(this.submitUsername.bind(this));setTimeout(function(){$("vcsUsername").focus();}.bind(this),250);},showAddDialog:function(a){BS.Util.show("vcsRootSelector");$("editVcsSettingsTitle").innerHTML="Add VCS username";$("vcsUsername").value=a;$("vcsUsernameKey").value="";$("vcsRoot").onchange();this.showCentered();this.bindCtrlEnterHandler(this.submitUsername.bind(this));$("vcsRoot").focus();},deleteUsername:function(a){var b=$("editVcsSettings");BS.confirm("Are you sure you want to delete this username?",function(){BS.ajaxRequest(b.action,{parameters:"vcsUsernameKey="+a+"&vcsUsername="+"&userId="+b.userId.value,onComplete:function(){$("vcsUsernames").refresh();}});}.bind(this));},submitUsername:function(){var a=$("editVcsSettings");BS.Util.show("savingUsername");Form.disable(a);BS.ajaxRequest(a.action,{parameters:BS.Util.serializeForm(a),onComplete:function(){BS.Util.hide("savingUsername");BS.EditVcsUsername.close();$("vcsUsernames").refresh();}});return false;}});BS.VcsUsername={addVcsNameFromModification:function(a){BS.confirm("Add this vcs username to your profile?",function(){var c=function(){BS.reload(true);};var b=function(d){alert(d);};this.addVcsNameByModId(a,null,c,b);}.bind(this));},viewModificationAddVcsName:function(b,a){BS.confirm('Add VCS username "'+a+'" to your profile?',function(){var d=function(){$j("#addVcsNameProgress").show();};var e=function(){BS.reload(true);};var c=function(f){$j("#addVcsNameProgress").hide();alert(f);};this.addVcsNameByModId(b,d,e,c);}.bind(this));},addVcsNameByModId:function(d,b,c,a){if(b){b();}BS.ajaxRequest(window["base_uri"]+"/ajax.html",{parameters:"addVcsUsername="+d,onComplete:function(f){var e=BS.XMLResponse.processErrors(f.responseXML,{},function(i,g){var h=g.firstChild.nodeValue;if(a){a(h);}else{alert(h);}});if(!e&&c){c();}}});}};
/*---
/js/bs/editAccessToken.js
---*/
BS.AccessTokenForm = OO.extend(BS.AbstractModalDialog, {
  getContainer: function () {
    return $('editAccessTokenFormDialog');
  },

  getForm: function () {
    return $('editAccessTokenForm');
  },

  $j: function (id) {
    return $j(BS.Util.escapeId(id));
  },


  init: function () {
    BS.AccessTokenForm.ProjectSelector = {
      getSelectorId: function () {
        return "accessTokenProjects";
      },

      $getSelector: function () {
        return BS.AccessTokenForm.$j(BS.AccessTokenForm.ProjectSelector.getSelectorId());
      },

      currentlySelectedProjectId: function () {
        return BS.AccessTokenForm.ProjectSelector.$getSelector().val();
      }
    };

    BS.AccessTokenForm.PermissionCheckboxes = {
      update: function (checkboxGroup) {
        var checked = checkboxGroup.checked;
        $j(checkboxGroup).parents('li').find('.permissionInput').each(function () {
          this.checked = checked;
        });
      }
    }

    $j('.mainTokenFormButtons').removeAttr('disabled');
    $j('#createTokenButton').click(function () {
      return BS.AccessTokenForm.showCreateDialog();
    });
    $j('#deleteAllTokensButton').click(function () {
      return BS.AccessTokenForm.deleteAllTokens();
    });
    var $permissionsFormFragmentContainer = $('permissionsFormFragmentContainer');
    if ($permissionsFormFragmentContainer) {
      $permissionsFormFragmentContainer.updateContainer = function () {
        BS.Util.hide('accessTokenPermissionsTr');
        BS.AccessTokenForm.disableForm();
        $permissionsFormFragmentContainer.refresh('permissionsFormFragmentContainerProgress', 'projectId=' + BS.AccessTokenForm.ProjectSelector.currentlySelectedProjectId(),
          function () {
            BS.Util.show('accessTokenPermissionsTr');
            BS.AccessTokenForm.enableForm();
          });
      }
    }

    $j('#accessTokenScoped').change(function () {
      if ($permissionsFormFragmentContainer) {
        var $el = $j(this);
        if ($el && $el.val()) {
          $permissionsFormFragmentContainer.updateContainer();
        } else {
          BS.Util.hide('accessTokenPermissionsTr');
        }
      }
    });
  },


  onProjectSelected: function () {
    $('permissionsFormFragmentContainer').updateContainer();
  },

  focusInput: function () {
    setTimeout(function () {
      Form.focusFirstElement(this.getForm())
    }.bind(this), 250);
  },

  beforeShow: function () {
    this.resetForm();
  },

  afterClose: function () {
    this.resetForm();
    this.refreshTable();
  },

  refreshTable: function () {
    $('accessTokens').refresh(function () {
      BS.UserProfile.updateTabCounter('Access Tokens', 'accessTokensTabCounter', $('accessTokensCount').innerHTML);
    });
  },

  enableForm: function () {
    Form.enable(this.getForm());
  },

  disableForm: function () {
    Form.disable(this.getForm());
  },

  resetForm: function () {
    $j('.additionalOption').removeClass('advanced_hidden');
    BS.Util.hide('error_accessTokenName');
    BS.Util.hide('accessTokenValue');
    $('input_accessTokenName').value = '';
    $('input_accessTokenExpirationTime').value = '';
    $('select_accessTokenExpirationTimeUnit').value = 'days';
    var scopedInput = $('accessTokenScoped');
    if (scopedInput) {
      scopedInput.value = '';
    }
    $j('.permissionInput').each(function () {
      $(this).checked = false;
    });
    $('createdToken').innerHTML = '';
    BS.Util.hide('tokenCreatedNotice');
    this.enableForm();
  },

  deleteAllTokens: function () {
    var form = this.getForm();
    BS.confirm('Are you sure you want to delete all access tokens?', function () {
      BS.ajaxRequest(form.action, {
        parameters: "deleteAll=true&userId=" + form.userId.value,
        onComplete: function (transport) {
          if (!BS.AccessTokenForm.handleErrors(transport)) {
            BS.AccessTokenForm.refreshTable();
          }
        }
      });
    }.bind(this));
  },

  showCreateDialog: function () {
    this.showCentered();
    this.bindCtrlEnterHandler(this.create.bind(this));
    // noinspection JSCheckFunctionSignatures
    BS.Clipboard('#clipboardToken');
    this.focusInput();
  },

  showTokenValue: function (tokenValue) {
    $('createdToken').innerHTML = tokenValue;
    $j('.additionalOption').addClass('advanced_hidden');
    BS.Util.show('tokenCreatedNotice');
    BS.Util.show('accessTokenValue');
  },

  onGenericError: function (error) {
    alert(error);
  },

  getCellValue: function (tr, idx) {
    return tr.children[idx].innerText || tr.children[idx].textContent;
  },

  simpleComparator: function (idx, asc) {
    return function (a, b) {
      return function (v1, v2) {
        return v1 !== '' && v2 !== '' && !isNaN(v1) && !isNaN(v2) ? v1 - v2 : v1.toString().localeCompare(v2);
      }(BS.AccessTokenForm.getCellValue(asc ? a : b, idx), BS.AccessTokenForm.getCellValue(asc ? b : a, idx));
    }
  },

  parseDate: function (inputDate) {
    if (inputDate === "Permanent") {
      return new Date(8640000000000000).getTime();
    }
    if (inputDate === "Never") {
      return new Date(0).getTime();
    }
    var splitDate = inputDate.split(/\s+|:/);
    var currentMonth = splitDate[1].toLowerCase();
    var months = ["jan", "feb", "mar", "apr", "may", "jun", "jul", "aug", "sep", "oct", "nov", "dec"];
    var year = 2000 + Number.parseInt(splitDate[2]);
    var month = months.indexOf(currentMonth);
    var day = Number.parseInt(splitDate[0]);
    var hour = Number.parseInt(splitDate[3]);
    var min = Number.parseInt(splitDate[4]);
    return new Date(year, month, day, hour, min).getTime();
  },

  dateComparator: function (idx, asc) {
    return function (a, b) {
      return function (v1, v2) {
        return v1 !== '' && v2 !== '' ? BS.AccessTokenForm.parseDate(v1) - BS.AccessTokenForm.parseDate(v2) : v1.toString().localeCompare(v2);
      }(BS.AccessTokenForm.getCellValue(asc ? a : b, idx), BS.AccessTokenForm.getCellValue(asc ? b : a, idx));
    }
  },

  sorted: function (el, comparator) {
    var th = $(el);
    var table = th.parentNode;
    while (table.tagName.toUpperCase() !== 'TABLE') table = table.parentNode;
    Array.prototype.slice.call(table.querySelectorAll('tr:nth-child(n+2)')).sort(
      comparator(Array.prototype.slice.call(th.parentNode.children).indexOf(th), this.asc = !this.asc)).forEach(function (tr) {
      // noinspection JSCheckFunctionSignatures
      table.appendChild(tr)
    });
  },

  dateSorted: function (el) {
    BS.AccessTokenForm.sorted(el, BS.AccessTokenForm.dateComparator);
  },

  naturalSorted: function (el) {
    BS.AccessTokenForm.sorted(el, BS.AccessTokenForm.simpleComparator);
  },

  create: function () {
    var form = this.getForm();
    BS.Util.show('savingAccessToken');
    $j('.error').each(function () {
      $j(this).empty();
    });
    BS.Util.hide('.error');
    BS.AccessTokenForm.disableForm();
    BS.ajaxRequest(form.action, {
      parameters: BS.Util.serializeForm(form),

      onComplete: function (transport) {
        BS.Util.hide('savingAccessToken');
        if (!BS.AccessTokenForm.handleErrors(transport)) {
          if (transport.responseXML && transport.responseXML.documentElement && transport.responseXML.documentElement.firstChild) {
            BS.AccessTokenForm.showTokenValue(transport.responseXML.documentElement.firstChild.textContent);
          } else {
            BS.AccessTokenForm.onGenericError("Unexpected server response");
            BS.AccessTokenForm.enableForm();
          }
        } else {
          BS.AccessTokenForm.enableForm();
        }
      }
    });
    return false;
  },

  delete: function (tokenName) {
    var form = this.getForm();
    BS.confirm("Are you sure you want to delete this token?", function () {
      BS.ajaxRequest(form.action, {
        parameters: "accessTokenName=" + tokenName + "&delete=true&userId=" + form.userId.value,
        onComplete: function (transport) {
          if (!BS.AccessTokenForm.handleErrors(transport)) {
            BS.AccessTokenForm.refreshTable();
          }
        }
      });
    }.bind(this));
  },

  handleErrors: function (transport) {
    // noinspection JSUnusedGlobalSymbols
    return BS.XMLResponse.processErrors(transport.responseXML, {
      GenericError: function (elem) {
        if (elem && elem.firstChild && elem.firstChild.nodeValue) {
          BS.AccessTokenForm.onGenericError(elem.firstChild.nodeValue);
        } else {
          BS.AccessTokenForm.onGenericError("Something went wrong");
        }
      },

      DeletionError: function (elem) {
        this.GenericError(elem);
      }
    }, function (key, elem) {
      if (key && elem) {
        var errorSpan = $('error_' + key);
        if (errorSpan) {
          errorSpan.innerHTML = elem.firstChild.nodeValue;
          BS.Util.show(errorSpan);
          BS.Util.show(elem.firstChild.nodeValue);
        }
        var errorField = $('input_' + key);
        if (errorField) {
          errorField.addClassName('errorField');
        }
        BS.AbstractWebForm.focusFirstErrorField()
      } else {
        BS.AccessTokenForm.GenericError();
      }
    });
  }
});
/*---
/js/bs/toggleOverview.js
---*/
BS.TogglePopup.toggleOverview=function(i,f,k){k=$j.extend({loadingTop:0,loadingLeft:-20,updateParent:true},k||{});var e=$j(i),c=e.children(".icon16_watched"),j="icon16_watched_no",g=!c.hasClass(j),b=g?"hideProject":"addProject",h;var d=e.offset(),a=$j(BS.loadingIcon);a.css({position:"absolute",top:d.top+k.loadingTop+"px",left:d.left+k.loadingLeft+"px",zIndex:1000}).appendTo(document.body);BS.ajaxRequest(window["base_uri"]+"/ajax.html",{parameters:b+"="+f,onComplete:function(){a.remove();},onSuccess:function(){var l,n;if(g){h="addClass";n="Click to show project on the overview page";}else{h="removeClass";n="Project is shown on the overview page. Click to hide";}c[h](j);c.attr("title",n);if(k.updateParent){e.toggleClass("pinLink");e.parents("tr.inplaceFiltered").toggleClass("visibleProject");}if(BS.TogglePopup.isOverviewPage===true){var m=$j("#overview-projects");if(m.length==0){m=$j('<div id="overview-projects">'+"Overview configuration has been changed, "+'<a href="#" onclick="BS.reload(true)">refresh the page</a> to see the changes.'+'<a href="#" class="dismiss-link" onclick="BS.Util.hide(this.parentNode)">Dismiss</a>'+"</div>");$j("#toolbar").append(m);}else{m.show();}}}});return false;};
/*---
/js/bs/pin.js
---*/
BS.Pin={_onBuildPage:false,pin:function(b,a){if(b){BS.Pin._onBuildPage=true;}return BS.Pin.togglePin(a);},unpin:function(b,a){if(b){BS.Pin._onBuildPage=true;}return BS.Pin.togglePin(a);},togglePin:function(a){var b=BS.PinBuildDialog.formElement().buildId.value;var c=$("pinLink"+b);return new Promise(function(e,d){BS.Util.show("progressIcon"+b);BS.Util.hide(c);BS.FormSaver.save(BS.PinBuildDialog,BS.PinBuildDialog.formElement().action,OO.extend(BS.ErrorsAwareListener,{onCompleteSave:function(g,h,f){if(c){$(c.parentNode).cleanWhitespace();}BS.Util.hide("progressIcon"+b);BS.Util.show(c);if(!a){BS.reload(true);}BS.PinBuildDialog.formElement().enable();e();},onFailure:function(){BS.Util.show(c);BS.Util.hide("progressIcon"+b);alert("Problem accessing server");d();}}));});},showSuccessMessage:function(a,b){var c=$("pinLink"+a);var d=c.parentNode.parentNode.parentNode;$(d).cleanWhitespace();if(b){d.addClassName("highlight");BS.Util.show("successMessage");$("successMessage").innerHTML="Pinned build won't be removed from the history list until you unpin it.";}else{BS.Util.show("successMessage");$("successMessage").innerHTML="The build has been unpinned.";}BS.Util.hideSuccessMessages();}};BS.PinBuildDialog=OO.extend(BS.AbstractWebForm,OO.extend(BS.AbstractModalDialog,{formId:"pinBuildForm",formElement:function(){return $(this.formId);},getContainer:function(){return $("pinBuildFormDialog");},onText:"Pin",offText:"Unpin",appendTag:function(a){BS.Util.addWordToTextArea(this.formElement().buildTagsInfo,a);},showPinBuildDialog:function(h,a,i,d,f,c,b){this.formElement().buildId.value=h;var g=a?this.onText:this.offText;this.formElement().pin.value=a;this.formElement().PinSubmitButton.value=g;$("pinBuildFormTitle").innerHTML=g+' build&nbsp;<span id="pinBuildNumber"></span>';ReactUI.renderBuildNumber("pinBuildNumber",{buildId:h,hideStar:true,withLink:true,className:"titleBuildNumber"});this.formElement().pinComment.value=d!=null&&d.length>0?d:this.formElement().pinComment.defaultValue;this.showTags(f,i,b);this.showCentered();this.formElement().pinComment.focus();this.formElement().pinComment.select();this.__loadTags(h);this.bindCtrlEnterHandler(this.submit.bind(this));if(c){var e=this;return new Promise(function(k,j){e._resolve=k;e._reject=j;});}return false;},__loadTags:function(a){var c=this;c.formElement().PinSubmitButton.disable();var d=$j("#pinBuildDialogSaving");var b=d.prop("title");d.prop("title","Loading tags...");d.show();$j.getJSON(window["base_uri"]+"/app/rest/ui/builds/id:"+a+"/tags",function(e){if($j(c.formElement().buildTagsInfo).is(":visible")&&e.tag){c.formElement().buildTagsInfo.value=e.tag.map(function(f){return f.name;}).join(" ");}c.formElement().PinSubmitButton.enable();d.prop("title",b);d.hide();});},submit:function(){var b=this.formElement().onBuildPage.value=="true";if(this.formElement().pinComment.value==this.formElement().pinComment.defaultValue){this.formElement().pinComment.value="";}var a=this.formElement().pin.value=="true";BS.Pin[a?"pin":"unpin"](b,!!this._resolve).then(this._resolve&&(function(){this._resolve(a);}.bind(this)),this._reject).then(BS.PinBuildDialog.close.bind(this));this.formElement().buildTagsInfo.value="";return false;},close:function(){this.formElement().buildTagsInfo.value="";this.doClose();}}));BS.TagsEditingMixin.init(BS.PinBuildDialog);
/*---
/js/bs/buildComment.js
---*/
BS.BuildCommentDialog=OO.extend(BS.AbstractWebForm,OO.extend(BS.AbstractModalDialog,{formElement:function(){return $("buildCommentForm");},getContainer:function(){return $("buildCommentFormDialog");},showBuildCommentDialog:function(b,c,a){var e=this;this.formElement().promotionId.value=b;var d=c!=null&&c.length>0;this.formElement().buildComment.value=d?c:this.formElement().buildComment.defaultValue;$("buildCommentFormTitle").innerHTML=(d?"Change":"Add")+' comment for build&nbsp;<span id="commentBuildNumber"></span>';ReactUI.renderBuildNumber("commentBuildNumber",{buildId:b,hideStar:true,withLink:true,className:"titleBuildNumber"});this.showAtFixed($(this.getContainer()));$(this.formElement().buildComment).activate();this.bindCtrlEnterHandler(this.submit.bind(this));this._doNotReload=a;return new Promise(function(g,f){e._resolve=g;e._reject=f;});},submit:function(){var b=this;var a=this.formElement();if(this.formElement().buildComment.value==this.formElement().buildComment.defaultValue){this.formElement().buildComment.value="";}BS.Util.show("buildCommentProgressIcon");BS.FormSaver.save(BS.BuildCommentDialog,BS.BuildCommentDialog.formElement().action,OO.extend(BS.ErrorsAwareListener,{onCompleteSave:function(d,e,c){BS.Util.hide("buildCommentProgressIcon");Form.enable(a);BS.BuildCommentDialog.close();if(!b._doNotReload){BS.reload(true);}b._resolve&&b._resolve(a.querySelector(".commentTextArea").value);},onFailure:function(){BS.Util.hide("buildCommentProgressIcon");alert("Problem accessing server");}}));return false;}}));