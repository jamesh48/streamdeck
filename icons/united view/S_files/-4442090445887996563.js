
/*---
/js/bs/queueLikeSorter.js
---*/
BS.QueueLikeSorter={containerId:null,getActionUrl:function(){},getActionParameters:function(b,a){},afterOrderSaving:function(){},_timoutHandle:null,scheduleUpdate:function(b,a){this.updateMoveTopIcons();if(this._timoutHandle){clearTimeout(this._timoutHandle);}this._timoutHandle=setTimeout(this.saveOrder.bind(this,b,a),1000);},updateMoveTopIcons:function(){var a=$(this.containerId);if(!a){return;}var c=a.select(".tc-icon_move-top");if(!c){return;}for(var b=0;b<c.length;b++){if(c[b]==null){continue;}if(b==0){c[b].style.visibility="hidden";}else{c[b].style.visibility="";}}},saveOrder:function(c,a){if(!c){return;}this.setOrderSaving(true);var b=this;BS.ajaxRequest(b.getActionUrl(),{parameters:b.getActionParameters(c,a),onComplete:function(e,d){b.setOrderSaving(false);b.afterOrderSaving();}});},setOrderSaving:function(a){if(a){BS.Util.hide("dataSaved");BS.Util.show("savingData");}else{window.setTimeout(function(){BS.Util.hide("savingData");BS.Util.show("dataSaved");window.setTimeout(function(){BS.Util.hide("dataSaved");},3000);},1000);}},moveToTop:function(c){var b=$(c);var a=b.parentNode;if(a.firstChild.id==b.id){return;}a.removeChild(b);a.insertBefore(b,a.firstChild);this.scheduleUpdate(a);},computeOrder:function(d,f,b){var e=[];if(b){e=$("buildQueueTable").select(b);}else{if(d.childNodes&&d.childNodes.length>0){$(d).cleanWhitespace();e=d.childNodes;}}var a="";for(var c=0;c<e.length;c++){var g=e[c].id;if(g.indexOf(f)!=0){continue;}a+=e[c].id.substring(f.length)+";";}return a;}};
/*---
/js/bs/copyProject.js
---*/
BS.AbstractCopyForm=OO.extend(BS.AbstractCopyMoveDialog,{showDialog:function(b){var c=this.formElementId()+"Container",a={};a[this.fetchParamName]=b;this._loadingTimeoutId=setTimeout(function(){BS.LoadingDialog.showCentered();this._loadingTimeoutId=null;}.bind(this),this.loaderDisplayTimeout);$j(BS.Util.escapeId(c)).remove();$j(this.formElement()).remove();$j("body").append("<div id='"+c+"'></div>");BS.ajaxUpdater($(c),window["base_uri"]+this.fetchUrl(),{method:"GET",evalScripts:true,parameters:a,onComplete:function(){this._loadingTimeoutId?clearTimeout(this._loadingTimeoutId):BS.LoadingDialog.close();this._loadingTimeoutId=null;this._onFetchDialogComplete();BS.loadRetinaImages(this.formElement());}.bind(this)});return false;},_onFetchDialogComplete:function(){var a=this;this.showCentered();$j(this.formElement().projectId).trigger("change").focus();$j(BS.Util.escapeId(this.inputId)).on("keyup change",function(){$j(BS.Util.escapeId(a.copyButtonId())).prop("disabled",!this.value);});this.bindCtrlEnterHandler(this.submitCopy.bind(this));}});BS.CopyProjectForm=OO.extend(BS.AbstractCopyForm,{__baseId:"copyProject",fetchParamName:"projectId",_onFetchDialogComplete:function(){this.showCentered();$j(this.formElement().newParent).change(function(){$j("#copyButton").prop("disabled",!$j(this).val());}).trigger("change");this.formElement().newName.focus();this.bindCtrlEnterHandler(this.submitCopy.bind(this));},submitCopy:function(){var a=this;BS.AdminActions.createHiddenMappingIfNecessary(a.getContainer());BS.FormSaver.save(this,this.formElement().action,OO.extend(BS.ErrorsAwareListener,{onSaveProjectErrorError:function(b){alert(b.firstChild.nodeValue);},onMaxNumberOfBuildTypesReachedError:function(b){alert(b.firstChild.nodeValue);},onProjectNotFoundError:function(b){alert(b.firstChild.nodeValue);BS.XMLResponse.processRedirect(b.ownerDocument);},onEmptyProjectNameError:function(b){$("error_newProjectName").innerHTML=fixErrorMessage(b.firstChild.nodeValue);a.highlightErrorField(a.formElement().newName);},onInvalidProjectNameError:function(b){$("error_newProjectName").innerHTML=fixErrorMessage(b.firstChild.nodeValue);a.highlightErrorField(a.formElement().newName);},onInvalidProjectIdError:function(b){$("error_newProjectExternalId").innerHTML=fixErrorMessage(b.firstChild.nodeValue);a.highlightErrorField(a.formElement().newProjectExternalId);},onInvalidSubprojectIdError:function(b){$("error_newSubProjects").innerHTML=fixErrorMessage(b.firstChild.nodeValue);a.highlightErrorField($("copyMapping"));},onDuplicateProjectIdError:function(b){$("error_newProjectExternalId").innerHTML=fixErrorMessage(b.firstChild.nodeValue);a.highlightErrorField(a.formElement().newProjectExternalId);},onDuplicateSubprojectIdError:function(b){$("error_newSubProjects").innerHTML=fixErrorMessage(b.firstChild.nodeValue);a.highlightErrorField($("copyMapping"));},onInaccessibleTemplateError:function(b){$("error_newParent").innerHTML=fixErrorMessage(b.firstChild.nodeValue);a.highlightErrorField($("newParent"));},onCompleteSave:function(c,d,b){BS.ErrorsAwareListener.onCompleteSave(c,d,b);if(!b){BS.XMLResponse.processRedirect(d);}}}));return false;}});BS.CopyBuildTypeForm=OO.extend(BS.AbstractCopyForm,{__baseId:"copyBuildType",fetchParamName:"buildTypeId",inputId:"newBuildTypeName",submitCopy:function(){var a=this;BS.FormSaver.save(this,this.formElement().action,OO.extend(BS.ErrorsAwareListener,{onSaveProjectErrorError:function(b){alert(b.firstChild.nodeValue);},onMaxNumberOfBuildTypesReachedError:function(b){alert(b.firstChild.nodeValue);},onProjectNotFoundError:function(b){$("error_projectId").innerHTML=fixErrorMessage(b.firstChild.nodeValue);a.highlightErrorField(a.formElement().projectId);},onEmptyBuildTypeNameError:function(b){$("error_newName").innerHTML=fixErrorMessage(b.firstChild.nodeValue);a.highlightErrorField(a.formElement().newName);},onEmptyIdError:function(b){$("error_newBuildTypeExternalId").innerHTML=fixErrorMessage(b.firstChild.nodeValue);a.highlightErrorField(a.formElement().newBuildTypeExternalId);},onInvalidIdError:function(b){$("error_newBuildTypeExternalId").innerHTML=fixErrorMessage(b.firstChild.nodeValue);a.highlightErrorField(a.formElement().newBuildTypeExternalId);},onDuplicateIdError:function(b){$("error_newBuildTypeExternalId").innerHTML=fixErrorMessage(b.firstChild.nodeValue);a.highlightErrorField(a.formElement().newBuildTypeExternalId);},onBuildTypeNotFoundError:function(b){alert(b.firstChild.nodeValue);BS.XMLResponse.processRedirect(b.ownerDocument);},onCompleteSave:function(c,d,b){BS.ErrorsAwareListener.onCompleteSave(c,d,b);if(!b){BS.XMLResponse.processRedirect(d);}}}));return false;}});BS.CopyTemplateForm=OO.extend(BS.AbstractCopyForm,{__baseId:"copyTemplate",fetchParamName:"templateId",inputId:"newTemplateName",submitCopy:function(){var a=this;BS.FormSaver.save(this,this.formElement().action,OO.extend(BS.ErrorsAwareListener,{onSaveProjectErrorError:function(b){alert(b.firstChild.nodeValue);},onProjectNotFoundError:function(b){$("error_projectId").innerHTML=fixErrorMessage(b.firstChild.nodeValue);a.highlightErrorField(a.formElement().projectId);},onTemplateNotFoundError:function(b){alert(b.firstChild.nodeValue);},onInvalidNameError:function(b){$("error_newName").innerHTML=fixErrorMessage(b.firstChild.nodeValue);a.highlightErrorField(a.formElement().newName);},onEmptyIdError:function(b){this.onInvalidIdError(b);},onDuplicateIdError:function(b){this.onInvalidIdError(b);},onInvalidIdError:function(b){$("error_newTemplateExternalId").innerHTML=fixErrorMessage(b.firstChild.nodeValue);a.highlightErrorField(a.formElement().newTemplateExternalId);},onCompleteSave:function(c,d,b){BS.ErrorsAwareListener.onCompleteSave(c,d,b);if(!b){BS.XMLResponse.processRedirect(d);}}}));return false;}});BS.RegenerateForm=OO.extend(BS.AbstractCopyForm,{__baseId:"regenerate",fetchParamName:"projectId",_onFetchDialogComplete:function(){this.showCentered();if($("mapping")){$("mapping").focus();this.bindCtrlEnterHandler(this.submit.bind(this));}},submit:function(){var a=this;BS.AdminActions.createHiddenMappingIfNecessary(a.getContainer());BS.FormSaver.save(this,window["base_uri"]+"/admin/regenerate.html",OO.extend(BS.ErrorsAwareListener,{onMappingError:function(b){$("error_mapping").innerHTML=fixErrorMessage(b.firstChild.nodeValue);a.highlightErrorField($("mapping"));},onCompleteSave:function(c,d,b){BS.ErrorsAwareListener.onCompleteSave(c,d,b);if(!b){a.close();BS.XMLResponse.processRedirect(d);}}}));return false;}});
/*---
/js/bs/testConnection.js
---*/
BS.TestConnectionDialog=OO.extend(BS.AbstractModalDialog,{hideOnMouseClickOutside:true,getContainer:function(){return $("testConnectionDialog");},show:function(i,a,e){if(a.length>0){a=a+"\n";}var c=$("testConnectionDetails");var b=$("testConnectionStatus");var d=a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/\n/g,"<br>").replace(/ /g,"&nbsp;");var g=(d.length>0)?BS.Util.show(c):BS.Util.hide(c);var f=this;var h=ReactUI.getSandbox(c);return g.then(function(){return h.mutate(function(){if(i){b.innerHTML="Connection successful!";b.className="testConnectionSuccess";}else{b.innerHTML="Connection failed!";b.className="testConnectionFailed";}});}).then(function(){return f.showCentered();}).then(function(){return h.mutate(function(){c.style.height="";c.style.overflow="auto";c.innerHTML=d;});}).then(function(){return h.measure(function(){return c.getDimensions();});}).then(function(j){return h.mutate(function(){var k=j.height+20;if(k>350){c.style.height="300px";}else{c.style.height=k+"px";}f.recenterDialog();});});}});
/*---
/js/bs/moveBuildType.js
---*/
BS.MoveForm=OO.extend(BS.AbstractCopyMoveDialog,{_projects:[],_onFetchDialogComplete:function(a){$j("body").append(a.responseText);this.showCentered();$j(this.formElement().projectId).trigger("change").focus();this.bindCtrlEnterHandler(this.submitMove.bind(this));},_createMoveErrorsListener:function(){var a=this;return OO.extend(BS.ErrorsAwareListener,{onSaveProjectErrorError:function(b){alert(b.firstChild.nodeValue);},onProjectNotFoundError:function(b){$("error_"+a.formElement().id+"_projectId").innerHTML=b.firstChild.nodeValue;a.highlightErrorField(a.formElement().projectId);},onCannotMoveError:function(b){alert(b.firstChild.nodeValue);},onCompleteSave:function(c,d,b){BS.ErrorsAwareListener.onCompleteSave(c,d,b);if(!b){BS.XMLResponse.processRedirect(d);}}});},checkCanMove:function(b,a,d,c){BS.AdminActions.checkCanMove(b,a,function(l,f,m,k){if(l.length>0||f.length>0||k.length>0){var j='<div class="icon_before icon16 attentionComment">'+d+" cannot be moved. ";if(k.length>0){j+="Reasons:"+"<ul>";for(var e=0;e<k.length;e++){j+="<li>"+k[e].escapeHTML()+"</li>";}j+="</ul>";}if(l.length>0){j+="The following VCS roots won't be available in the selected project:"+"<ul>";for(e=0;e<l.length;e++){j+="<li>"+l[e]+"</li>";}j+="</ul>";}if(f.length>0){j+="The following templates won't be available in the selected project:"+"<ul>";for(e=0;e<f.length;e++){j+="<li>"+f[e].escapeHTML()+"</li>";}j+="</ul></div>";}c(j);}else{if(m.clashingCleanupDisableRules>0||m.clashingOverriddenRules>0){var g;if(d=="Project"){g='<div class="icon_before icon16 attentionComment">'+"After the move to the selected project effective cleanup rules of the moved project or some of its sub projects or build configurations will change. "+"Please review the cleanup rules for the "+d.toLowerCase()+" after the move. "+"</div>";c(g,true);}else{if(m.clashingCleanupDisableRules>0){var h=m.clashingCleanupDisableRules>1?"rules":"rule";g='<div class="icon_before icon16 attentionComment">'+"After the move to the selected project "+m.clashingCleanupDisableRules+" cleanup "+h+" will be automatically enabled to prevent clashes with rules from the new parent project. "+"Please review the cleanup rules for the "+d.toLowerCase()+" after the move. "+"</div>";c(g,true);}else{c(null);}}}else{c(null);}}});}});BS.MoveBuildTypeForm=OO.extend(BS.MoveForm,{__baseId:"moveBuildType",fetchParamName:"buildTypeId",submitMove:function(){BS.FormSaver.save(this,this.formElement().action,OO.extend(this._createMoveErrorsListener(),{onMaxNumberOfBuildTypesReachedError:function(a){alert(a.firstChild.nodeValue);},onBuildTypeNotFoundError:function(a){alert(a.firstChild.nodeValue);BS.reload(true);}}));return false;}});BS.MoveTemplateForm=OO.extend(BS.MoveForm,{__baseId:"moveTemplate",fetchParamName:"templateId",submitMove:function(){BS.FormSaver.save(this,this.formElement().action,OO.extend(this._createMoveErrorsListener(),{onTemplateNotFoundError:function(a){alert(a.firstChild.nodeValue);BS.reload(true);}}));return false;}});BS.MoveProjectForm=OO.extend(BS.MoveForm,{__baseId:"moveProject",fetchParamName:"projectId",submitMove:function(){BS.FormSaver.save(this,this.formElement().action,OO.extend(BS.ErrorsAwareListener,{onSaveProjectErrorError:function(a){alert(a.firstChild.nodeValue);},onProjectNotFoundError:function(a){alert(a.firstChild.nodeValue);BS.XMLResponse.processRedirect(a.ownerDocument);},onCompleteSave:function(b,c,a){BS.ErrorsAwareListener.onCompleteSave(b,c,a);if(!a){BS.XMLResponse.processRedirect(c);}}}));return false;}});BS.MoveVcsRootForm=OO.extend(BS.AbstractCopyMoveDialog,{__baseId:"moveVcsRoot",showDialog:function(a){this.formElement().vcsRootId.value=a;this.showCentered();this.formElement().moveToProjectId.onchange();this.formElement().moveToProjectId.focus();this.bindCtrlEnterHandler(this.submitMove.bind(this));return false;},submitMove:function(){BS.FormSaver.save(this,this.formElement().action,OO.extend(BS.ErrorsAwareListener,{onMoveFailedError:function(a){$j("#error_moveVcsRootForm").text(a.firstChild.nodeValue);},onRootNotFoundError:function(a){alert(a.firstChild.nodeValue);BS.XMLResponse.processRedirect(a.ownerDocument);},onSuccessfulSave:function(){BS.reload(true);}}));return false;}});
/*---
/js/bs/editBuildType.js
---*/
BS.SaveGeneralBuildTypeInfoListener=OO.extend(BS.SaveConfigurationListener,{_invalidBuildTypeNameError:function(a){if($("errorName")){$("errorName").innerHTML=fixErrorMessage(a.firstChild.nodeValue);this.getForm().highlightErrorField($("name"));}else{alert(a.firstChild.nodeValue);}},_invalidBuildTypeIdError:function(a){if($("errorExternalId")){$("errorExternalId").innerHTML=fixErrorMessage(a.firstChild.nodeValue);this.getForm().highlightErrorField($("externalId"));}else{alert(a.firstChild.nodeValue);}},onEmptyNameError:function(a){this._invalidBuildTypeNameError(a);},onInvalidNameError:function(a){this._invalidBuildTypeNameError(a);},onCannotRenameError:function(a){this._invalidBuildTypeNameError(a);},onEmptyIdError:function(a){this._invalidBuildTypeIdError(a);},onInvalidValueError:function(a){alert(a.firstChild.nodeValue);},onInvalidIdError:function(a){this._invalidBuildTypeIdError(a);},onDuplicateIdError:function(a){this._invalidBuildTypeIdError(a);},onInvalidBuildNumberFormatError:function(a){if($("errorBuildNumberFormat")){$("errorBuildNumberFormat").innerHTML=fixErrorMessage(a.firstChild.nodeValue);this.getForm().highlightErrorField($("buildNumberFormat"));}else{alert(a.firstChild.nodeValue);}},onInvalidBuildCounterError:function(a){if($("errorBuildCounter")){$("errorBuildCounter").innerHTML=fixErrorMessage(a.firstChild.nodeValue);this.getForm().highlightErrorField($("buildCounter"));}else{alert(a.firstChild.nodeValue);}},onInvalidTimeoutValueError:function(a){if($("errorExecutionTimeout")){$("errorExecutionTimeout").innerHTML=fixErrorMessage(a.firstChild.nodeValue);this.getForm().highlightErrorField($("executionTimeout"));}else{alert(a.firstChild.nodeValue);}},onInvalidMaxBuildsValueError:function(a){if($("errorMaxBuilds")){$("errorMaxBuilds").innerHTML=fixErrorMessage(a.firstChild.nodeValue);this.getForm().highlightErrorField($("maxBuilds"));}else{alert(a.firstChild.nodeValue);}},invalidBranchFilter:function(a){if($("errorBranchFilter")){$("errorBranchFilter").innerHTML=fixErrorMessage(a.firstChild.nodeValue);}else{alert(a.firstChild.nodeValue);}},onError:function(a,b){alert(b);}});BS.BaseEditBuildTypeForm=OO.extend(BS.AbstractWebForm,{enable:function(){var a=function(b){return !b._inherited;};BS.AbstractWebForm.enable.call(this,a);},showItemDslWithValues:function(b,a,d,f,c,e){$j("#showDSL").val("item");$j("#showDSLVersion").val(b);$j("#showDSLPortable").val(a?"true":"false");return this._showItemDsl(true,f,c,e);},_showItemDsl:function(a,e,b,d){var c=this;this.removeUpdateStateHandlers();this.clearErrors();BS.PasswordFormSaver.save(this,this.formElement().action,OO.extend(BS.ErrorsAwareListener,{onFailedTestConnectionError:function(f){var g="";if(f.firstChild){g=f.firstChild.nodeValue;}ReactUI.closeEditDsl(e,b,d);},onCompleteSave:function(h,i,g){var f=BS.XMLResponse.processErrors(i,{},c.propertiesErrorsHandler);if(!f){ReactUI.storeHtml("dslFragment",new XMLSerializer().serializeToString(i));BS.EditDsl.showEditDslPanel(b,d);}else{ReactUI.closeEditDsl(e,b,d);}BS.ErrorsAwareListener.onCompleteSave(h,i,false);h.enable();BS.MultilineProperties.updateVisible();},onUnexpectedError:function(g,h,f){ReactUI.storeHtml("dslFragment",new XMLSerializer().serializeToString(h));BS.EditDsl.showEditDslPanel(b,d);BS.ErrorsAwareListener.onCompleteSave(g,h,false);g.enable();BS.MultilineProperties.updateVisible();}}));return false;}});BS.EditBuildTypeForm=OO.extend(BS.BaseEditBuildTypeForm,{formElement:function(){return $("editBuildTypeForm");},setupEventHandlers:function(){var a=this;this.setUpdateStateHandlers({updateState:function(){a.saveInSession();},saveState:function(){a.submitBuildType();}});},saveInSession:function(){$("submitBuildType").value="storeInSession";BS.PasswordFormSaver.save(this,this.formElement().action,BS.StoreInSessionListener);},submitBuildType:function(){var a=this;$("submitBuildType").value="store";BS.PasswordFormSaver.save(this,this.formElement().action,OO.extend(BS.SaveGeneralBuildTypeInfoListener,{getForm:function(){return a;},onCompleteSave:function(f,h,e){BS.SaveGeneralBuildTypeInfoListener.onCompleteSave(f,h,e);if(!e){var b=$j("#externalId"),c=b.attr("originalId"),d=b.val();if(d!=c){var g=window.location.href;window.location.href=g.replace("id=buildType:"+c,"id=buildType:"+d).replace("id=template:"+c,"id=template:"+d);}else{BS.reload(true);}}}}),false);return false;}});BS.EditVcsRootsForm=OO.extend(BS.BaseEditBuildTypeForm,{formElement:function(){return $("editVcsSettingsForm");},detachVcsRoot:function(a){if(confirm("Are you sure you want to detach this VCS root?")){BS.ajaxRequest(this.formElement().action,{parameters:"detachVcsRoot="+a,onComplete:function(){BS.EditVcsRootsForm.update();}});}},setupEventHandlers:function(){var a=this;this.setUpdateStateHandlers({updateState:function(){a.saveInSession();},saveState:function(){a.applyVcsSettings();}});},saveInSession:function(){$("submitBuildType").value="storeInSession";BS.FormSaver.save(this,this.formElement().action,BS.StoreInSessionListener);},applyVcsSettings:function(){$("submitBuildType").value="store";$("doApplyVcsSettings").value="true";BS.Util.show("applyVcsSettingsProgress");BS.FormSaver.save(this,this.formElement().action,OO.extend(BS.SaveGeneralBuildTypeInfoListener,{onCompleteSave:function(b,c,a){$("doApplyVcsSettings").value="false";BS.Util.hide("applyVcsSettingsProgress");BS.SaveGeneralBuildTypeInfoListener.onCompleteSave(b,c,a);if(!a){BS.EditVcsRootsForm.update();}}}));return false;},updateCheckoutDirectoryWarning:function(){var a=$("cleanBuild").checked;if(a){$("deletionWarning").innerHTML=$("deletionWarning").innerHTML.gsub("might be","will be");}else{a=$("checkoutType").selectedIndex<2;$("deletionWarning").innerHTML=$("deletionWarning").innerHTML.gsub("will be","might be");}if(BS.Util.trimSpaces($("checkoutDir").value)==""){a=false;}$("deletionWarning").style.display=a?"block":"none";BS.VisibilityHandlers.updateVisibility("mainContent");},update:function(){this.enable();this.removeUpdateStateHandlers();BS.reload(true);},updateCheckoutSharing:function(){var b=$j("#customCheckout"),a=$j("#checkoutDir"),c=$j("#autoCheckout");if(b.is(":visible")){this._checkoutDir=a.val();a.val("");}else{a.val(this._checkoutDir||"");}b.toggle();c.toggle();BS.VisibilityHandlers.updateVisibility(a[0]);}});BS.EditBuildRunnerForm=OO.extend(BS.BaseEditBuildTypeForm,OO.extend(BS.PluginPropertiesForm,{Controls:null,formElement:function(){return $("editBuildTypeForm");},setupCtrlEnterForTextareas:function(b){var a=this;$j("#editBuildTypeForm textarea").each(function(){var c=false;$j(this).keydown(function(d){if(d.keyCode===$j.ui.keyCode.CONTROL){c=true;}else{if(c&&d.keyCode===$j.ui.keyCode.ENTER){a.submitBuildRunner(b);}}}).keyup(function(d){if(d.keyCode===$j.ui.keyCode.CONTROL){c=false;}});});},setupEventHandlers:function(b){var a=this;this.setUpdateStateHandlers({updateState:function(){a.saveInSession();},saveState:function(){a.submitBuildRunner(b);}});},saver:function(a){return this.Controls.createFormSaver(null,a);},saveInSession:function(){this.saver(false).save(this,this.formElement().action+"&submitBuildType=storeInSession",BS.StoreInSessionListener);},submitBuildRunner:function(b){var a=this;this.saver(true).save(this,this.formElement().action+"&submitBuildType=store",OO.extend(BS.SaveGeneralBuildTypeInfoListener,{onCompleteSave:function(e,f,d){a.setSaving(false);var c=BS.XMLResponse.processErrors(f,{},a.propertiesErrorsHandler)||d;if(c){a.enable();a.focusFirstErrorField();}else{setTimeout(function(){document.location.href="editBuildRunners.html?init=1&id="+b;},100);}}}));return false;}}));BS.GeneralRequirementsForm=OO.extend(BS.BaseEditBuildTypeForm,{formElement:function(){return $("editGeneralRequirementsForm");},updateGeneralRequirements:function(){$("updateGeneralRequirements").value="updateGeneralRequirements";var a=this;BS.PasswordFormSaver.save(this,this.formElement().action,OO.extend(BS.SaveConfigurationListener,{getForm:function(){return a;},_baseErrorHandle:function(c,b){if($(b)){$(b).innerHTML=fixErrorMessage(c.firstChild.nodeValue);
}else{alert(c.firstChild.nodeValue);}},onInvalidCpuCountBoundsError:function(b){this._baseErrorHandle(b,"errorCpuCounts");},onInvalidMemorySizeBoundsError:function(b){this._baseErrorHandle(b,"memorySizeError");},onCompleteSave:function(c,d,b){BS.SaveConfigurationListener.onCompleteSave(c,d,b);if(!b){BS.reload(true);}}}),false);return false;},showHideOsSpecification:function(){var a=$("operatingSystemsOptions");if($("osSpecification").value=="specified"){a.show();}else{a.hide();}},createAutocompletionSource:function(d,b,a){var c=this;return function(h,e){var g=h.term;var i=d.indexOf("?")>0?"&":"?";var f=d+i+"what=value&term="+encodeURIComponent(g)+"&name="+encodeURIComponent(b);$j.getJSON(f,function(j){BS.Util.fadeOutAndDelete(BS.Util.escapeId(c.getLoadingImageId(a)));e(j);});};},getLoadingImageId:function(a){return $j(BS.Util.escapeId(a)).attr("id")+"_compl_loading_img";}});BS.RequirementsForm=OO.extend(BS.BaseEditBuildTypeForm,{formElement:function(){return $("editRequirement");},saveRequirement:function(){this.clearErrors();$("submitAction").value="updateRequirement";var a=this;BS.FormSaver.save(this,this.formElement().action,OO.extend(BS.BaseSaveParameterListener,{onEmptyParameterNameError:function(b){$("error_parameterName").innerHTML=b.firstChild.nodeValue;a.highlightErrorField($("parameterName"));},onEmptyParameterValueError:function(b){$("error_parameterValue").innerHTML=b.firstChild.nodeValue;a.highlightErrorField($("parameterValue"));},onInvalidParameterValueError:function(b){$("error_parameterValue").innerHTML=b.firstChild.nodeValue.replace(/(\n\n)+/g,"<br/>").replace(/ /g,"&nbsp;");a.highlightErrorField($("parameterValue"));},onSimilarRequirementExistsError:function(b){$("errorSimilarRequirementExists").innerHTML=b.firstChild.nodeValue;},onCompleteSave:function(c,d,b){BS.SaveConfigurationListener.onCompleteSave(c,d,b);if(!b){BS.EditRequirementDialog.close();BS.reload(true);}}}));return false;},doRemoveRequirement:function(b){var a=this.formElement().action+"&submitBuildType=1&submitAction=removeRequirement&removedReqParameterId="+b;BS.ajaxRequest(a,{onComplete:function(){BS.reload(true);}});},removeRequirement:function(a){if(!confirm("Are you sure you want to delete this requirement?")){return;}this.doRemoveRequirement(a);},resetRequirement:function(a){if(!confirm("Are you sure you want to reset the requirement to its template definition?")){return;}this.doRemoveRequirement(a);}});BS.EditRequirementDialog=OO.extend(BS.AbstractModalDialog,{parameterValueRequired:{},myHiddenOption:null,setParameterValueRequired:function(a){this.parameterValueRequired=a;},createFindNameFunction:function(b){var a=this;return function(f,c){var e=f.term;var g=b.indexOf("?")>0?"&":"?";var d=b+g+"what=name&term="+encodeURIComponent(e);$j.getJSON(d,function(h){BS.Util.fadeOutAndDelete(BS.Util.escapeId(a.getLoadingImageId("parameterName")));c(h);});};},createFindValueFunction:function(b){var a=this;return function(g,d){var f=g.term;var c=$j("#parameterName").val();var h=b.indexOf("?")>0?"&":"?";var e=b+h+"what=value&term="+encodeURIComponent(f)+"&name="+encodeURIComponent(c);$j.getJSON(e,function(i){BS.Util.fadeOutAndDelete(BS.Util.escapeId(a.getLoadingImageId("parameterValue")));d(i);});};},getLoadingImageId:function(a){return $j(BS.Util.escapeId(a)).attr("id")+"_compl_loading_img";},showLoadingImage:function(b){var a=this;return function(){var c=$j(b).position();var d=a.getLoadingImageId(b);return $j("<i>").attr("id",d).attr("className","icon-refresh icon-spin ring-loader-inline").css({width:16,height:16,position:"absolute",left:c.left+$j(b).outerWidth(true)+2,top:c.top+2}).insertAfter(b);};},showSlowly:function(a){return function(b,c){$j(a).fadeIn("slow",function(){});};},getContainer:function(){return $("editRequirementDialog");},showDialog:function(h,e,g,c,b,d){BS.RequirementsForm.enable();BS.RequirementsForm.clearErrors();$("currentName").value=e;$("parameterName").value=e;$("parameterValue").value=g;$("requirementId").value=h;if(c!="any"){var a=$j("#requirementType option[value='any']")[0];if(a){var f=a.index;this.myHiddenOption=a;$("requirementType").remove(f);}}else{if(this.myHiddenOption){$("requirementType").add(this.myHiddenOption);this.myHiddenOption=null;}}this.selectRequirement($("requirementType"),c);if(d){$("editRequirementTitle").innerHTML="View ";}else{$("editRequirementTitle").innerHTML=e.length==0?"Add ":"Edit ";}$("editRequirementTitle").innerHTML+=this.titleName();this.showCentered();this.installNameCompleter();this.installValueCompleter();if(b||d){if(d){Form.Element.disable($("requirementType"));Form.Element.disable($("parameterValue"));}Form.Element.disable($("parameterName"));$("inheritedParamName").show();}else{Form.Element.enable($("parameterName"));Form.Element.enable($("requirementType"));Form.Element.enable($("parameterValue"));$("inheritedParamName").hide();$("parameterName").focus();}},installNameCompleter:function(){$j("#parameterName").autocomplete("readTerm");$j("#parameterName").placeholder("refresh");},installValueCompleter:function(){$j("#parameterValue").autocomplete("readTerm");$j("#parameterValue").autocomplete({close:function(a,b){$j("#parameterValue").placeholder("refresh");}});$j("#parameterValue").placeholder("refresh");},titleName:function(){return"Requirement";},selectRequirement:function(a,c){var b;for(b=0;b<a.options.length;b++){if(a.options[b].value===c){a.selectedIndex=b;BS.jQueryDropdown(a).ufd("changeOptions");this.requirementChanged(a);return;}}BS.jQueryDropdown(a).ufd("changeOptions");a.selectedIndex=0;a.value=a.options[0].value;this.requirementChanged(a);},requirementChanged:function(a){if(this.parameterValueRequired[a.value]){BS.Util.show("editParameterValue");}else{BS.Util.hide("editParameterValue");}$j("#parameterValue").placeholder("refresh");},cancelDialog:function(){this.close();BS.Util.hide("parameterNameAutocompleteLoading");BS.Util.hide("parameterValueAutocompleteLoading");},afterClose:function(){$j("#parameterName").autocomplete("close");$j("#parameterValue").autocomplete("close");}});BS.EditBuildStepConditionDialog=OO.extend(BS.EditRequirementDialog,{titleName:function(){return"Parameter-based Execution Condition";},installValueCompleter:function(){$j("#parameterValue").attr("placeholder","");var b=new URLSearchParams(location.search);var a="settingsId="+b.get("id");BS.AvailableParams.attachPopupsTo(a,"#parameterValue");},createFindValueFunction:function(a){return function(c,b){BS.Log.debug("No value completion has been implemented yet");b([]);};},validate:function(a){var b=true;if(!a.parameterName.value.trim()){$("error_parameterName").innerHTML="parameter name is required";b=false;}else{$("error_parameterName").innerHTML="";}if(this.parameterValueRequired[a.requirementType.value]){if(!a.parameterValue.value.trim()){$("error_parameterValue").innerHTML="value is required";b=false;}else{$("error_parameterValue").innerHTML="";}}else{$("error_parameterValue").innerHTML="";a.parameterValue.value="";}return b;},saveCondition:function(a){if(!this.validate(a)){return false;}if(this._targetRow){BS.BuildStepConditionsList.updateRowParams(this._targetRow,a.parameterName.value.trim(),a.requirementType.value,a.parameterValue.value);this._targetRow=null;}else{BS.BuildStepConditionsList.addConditionRow(a.parameterName.value.trim(),a.requirementType.value,a.parameterValue.value);}BS.EditBuildRunnerForm.saveInSession();this.close();return false;},editConditionRow:function(b){var c=$j(b).closest(".buildStepCondition")[0];var a=c.querySelector(".buildStepCondition__input");if(!a){return;}this._targetRow=c;this.showDialog("",a.getAttribute("data-pname"),a.getAttribute("data-pvalue"),a.getAttribute("data-rtype"));}});BS.BuildStepConditionsList={addConditionRow:function(c,b,e,a){var f=$("buildStepConditionRowTemplate").innerHTML;var d=document.createElement("div");d.innerHTML=f;this.updateRowParams(d.firstElementChild,c,b,e,a);$j(".buildStepConditionsList").append(d.firstElementChild);document.querySelector(".buildStepConditions").style.display="";
},updateRowParams:function(f,d,c,e,b){var a=f.querySelector(".buildStepCondition__input");a.value=d+"|"+c+"|"+e;a.setAttribute("data-pname",d);a.setAttribute("data-rtype",c);a.setAttribute("data-pvalue",e);if(!b){b=d+" "+c+" "+e;}f.querySelector(".buildStepCondition__description").innerText=b;},editConditionRow:function(a){BS.EditBuildStepConditionDialog.editConditionRow(a);},addOnlyDefaultBranch:function(){this.addConditionRow("teamcity.build.branch.is_default","equals","true");BS.EditBuildRunnerForm.saveInSession();},addSkipIfPersonal:function(){this.addConditionRow("env.BUILD_IS_PERSONAL","does-not-equal","true","env.BUILD_IS_PERSONAL does not equal true");BS.EditBuildRunnerForm.saveInSession();},addSpecificBranch:function(){this.addConditionRow("teamcity.build.branch","equals","release");BS.EditBuildRunnerForm.saveInSession();},deleteConditionRow:function(a){BS.confirmDialog.show({title:"Delete condition",text:"Are you sure you want to delete this condition?",actionButtonText:"Yes",action:function(){$(a).up(".buildStepCondition").remove();if(!document.querySelector(".buildStepConditionsList").childNodes.length){$j(".buildStepConditions").hide();}BS.EditBuildRunnerForm.saveInSession();}});}};BS.VcsRootsUtil={attachVcsRoot:function(b,a){BS.ajaxRequest(window["base_uri"]+"/admin/editBuildTypeVcsRoots.html",{parameters:"id="+b+"&vcsRootId="+a+"&submitBuildType=store&doAttach=true",onComplete:function(c){BS.XMLResponse.processRedirect(c.responseXML);}});return false;}};BS.ArtifactDependencyForm=OO.extend(BS.DialogWithProgress,OO.extend(BS.BaseEditBuildTypeForm,{controlId:"adDsl",getContainer:function(){return $("artifactDependencyFormDialog");},showArtifactDepDSLWithValues:function(b,a,f,e,d){var c=$j("input[name='saveArtifactDependency']").val();$j("input[name='saveArtifactDependency']").val("");$j("#showArtifactDSL").val("item");$j("#showArtifactDSLVersion").val(b);$j("#showArtifactDSLPortable").val(a?"true":"false");this._showItemDsl(true,f,e,d);$j("input[name='saveArtifactDependency']").val(c);},formElement:function(){return $("artifactDependencyForm");},resetDependency:function(a){if(!confirm("Are you sure you want to reset the artifact dependency to its template definition?")){return;}this.hideSuccessMessages();this.setSaving(true);BS.ajaxRequest(this.formElement().action,{parameters:"artDepDelete="+a,onSuccess:function(){BS.reload(true);}});},removeDependencies:function(b){if(!BS.EditDepsUtil.confirmDepsRemove(b.length,"remove")){return;}this.hideSuccessMessages();this.setSaving(true);var a=this.formElement().action;BS.ajaxRequest(a,{parameters:"artDepDelete="+b.join("&artDepDelete=")+"&checkDepParams=true",onSuccess:function(c){BS.XMLResponse.processErrors(c.responseXML,{onHaveDepParamsError:function(d){if(confirm("The following parameters will be unavailable after dependenc"+(b.length==1?"y":"ies")+" remove:"+"\n"+d.firstChild.nodeValue+"\n\nDo you want to continue?")){BS.ajaxRequest(a,{parameters:"artDepDelete="+b.join("&artDepDelete="),onSuccess:function(){BS.reload(true);}});}}});BS.reload(true);}});},refreshDialog:function(){$("artifactDependencyDialog").refresh(null,"noCacheRnd="+Math.random(),function(){BS.ArtifactDependencyForm.showCentered();});},dependenciesSelected:function(){return BS.EditDepsUtil.itemsSelected($("artifactDeps"),"depId");},getSelectedDeps:function(){return BS.EditDepsUtil.getSelectedItems($("artifactDeps"),"depId");},editDependency:function(a,b){if(BS.EditDepsUtil.eventTargetIsLink(a)){return true;}this.hideSuccessMessages();this.showProgress("Loading...");BS.ajaxRequest(this.formElement().action,{parameters:"artDepEdit="+b,onSuccess:function(){BS.ArtifactDependencyForm.refreshDialog();}});},addDependency:function(a){this.hideSuccessMessages();this.showProgress("Loading...");BS.ajaxRequest(this.formElement().action,{parameters:"artDepAdd=1",onSuccess:function(){BS.ArtifactDependencyForm.refreshDialog();}});},updateTargetDirectoryWarning:function(){if($("cleanDestination")){var a=$("cleanDestination").checked;$("deletionWarning").style.display=a?"block":"none";}},_counter:0,addArtifactPath:function(){var b=document.createElement("li");b.innerHTML=$("artifactPathTemplate").innerHTML;var a=b.getElementsByTagName("input")[0];a.name="artifactPath";b.style.display="block";a.className+=" buildTypeParams";a.id="artifactPath_new_"+(this._counter++);$("artifactsPaths").insertBefore(b,$("artifactsPaths_lastItem"));BS.VisibilityHandlers.updateVisibility(this.getContainer());},savingIndicator:function(){return $("saveArtifactDependencyProgress");},switchToUI:function(){BS.EditDsl.hideEditDslPanel("#adUiContainer",".adDslContainer.fragmentEditDsl");if(window.ReactUI&&ReactUI.closeEditDsl){ReactUI.closeEditDsl(this.controlId);}},saveDependency:function(){this.formElement().revisionRuleName.value=$("revisionRules").options[$("revisionRules").selectedIndex].value;this.formElement().revisionRuleValue.value="";if(!$("buildNumberPattern").disabled){this.formElement().revisionRuleValue.value=$("buildNumberPattern").value;}else{if(!$("buildTag").disabled){this.formElement().revisionRuleValue.value=$("buildTag").value;}}var a=this;BS.FormSaver.save(this,this.formElement().action,OO.extend(BS.ErrorsAwareListener,{onEmptyBuildNumberPatternError:function(b){$("errorBuildNumberPattern").innerHTML=b.firstChild.nodeValue;a.highlightErrorField($("buildNumberPattern"));a.switchToUI();},onEmptyBuildTagError:function(b){$("errorBuildTag").innerHTML=b.firstChild.nodeValue;a.highlightErrorField($("buildTag"));a.switchToUI();},onNoArtifactsPathsError:function(b){$("errorArtifactsPaths").innerHTML=b.firstChild.nodeValue;a.highlightErrorField($("artifactsPaths").getElementsByTagName("textarea")[0]);a.switchToUI();},onDuplicateArtifactsPathsError:function(b){$("errorArtifactsPaths").innerHTML=b.firstChild.nodeValue;a.switchToUI();},onBadDestinationPathError:function(b){$("errorArtifactsPaths").innerHTML=b.firstChild.nodeValue;a.highlightErrorField($("artifactsPaths").getElementsByTagName("textarea")[0]);a.switchToUI();},onSimilarDependencyExistsError:function(b){$("errorSimilarDependencyExists").innerHTML=b.firstChild.nodeValue;a.switchToUI();},onBuildTypeNotExistsError:function(b){$("errorSourceBuildTypeNotExists").innerHTML=b.firstChild.nodeValue;a.highlightErrorField($("sourceBuildTypeId"));a.switchToUI();},onBuildBranchError:function(b){$("errorBuildBranch").innerHTML=b.firstChild.nodeValue;a.highlightErrorField($("buildBranch"));a.switchToUI();},onHaveDepParamsError:function(b){if(confirm("The following parameters will be unavailable after dependency change:"+"\n"+b.firstChild.nodeValue+"\n\nDo you want to continue?")){$j("#checkArtifactDepParams").val("false");BS.ArtifactDependencyForm.saveDependency("false");}},onCompleteSave:function(c,d,b){BS.ErrorsAwareListener.onCompleteSave(c,d,b);if(!b){BS.ArtifactDependencyForm.close();c.enable();BS.reload(true);}}}));return false;},showOrHideActionsOnSelect:function(){BS.AdminActions.showOrHideActions("#artifactDeps input","#artifact-actions-docked");},close:function(){$j(this.getContainer()).find("select").ufd("destroy");this.doClose();}}));BS.ArtifactDependencyVerificationForm=OO.extend(BS.BaseEditBuildTypeForm,{_password:null,formElement:function(){return $("enterCredentialsForm");},verifyDependencies:function(a){var b=this;BS.EnterCredentialsDialog.showDialog(function(c){var e=c.username1.value;var d=c.password1.getEncryptedPassword();BS.EnterCredentialsDialog.disable();BS.EnterCredentialsDialog.setSaving(true);BS.ajaxRequest(a,{parameters:"artDepVerifyDependencies=1&encryptedPassword="+d+"&username="+e,onSuccess:function(g){BS.EnterCredentialsDialog.enable();BS.EnterCredentialsDialog.setSaving(false);var f=BS.XMLResponse.processErrors(g.responseXML,{onInvalidCredentialsError:function(h){$("invalidCredentials").innerHTML=h.firstChild.nodeValue;}});if(!f){BS.EnterCredentialsDialog.close();BS.EnterCredentialsDialog.formElement().password1.maskPassword();b.setSaving(true);$("dependencyResolverMessages").refresh();
}}});});return false;},verificationFinished:function(){this.enable();this.setSaving(false);}});BS.EnterCredentialsDialog=OO.extend(BS.AbstractWebForm,OO.extend(BS.AbstractModalDialog,{formElement:function(){return $("enterCredentials");},getContainer:function(){return $("enterCredentialsDialog");},showDialog:function(a){this.showCentered();this.clearErrors();this._onSubmit=a;this.bindCtrlEnterHandler(this.submit.bind(this));},submit:function(){this._onSubmit(this.formElement());return false;},clearErrors:function(){$("invalidCredentials").innerHTML="";},savingIndicator:function(){return $("submitCredentials");}}));BS.EditDepsUtil={eventTargetIsLink:function(a){var b=Event.element(a||window.event);return b.tagName=="A"&&b.innerHTML!="edit"&&b.innerHTML!="Edit"&&b.innerHTML!="Override";},itemsSelected:function(a,b){if(BS.EditDepsUtil.getSelectedItems(a,b).length==0){alert("Please select at least one dependency.");return false;}return true;},getSelectedItems:function(a,e){var b=[];var d=Form.getInputs(a,"checkbox",e);for(var c=0;c<d.length;c++){if(d[c].checked){b.push(d[c].value);}}return b;},confirmDepsRemove:function(b,a){return confirm("Are you sure you want to "+a+" "+b+" dependenc"+(b==1?"y":"ies")+"?");}};BS.SourceDependencyForm=OO.extend(BS.DialogWithProgress,OO.extend(BS.BaseEditBuildTypeForm,{getContainer:function(){return $("sourceDependenciesDialog");},showSourceDepDSLWithValues:function(b,a,f,e,d){var c=$j("input[name='saveSourceDependency']").val();$j("input[name='saveSourceDependency']").val("");$j("#showSourceDSL").val("item");$j("#showSourceDSLVersion").val(b);$j("#showSourceDSLPortable").val(a?"true":"false");this._showItemDsl(true,f,e,d);$j("input[name='saveSourceDependency']").val(c);},showDialog:function(){this.showCentered();this.bindCtrlEnterHandler(this.saveDependency.bind(this));},formElement:function(){return $("sourceDependencies");},savingIndicator:function(){return $("addSourceDependencyProgress");},dependenciesSelected:function(){return BS.EditDepsUtil.itemsSelected($("snapshotDeps"),"snDepChkbox");},getSelectedDeps:function(){return BS.EditDepsUtil.getSelectedItems($("snapshotDeps"),"snDepChkbox");},removeDependencies:function(b,c){if(!BS.EditDepsUtil.confirmDepsRemove(b.length,c)){return;}this.hideSuccessMessages();this.setSaving(true);var a=this.formElement().action;BS.ajaxRequest(a,{parameters:"srcDepDelete="+b.join("&srcDepDelete=")+"&checkDepParams=true",onSuccess:function(d){BS.XMLResponse.processErrors(d.responseXML,{onHaveDepParamsError:function(e){if(confirm("The following parameters will be unavailable after dependenc"+(b.length==1?"y":"ies")+" remove:"+"\n"+e.firstChild.nodeValue+"\n\nDo you want to continue?")){BS.ajaxRequest(a,{parameters:"srcDepDelete="+b.join("&srcDepDelete="),onSuccess:function(){BS.reload(true);}});}}});BS.reload(true);}});},editDependency:function(b,a){if(BS.EditDepsUtil.eventTargetIsLink(b)){return true;}this.hideSuccessMessages();this.showProgress("Loading...");BS.ajaxRequest(this.formElement().action,{parameters:"srcDepEdit="+a,onSuccess:function(){BS.SourceDependencyForm.refreshDialog();}});},addDependency:function(b,a){this.hideSuccessMessages();this.showProgress("Loading...");BS.ajaxRequest(this.formElement().action,{parameters:"srcDepAdd=1"+(a?"&selectedBuildTypes="+a.join("&selectedBuildTypes="):""),onSuccess:function(){BS.SourceDependencyForm.refreshDialog();}});},refreshDialog:function(){$("sourceEditingDependencyDialog").refresh(null,"noCacheRnd="+Math.random(),function(){BS.SourceDependencyForm.showCentered();});},configurationIsChosen:function(){var a=document.querySelectorAll("#buildTypeSelectorResult input[type='checkbox']");var c=$j("#srcDependOn");var b=$j('input[name="srcDependOn"]');if(a.length==0&&c.val()==undefined&&b.length==0){alert("Please choose at least one build configuration.");return false;}return true;},saveDependency:function(){if(!this.configurationIsChosen()){return false;}var a=this;BS.FormSaver.save(this,this.formElement().action,OO.extend(BS.SaveConfigurationListener,{onNoBuildTypesFoundError:function(b){alert(b.firstChild.nodeValue);},onCyclicDependencyFoundError:function(b){alert(b.firstChild.nodeValue);},onHaveDepParamsError:function(b){if(confirm("The following parameters will be unavailable after dependency change:"+"\n"+b.firstChild.nodeValue+"\n\nDo you want to continue?")){$j("#checkSnapshotDepParams").val("false");BS.SourceDependencyForm.saveDependency("false");}},onCompleteSave:function(c,d,b){BS.SaveGeneralBuildTypeInfoListener.onCompleteSave(c,d,b);if(!b){a.close();BS.reload(true);}}}));return false;},showOrHideActionsOnSelect:function(){BS.AdminActions.showOrHideActions("#snapshotDeps input","#snapshot-actions-docked");}}));BS.AttachDetachTemplateAction=OO.extend(BS.AbstractWebForm,OO.extend(BS.AbstractModalDialog,{getContainer:function(){return $("useTemplateFormDialog");},formElement:function(){return $("useTemplateForm");},showDialog:function(a){this.clearErrors();$("useTemplateForm").buildTypeId.value=a;$("templateId").selectedIndex=0;this.templateChanged(null,null,null);this.showCentered();this.bindCtrlEnterHandler(this.submit.bind(this));return false;},savingIndicator:function(){return $("associateWithTemplateProgress");},submit:function(){BS.FormSaver.save(this,this.formElement().action,OO.extend(BS.ErrorsAwareListener,{attachFailed:function(a){$("error_attachFailed").innerHTML=a.firstChild.nodeValue;},onCompleteSave:function(b,c,a){BS.ErrorsAwareListener.onCompleteSave(b,c,a);if(!a){BS.reload(true);}}}));return false;},cancelDialog:function(){this.close();},markTemplateAsDetached:function(a){$("tpl_"+a).hide();$("detach_tpl_"+a).value=a;return false;},detachFromTemplate:function(a){if(!confirm("Are you sure you want to detach this build configuration from the template?\n"+"Upon detach template settings will be copied to the build configuration.")){return false;}BS.ajaxRequest(this.formElement().action,{parameters:"buildTypeId="+a+"&detachFromTemplate=1",onSuccess:function(c){var b=BS.XMLResponse.processErrors(c.responseXML,{detachFailed:function(d){alert(d.firstChild.nodeValue);}});if(!b){BS.reload(true);}}});return false;},templateChanged:function(a,b){$("templateParameters").innerHTML="";this.submitEnabled(false);if(b){this.loadTemplateData(a,b);}else{BS.jQueryDropdown("#templateId").ufd("changeOptions");}},loadTemplateData:function(a,b){BS.TemplateParametersLoader.loadParameters("templateId="+b+"&buildTypeId="+a,"templateParameters","templateParamsUpdateProgress",function(){BS.AttachDetachTemplateAction.submitEnabled(true);BS.AttachDetachTemplateAction.recenterDialog();BS.VisibilityHandlers.updateVisibility($j(".templateParametersTable")[0]);});},submitEnabled:function(a){if(a){Form.Element.enable(this.formElement().associateWithTemplate);}else{Form.Element.disable(this.formElement().associateWithTemplate);}}}));BS.ExtractTemplateAction=OO.extend(BS.AbstractWebForm,OO.extend(BS.AbstractModalDialog,{getContainer:function(){return $("extractTemplateFormDialog");},formElement:function(){return $("extractTemplateForm");},showDialog:function(a){this.clearErrors();this.formElement().buildTypeId.value=a;this.showCentered();$("templateName").focus();this.bindCtrlEnterHandler(this.submit.bind(this));return false;},savingIndicator:function(){return $("extractTemplateProgress");},submit:function(){var a=this;BS.FormSaver.save(this,this.formElement().action,OO.extend(BS.ErrorsAwareListener,{extractFailed:function(b){$("error_extractFailed").innerHTML=fixErrorMessage(b.firstChild.nodeValue);},invalidName:function(b){$("error_templateName").innerHTML=fixErrorMessage(b.firstChild.nodeValue);a.highlightErrorField($("templateName"));},onEmptyIdError:function(b){$("error_templateExternalId").innerHTML=fixErrorMessage(b.firstChild.nodeValue);a.highlightErrorField($("templateExternalId"));},onInvalidIdError:function(b){$("error_templateExternalId").innerHTML=fixErrorMessage(b.firstChild.nodeValue);a.highlightErrorField($("templateExternalId"));},onDuplicateIdError:function(b){$("error_templateExternalId").innerHTML=fixErrorMessage(b.firstChild.nodeValue);
a.highlightErrorField($("templateExternalId"));},onCompleteSave:function(c,d,b){BS.ErrorsAwareListener.onCompleteSave(c,d,b);if(!b){BS.reload(true);}}}));return false;},cancelDialog:function(){this.close();}}));BS.TemplateParametersLoader={loadParameters:function(c,b,d,a){d=$(d);d.show();BS.ajaxUpdater($(b),window["base_uri"]+"/admin/showTemplateParams.html",{parameters:c,evalScripts:true,onComplete:function(){d.hide();if(a){a();}}});}};BS.EditArtifactDependencies={currentTextField:null,expandNestedArchives:false,attachPopups:function(k,a,e,i){var l=$(e);var c=l.select("."+k);var d={};for(var h=0;h<c.length;h++){var g=c[h];if(g.className.indexOf("disableBuildTypeParams")!=-1){continue;}if(!g.id.startsWith(a)){continue;}var b=g.id+"_insertArtifact";if(l.select("#"+b).length>0){continue;}d[g.id]=g;this.attachPopup(g,i);}for(var f in d){BS.VisibilityHandlers.updateVisibility(d[f]);}},attachPopup:function(d,g){var f=d.id+"_insertArtifact";var h=document.createElement("i");h.id=f;h.className="tc-icon icon16 tc-icon_folders tc-icon_folders_insert-artifacts";h.style.display="none";h.title="Choose artifact";var e=this;h.onclick=function(){e.currentTextField=d;e.showArtifactsTree(h,e.expandNestedArchives,g);};var b=d.parentNode.className;if(b.indexOf("completionIconWrapper")==-1&&b.indexOf("posRel")==-1){var c=$j(d);var a=BS.Util.wrapRelative(c);if(c.prop("style").width=="100%"){a.css("display","block");}}d.parentNode.appendChild(h);var i={updateVisibility:function(){var j=$(f);var k=$(d.id);if(k.disabled||k.readOnly){BS.Util.hide(j);}else{if(j!=null){BS.Util.show(j);}}}};BS.VisibilityHandlers.attachTo(d.id,i);},showArtifactsTree:function(e,j,g){var a=this.findOutBuildTypeId();var k=this.findOutBuildTypeExternalId();var h=this.findOutBuildRevision();var d=this.findOutBuildNumber();var i=this.findOutBuildTag();var f=this.findOutBuildBranch();var c=window["base_uri"]+"/editArtifactDepsHelper.html?";if(a){c+="&internalBuildTypeId="+a;}if(k){c+="&buildTypeId="+k;}if(h){c+="&buildRevision="+encodeURIComponent(h);}if(d){c+="&buildNumber="+encodeURIComponent(d);}if(i){c+="&buildTag="+encodeURIComponent(i);}if(f){c+="&buildBranch="+encodeURIComponent(f);}if(j!=undefined){c+="&expandNestedArch="+j;}if(g){c+="&"+g;}BS.LazyTree.treeUrl=c;BS.LazyTree.ignoreHashes=true;var b=new BS.Popup("artifactsTreePopup",{hideOnMouseOut:false,hideOnMouseClickOutside:true,shift:{x:20,y:0},url:c});b.showPopupNearElement(e);},findOutBuildTypeId:function(){return $j("#sourceBuildTypeId").val();},findOutBuildTypeExternalId:function(){return null;},findOutBuildRevision:function(){var a=$("revisionRules");return a.selectedIndex>3?null:a.options[a.selectedIndex].value;},findOutBuildNumber:function(){var a=$("buildNumberPattern");return a.disabled?null:a.value;},findOutBuildTag:function(){var a=$("buildTag");return a==null||a.disabled?null:a.value;},findOutBuildBranch:function(){var a=$("buildBranch");return a==null||a.disabled?null:a.value;},appendPath:function(c){if(this.currentTextField){var b=$(this.currentTextField).value;if(b.length>0){var a=b.split("\n");a.push(c);$(this.currentTextField).value=a.join("\n");}else{$(this.currentTextField).value=c;}}},setPath:function(a){if(this.currentTextField){$(this.currentTextField).value=a;}},showHideValueFields:function(d){var c=$("artifactDependencyForm");var a=c.revisionRules.selectedIndex==4;var b=c.revisionRules.selectedIndex==5;if(a){$("buildNumberPattern").disabled=false;BS.Util.show("buildNumberField");$("buildTag").disabled=true;BS.Util.hide("buildTagField");}else{if(b){$("buildNumberPattern").disabled=true;BS.Util.hide("buildNumberField");$("buildTag").disabled=false;BS.Util.show("buildTagField");}else{$("buildNumberPattern").disabled=true;BS.Util.hide("buildNumberField");$("buildTag").disabled=true;BS.Util.hide("buildTagField");}}this.updateBranchField(d);BS.VisibilityHandlers.updateVisibility("buildNumberField");BS.VisibilityHandlers.updateVisibility("buildTagField");},selectedRuleSupportsBranch:function(b){var a=b.revisionRules.selectedIndex;return a==0||a==1||a==2||a==5;},checkRelatedSnapshotDependency:function(a,c){var b=$("artifactDependencyForm");var d=this.getSelectedBuildTypeId(b);var e=false;if(""!=d&&snapshotDepsMap[d]&&b.revisionRules.selectedIndex!=3){if(a){b.revisionRules.setSelected(3,true);if(e){$j(b.sourceBuildTypeId).ufd("setInputFromMaster");}BS.EditArtifactDependencies.showHideValueFields();}else{BS.Util.show("lastFinishedNote");}}else{BS.Util.hide("lastFinishedNote");}BS.VisibilityHandlers.updateVisibility("artifactDependencyForm");},getSelectedBuildTypeId:function(a){return $j("#sourceBuildTypeId").val();},getSelectedBuildTypeExternalId:function(a){return $j("#sourceBuildTypeId").attr("data-filter-data");},getBuildTypesLength:function(a){return 1;},updateBuildTypeTagsList:function(){var b="";var c=$("artifactDependencyForm");var d=this.getSelectedBuildTypeId(c);if(!d||0===d.length){BS.Util.hide("buildTagList");return;}var a=window["base_uri"]+"/editArtifactDepsHelper.html";BS.ajaxRequest(a,{parameters:{listTags:"",internalBuildTypeId:d},onComplete:function(h){var g=h.responseXML;var f=g.firstChild.firstChild;function e(j,i){return'<a href="#" onclick="BS.EditArtifactDependencies.setBuildTagValue(\''+i+"'); return false\">"+j.escapeHTML()+"</a> ";}if(f){while(f){b=b+e(f.attributes.original.value,f.attributes.escaped.value);f=f.nextSibling;}$("buildTagListSpan").innerHTML=b;BS.Util.show("buildTagList");}else{BS.Util.hide("buildTagList");}}});},clearBranchField:function(){$j("#buildBranch").val("");},updateBranchField:function(d,g){var e=$("artifactDependencyForm");if(!this.selectedRuleSupportsBranch(e)){$("buildBranch").disabled=true;BS.Util.hide("buildBranchField");BS.VisibilityHandlers.updateVisibility("buildBranchField");return;}var c=this.getSelectedBuildTypeExternalId(e);if(!c){return;}var a=this.getSelectedBuildTypeId(e);var b=g;if($j("defaultBranchExcluded").val()=="true"){b=true;}this.toggleDefaultBranch(b);var f=d!=undefined&&d==a;if(f){$("buildBranch").disabled=false;BS.Util.show("buildBranchField");BS.BranchesPopup.attachBuildTypeHandler(c,"buildBranch","branchFilter","ALL_BRANCHES");BS.VisibilityHandlers.updateVisibility("buildBranchField");return;}BS.AdminActions.listBranches(c,function(h){var k=h.length>1;if(!k){for(var j=0;j<h.length;j++){if(!h[j].is_default){k=true;break;}}}if(k){$("buildBranch").disabled="";BS.Util.show("buildBranchField");BS.BranchesPopup.attachBuildTypeHandler(c,"buildBranch","branchFilter","ALL_BRANCHES");}else{$("buildBranch").disabled=true;BS.Util.hide("buildBranchField");}BS.VisibilityHandlers.updateVisibility("buildBranchField");});},toggleDefaultBranch:function(a){if(a){if($j("#buildBranch").val()=="+:<default>"){$j("#buildBranch").val("");}}else{if($j("#buildBranch").val()==""){$j("#buildBranch").val("+:<default>");}}},setBuildTagValue:function(b){var a=$("buildTag");if(!a.disabled){a.value=b;}}};BS.MultipleRunnersForm={resetRunner:function(b,a){this.deleteRunnerEx("Are you sure you want to reset this build step to its template definition?",b,a);},deleteRunner:function(b,a){this.deleteRunnerEx("Are you sure you want to delete this build step?",b,a);},deleteRunnerEx:function(c,b,a){if(!confirm(c)){return;}BS.ajaxRequest("editBuildRunners.html",{parameters:"id="+b+"&deleteRunner="+a,onSuccess:function(){if($("buildTypeSettingsContainer")){BS.reload(true);}else{document.location.href="editBuildRunners.html?init=1&id="+b;}}});},setEnabled:function(c,b,a){BS.ajaxRequest("editBuildRunners.html",{parameters:"id="+c+"&setEnabled="+b+"&enabled="+a,onSuccess:function(){BS.reload(true);}});}};BS.CopyBuildStepForm=OO.extend(BS.AbstractCopyMoveDialog,{__baseId:"copyBuildStep",_prepareRequestParameters:function(b,a){return{id:b,runnerId:a};},_onFetchDialogComplete:function(a){$j("body").append(a.responseText);this.showCentered();this.bindCtrlEnterHandler(this.submitCopy.bind(this));},submitCopy:function(){BS.FormSaver.save(this,this.formElement().action,OO.extend(BS.ErrorsAwareListener,{onCopyStepFailed:function(a){alert(a.firstChild.nodeValue);
},onCompleteSave:function(b,c,a){BS.ErrorsAwareListener.onCompleteSave(b,c,a);if(!a){BS.CopyBuildStepForm.close();BS.XMLResponse.processRedirect(c);}}}));return false;}});BS.BuildFeatureDialog=OO.extend(BS.BaseEditBuildTypeForm,OO.extend(BS.AbstractModalDialog,OO.extend(BS.PluginPropertiesForm,{formElement:function(){return $("buildFeatures");},getContainer:function(){return $("buildFeaturesDialog");},savingIndicator:function(){return $("saveFeatureProgress");},showAddDialog:function(e,f,c){this.formElement().featurePlace.value=e;$("featureParams").innerHTML="";$("featureSaveButtonsBlock").show();$j("#editBuildFeatureAdditionalButtons").empty();BS.EditDsl.hideEditDslButtons();this._updateOptionsListAccordingToFeaturePlace();if($("featureTypeSelector").childNodes.length==2){this._initializeDialogWithSingleOption();}else{this._initializeDialogWithMultipleOptions(f);}if(c!=null){var d=$("featureTypeSelector").options;for(var b=0;b<d.length;b++){var a=d[b];if(a.value==c){$("featureTypeSelector").selectedIndex=b;BS.jQueryDropdown($("featureTypeSelector")).ufd("changeOptions");break;}}this.onTypeChange($("featureTypeSelector"));}this.formElement().featureId.value="";this.showCentered();this.bindCtrlEnterHandler(this.save.bind(this));},_updateOptionsListAccordingToFeaturePlace:function(){var e=this.formElement().featurePlace.value;var b=$("featureTypeOptionsData").select("option");$("featureTypeSelector").innerHTML="";for(var c=0;c<b.length;c++){var d=b[c];var a=d.getAttribute("data-feature-place");if(!a||e==a){$("featureTypeSelector").appendChild(d.cloneNode(true));}}},_initializeDialogWithSingleOption:function(){$("buildFeaturesTitle").innerHTML=$("featureTypeSelector").childNodes[1].innerHTML;$("featureTypeSelector").selectedIndex=1;BS.BuildFeatureDialog.onTypeChange($("featureTypeSelector"));$("featureTypeSelector").up("table").hide();$("submitBuildFeatureId").enable();},_initializeDialogWithMultipleOptions:function(a){$("buildFeaturesTitle").innerText=BS.Util.capitalize(a);$("featureTypeSelector").selectedIndex=0;$("featureTypeSelector").options[0].innerHTML="-- Choose "+a.substr(4)+" --";BS.jQueryDropdown($("featureTypeSelector"));$("featureTypeSelector").up("table").show();$("submitBuildFeatureId").disable();},showEditDialog:function(g,h,f,e,b,a,d,c){this.formElement().featurePlace.value=g;$("buildFeaturesTitle").innerText=e;$("featureParams").innerHTML="";$("featureSaveButtonsBlock").hide();$("submitBuildFeatureId").enable();$j("#editBuildFeatureAdditionalButtons").empty();$("featureTypeSelector").up("table").hide();this.formElement().featureId.value=h;this.loadParams("featureId="+h+(b?"&forceOwn=true":""),c,a,d);this.showCentered();this.bindCtrlEnterHandler(this.save.bind(this));},onTypeChange:function(a){$j("#editBuildFeatureAdditionalButtons").empty();if(a.selectedIndex<=0){$("featureParams").innerHTML="";$("submitBuildFeatureId").disable();BS.EditDsl.hideEditDslButtons();return;}$j("#showDSLButton").show();$("submitBuildFeatureId").enable();var b=a.options[a.selectedIndex].value;this.formElement().featureType.value=b;this.loadParams("featureId=&featureType="+b);BS.EditDsl.showEditDslButtons();},loadParams:function(e,d,a,c){var b=window.location.search.substring(1).split("&").grep(/id=(.*)/).join("").split("=")[1];$("loadParamsProgress").show();BS.ajaxUpdater($("featureParams"),window["base_uri"]+"/admin/showFeatureParams.html",{parameters:document.location.search.substring(1)+"&"+e,evalScripts:true,onComplete:function(){BS.BuildFeatureDialog.recenterDialog();BS.AvailableParams.attachPopups("settingsId="+b,"textProperty","multilineProperty");$("loadParamsProgress").hide();BS.VisibilityHandlers.updateVisibility("buildFeaturesDialog");if(c){$j("#submitBuildFeatureId").attr("disabled","disabled");Form.disable("featureParams");}}});},resetFeature:function(c,e,d,b,a){if(b){this.deleteFeatureEx(c,e,d,"This build feature is defined in "+a+" but is overriden by enforced settings and will not be applied in the build. Do you want to reset this build feature and use enforced one?");}else{this.deleteFeatureEx(c,e,d,"Are you sure you want to reset the build feature to its template definition?");}},deleteFeature:function(b,d,c,a){this.deleteFeatureEx(b,d,c,"Are you sure you want to delete this "+a+"?");},deleteFeatureEx:function(a,d,b,c){if(!b){b="The build feature";}if(!confirm(c)){return;}BS.BuildFeatureDialog.doDeleteFeature(a,d,b);},doDeleteFeature:function(c,e,d){var b=this.formElement().getAttribute("action");var a=window.location.search.substring(1).split("&").grep(/id=(.*)/).join("").split("=")[1];BS.ajaxRequest(b,{parameters:"featurePlace="+c+"&id="+a+"&removeFeature=true&featureId="+e+"&messagePrefix="+encodeURIComponent(d),onComplete:function(){BS.reload(true);}});},save:function(){var b=this;var a=this.formElement().getAttribute("action");BS.PasswordFormSaver.save(b,a,OO.extend(BS.ErrorsAwareListener,{onBuildFeatureExistsError:function(c){$("errorBuildFeatureExists").innerHTML=fixErrorMessage(c.firstChild.nodeValue);},onCompleteSave:function(e,g,d){var c=BS.XMLResponse.processErrors(g,{},b.propertiesErrorsHandler)||d;BS.ErrorsAwareListener.onCompleteSave(e,g,c);if(c){return;}var f=b.formElement().featurePlace.value;b.enable();b.close();BS.reload(true);}}));return false;}})));BS.BuildStepsOrderDialog=OO.extend(BS.AbstractModalDialog,OO.extend(BS.AbstractWebForm,{getContainer:function(){return $("buildStepsOrderDialog");},formElement:function(){return $("buildStepsOrder");},savingIndicator:function(){return $("saveOrderProgress");},fixPageScroll:function(){window.scrollTo(0,0);},submitForm:function(b,d){this.disable();if(d&&!confirm("You are about to reset the order of build configuration steps in relation to the inherited build steps to default.")){this.enable();return false;}this.setSaving(true);var a;if(d){a="runnersOrder.reset=true";}else{var c=OO.extend(BS.QueueLikeSorter,{containerId:"buildRunners"});a="runnersOrder="+c.computeOrder($("buildRunners"),"r_");}BS.ajaxRequest(this.formElement().action,{parameters:"id="+b+"&"+a,onComplete:function(e){BS.BuildStepsOrderDialog.enable();BS.BuildStepsOrderDialog.setSaving(false);BS.BuildStepsOrderDialog.close();BS.reload(true);}});return false;}}));BS.TemplatesOrderDialog=OO.extend(BS.AbstractModalDialog,OO.extend(BS.AbstractWebForm,{getContainer:function(){return $("templatesOrderDialog");},formElement:function(){return $("templatesOrder");},savingIndicator:function(){return $("templateSaveOrderProgress");},fixPageScroll:function(){window.scrollTo(0,0);},submitForm:function(c){this.disable();this.setSaving(true);var d=OO.extend(BS.QueueLikeSorter,{containerId:"buildTemplates"});var a=d.computeOrder($("buildTemplates"),"tpl_");var b="";$("buildTemplates").select("input").each(function(e){if(e.value){if(b!=""){b+=";";}b+=e.value;}});if(b){if(!confirm("Are you sure you want to detach the build configuration from the selected template(s)?")){this.enable();return false;}b="&detach="+b;}BS.ajaxRequest(this.formElement().action,{parameters:"id="+c+"&templatesOrder="+a+b,onComplete:function(e){BS.TemplatesOrderDialog.enable();BS.TemplatesOrderDialog.setSaving(false);BS.TemplatesOrderDialog.close();BS.reload(true);}});return false;}}));BS.EditTriggersDialog=OO.extend(BS.BaseEditBuildTypeForm,OO.extend(BS.AbstractModalDialog,OO.extend(BS.PluginPropertiesForm,{getContainer:function(){return $("editTriggerDialog");},formElement:function(){return $("editTrigger");},showAddDialog:function(b){this.formElement().editMode.value="addTrigger";this.formElement().triggerId.value="";$("editTriggerTitle").innerHTML="Add New Trigger";var a=$j("#triggerNameSelector");a.parents("table").show();$j("#triggerNameSelector").val(b||"");BS.jQueryDropdown(a).ufd("changeOptions");this.triggerChanged(b||"");this.showDialog();return false;},showDialog:function(){this.showAtFixed($(this.getContainer()));},showEditDialog:function(a){this.formElement().editMode.value="editTrigger";this.formElement().triggerId.value=a;$("triggerNameSelector").up("table").hide();
$j(".edit-trigger-progress-wrapper").removeClass("hidden");this.triggerChanged(this.allTriggersNames[a]);this.showDialog();},triggerChanged:function(a){if(this.allTriggerServicesDisplayNames[a]){$("editTriggerTitle").innerHTML=this.allTriggerServicesDisplayNames[a];}var b=window.location.search.substring(1).split("&").grep(/id=(.*)/).join("").split("=")[1];this.formElement().triggerName.value=a;$("triggerParams").innerHTML="";if(a==""){BS.EditDsl.hideEditDslButtons();$("editTriggerSubmit").disable();return;}$("editTriggerSubmit").enable();$("loadParamsProgress").show();var c=this;BS.ajaxUpdater("triggerParams",window["base_uri"]+"/admin/showTriggerParams.html",{parameters:"triggerName="+encodeURIComponent(a)+"&triggerId="+this.formElement().triggerId.value+"&id="+b,evalScripts:true,onSuccess:function(){$("loadParamsProgress").hide();$j(".edit-trigger-progress-wrapper").addClass("hidden");window.setTimeout(function(){BS.AvailableParams.attachPopups("settingsId="+b,"textProperty","multilineProperty");c.recenterDialog();},100);}});BS.EditDsl.showEditDslButtons();},submitForm:function(){var b=this;var a=this.formElement().getAttribute("action");BS.PasswordFormSaver.save(b,a,OO.extend(BS.ErrorsAwareListener,{onBuildTriggerExistsError:function(c){$("errorBuildTriggerExists").innerHTML=fixErrorMessage(c.firstChild.nodeValue);},onCompleteSave:function(e,f,d){var c=BS.XMLResponse.processErrors(f,{},b.propertiesErrorsHandler)||d;BS.ErrorsAwareListener.onCompleteSave(e,f,c);if(c){return;}b.enable();b.close();BS.reload(true);}}));return false;},removeTrigger:function(a){let url=this.formElement().getAttribute("action");let requestFunc=function(b){BS.ajaxRequest(url,{parameters:"removeTrigger="+a+"&removeQueued="+b,onComplete:function(){BS.reload(true);}});};BS.DisablingTriggerDialog.show({requestFunc:requestFunc,title:"Delete Trigger",text:"Are you sure you want to delete this trigger?",buttonCaption:"Delete"});},resetTrigger:function(a){if(!confirm("Are you sure you want to reset the trigger to its template definition?")){return;}BS.ajaxRequest(this.formElement().getAttribute("action"),{parameters:"removeTrigger="+a,onComplete:function(){BS.reload(true);}});},allTriggerServicesDisplayNames:{},allTriggersNames:{}})));BS.TestOnFinishedBuildDialog=OO.extend(BS.AbstractModalDialog,{getContainer:function(){return $("testOnFinishedBuildDialog");},submit:function(){$j("#testOnFinishedBuildResult").html("");BS.Util.show("testOnFinishedBuildProgress");BS.ajaxRequest(window["base_uri"]+"/admin/testOnFinishedBuild.html?"+$j(BS.Util.escapeId("buildFailureOnMessage.finishedBuildId")).serialize(),{method:"post",parameters:BS.BuildFeatureDialog.serializeParameters(),onComplete:function(c){BS.Util.hide("testOnFinishedBuildProgress");var b=c.responseXML;var a=BS.XMLResponse.processErrors(b,{},BS.BuildFeatureDialog.propertiesErrorsHandler);if(!a){$j("#testOnFinishedBuildResult").html(b.documentElement.childNodes[0].nodeValue);}else{BS.TestOnFinishedBuildDialog.close();}}});return false;},afterClose:function(){$j("#testOnFinishedBuildResult").html("");},showBuildLog:function(a){window.location.href=window["base_uri"]+"/viewLog.html?tab=buildLog&logTab=tree&buildId="+a;}});BS.AddTriggerRuleDialog=OO.extend(BS.AbstractModalDialog,{attachedToRoot:false,getContainer:function(){return $("addTriggerRuleDialog");},showDialog:function(){this.showCentered();this.bindCtrlEnterHandler(this.submit.bind(this));},submit:function(){if(!this.validate()){return false;}var a=$("triggerBuild1").checked?"+:":"-:";if(!$("username").value.empty()){a+="user="+$("username").value;}if($("vcsRoot").selectedIndex>0){if(!a.endsWith(";")&&!a.endsWith(":")){a+=";";}a+="root="+$("vcsRoot").options[$("vcsRoot").selectedIndex].value;}if(!$("comment").value.empty()&&$("comment").value!="<comment regexp>"){if(!a.endsWith(";")&&!a.endsWith(":")){a+=";";}a+="comment="+$("comment").value;}if(!a.endsWith(":")){a+=":";}a+=$("wildcard").value;if(!$("triggerRules").value.empty()){$("triggerRules").value+="\n";}$("triggerRules").value+=a;BS.MultilineProperties.show("triggerRules",true);this.close();return false;},validate:function(){if(!$("triggerBuild1").checked&&!$("triggerBuild2").checked){alert("Please choose rule type");return false;}if($("wildcard").value.empty()){alert("Wildcard cannot be empty");$("wildcard").focus();return false;}return true;}});BS.RunnersDiscovery={update:function(a){$j("#discoveredRunners").html("");this.showProgress();this.startDiscovering(a);},startDiscovering:function(b){var a=this;BS.ajaxRequest(window["base_uri"]+"/admin/discoverRunners.html",{parameters:"id="+b+"&startDiscovering=true"});window.setTimeout(function(){BS.RunnersDiscovery.showSuggestions(b);},3000);},cancel:function(b){var a=this;BS.ajaxRequest(window["base_uri"]+"/admin/discoverRunners.html",{parameters:"id="+b+"&cancelDiscovery=true",onComplete:function(){a.hideProgress();}});},showProgress:function(){$j("#discoveryProgress").show();$j("#discoveryProgressContainer").show();if($j("#updateDiscoveryContainer")){$j("#updateDiscoveryContainer").hide();}},hideProgress:function(){$j("#discoveryProgressContainer").hide();if($j("#updateDiscoveryContainer")){$j("#updateDiscoveryContainer").show();}},showSuggestions:function(b,a){$j("#discoveredRunners").show();if($j("#discoveredRunners input[type=checkbox]:checked").length>0){return false;}BS.ajaxUpdater($("discoveredRunners"),window["base_uri"]+"/admin/discoverRunners.html",{evalScripts:true,parameters:"id="+b+"&showDiscovered=true",method:"get",onComplete:function(){if(a){a();}}});return true;},addObjects:function(d,b){if(b.length==0){alert("Please select at least one build step");return;}var c="";for(var a=0;a<b.length;a++){var e=b[a];c+="&objectId="+e;}BS.ajaxRequest(window["base_uri"]+"/admin/discoverRunners.html",{parameters:"id="+d+"&addObject=true"+c,onComplete:function(f){if(f.responseXML){BS.XMLResponse.processRedirect(f.responseXML);}else{BS.reload(true);}}});return false;}};BS.EditArtifacts={showPopup:function(c,b){var a=new BS.Popup("editArtifactsTreePopup",{hideOnMouseOut:false,hideOnMouseClickOutside:true,shift:{x:20,y:0},url:window["base_uri"]+"/editArtifactsTreePopup.html?buildTypeId="+b});a.showPopupNearElement(c);this.prepareSelection();return false;},prepareSelection:function(){var a=$j("#artifactPaths");$j(window).off("bs.agentFile bs.agentDir").on("bs.agentFile bs.agentDir",function(f,d){var g=f.namespace=="agentFile"?d:d+" => "+d;var c=a.val();if(c.length>0){var b=c.split("\n");b.push(g);a.val(b.join("\n"));}else{a.val(g);}BS.VisibilityHandlers.updateVisibility("artifactPaths");BS.EditBuildTypeForm.setModified(true);});}};BS.EditDsl={activeClass:"dsl_active",inactiveClass:"dsl_inactive",hideEditDslButtons:function(){if($j(".dialogDslButtons")){$j(".dialogDslButtons").hide();}},showEditDslButtons:function(){if($j(".dialogDslButtons")){$j(".dialogDslButtons").show();}},hideSuccessMessages:function(){var a=$j(".successMessage");if(a){a.hide();}},showEditDslPanel:function(b,a){BS.EditDsl.hideSuccessMessages();$j("#showDSL").val("");$j("#showSourceDSL").val("");$j("#showArtifactDSL").val("");if(b==undefined||a==undefined){b="#uiModeDialog";a=".fragmentEditDsl";}if(b=="#uiMode"){$j(b).addClass(BS.EditDsl.inactiveClass);$j(a).show();}else{$j(a).height($j(b).height());$j(a).addClass(BS.EditDsl.activeClass);}},hideEditDslPanel:function(b,a){BS.EditDsl.hideSuccessMessages();$j("#showDSL").val("");$j("#showSourceDSL").val("");$j("#showArtifactDSL").val("");if(b==undefined||a==undefined){b="#uiModeDialog";a=".fragmentEditDsl";}if(b=="#uiMode"){$j(b).removeClass(BS.EditDsl.inactiveClass);$j(a).hide();}else{$j(a).removeClass(BS.EditDsl.activeClass);}},closeEditDsl:function(b,a,c){$j("#showDSL").val("");BS.EditDsl.hideEditDslPanel(a,c);ReactUI.closeEditDsl(b);},getCurrentStage:function(){var a=document.location.href;if(a.indexOf("/editBuildTypeVcsRoots.html")>-1){return"vcs";}if(a.indexOf("/editTriggers.html")>-1){return"triggers";}if(a.indexOf("/editBuildRunners.html")>-1){return"steps";
}if(a.indexOf("/editBuildFeatures.html")>-1){return"features";}if(a.indexOf("/editBuildFailureConditions.html")>-1){return"failureConditions";}if(a.indexOf("/editRequirements.html")>-1){return"requirements";}if(a.indexOf("/editDependencies.html")>-1){return"dependencies";}if(a.indexOf("/editBuildParams.html")>-1){return"params";}return undefined;}};
/*---
/js/bs/buildType.js
---*/
BS.BuildType={};BS.BuildType.updateView=function(){BS.reload(false,function(){var a="buildConfigurationContainer";BS.Util.runWithElement(a,function(b){if(!b){throw new Error(a+" is not found");}else{$(a).refresh(null,"allTags="+$j("#all-tags-switch").prop("checked"));}},5000);});};BS.BuildType.updateStatus=function(a){jQuery("#restNavigation").children(".buildType").toggleClass("failed",a);};BS.BuildTypeResetSources=OO.extend(BS.AbstractWebForm,OO.extend(BS.AbstractModalDialog,{formElement:function(){return $("resetSources");},getContainer:function(){return $("resetSourcesDialog");},savingIndicator:function(){return $("resetSourcesProgress");},showResetSourcesDialog:function(a){this.noReload=a;this.showCentered();this.bindCtrlEnterHandler(this.submitResetSources.bind(this));$("cleanSourcesDialogContent").refresh("cleanSourcesProgress","showCleanSourcesDialog=1",function(){BS.BuildTypeResetSources.recenterDialog();});return new Promise(function(c,b){this._resolve=c;this._reject=b;}.bind(this));},submitResetSources:function(){if(this.formElement().agentId.selectedIndex==-1){alert("Please choose an agent.");return false;}var a=this;BS.FormSaver.save(this,this.formElement().action,OO.extend(BS.ErrorsAwareListener,{onCompleteSave:function(c,d,b){a.setSaving(false);a.enable();if(!b){a.close();if(!a.noReload){BS.reload(true);}if(a._resolve!=null){a._resolve();}}}}));return false;}}));BS.PauseBuildTypeDialog=OO.extend(BS.AbstractWebForm,OO.extend(BS.AbstractModalDialog,{formElement:function(){return $("pauseBuildTypeForm");},getContainer:function(){return $("pauseBuildTypeFormDialog");},onText:"Pause",offText:"Activate",showPauseBuildTypeDialog:function(b,e,d,c,a){this.noReload=this.formElement().noRedirect.value=a;if(BS.bcActions_handle!=null){BS.bcActions_handle.hidePopup(0);}var f=e?this.onText:this.offText;if(e){$j("#removeFromQueue").attr("checked",d);if(d){BS.Util.show("removeFromQueueDiv");}else{BS.Util.hide("removeFromQueueDiv");}BS.Util.show("pauseNote");}else{BS.Util.hide("pauseNote");BS.Util.hide("removeFromQueueDiv");}this.formElement().pause.value=e;this.formElement().pauseBuildType.value=b;this.formElement().PauseSubmitButton.value=f;$("pauseBuildTypeFormTitle").innerHTML=f+" build configuration";this.formElement().pauseComment.value=c!=null&&c.length>0?c:this.formElement().pauseComment.defaultValue;this.showCentered();this.formElement().pauseComment.focus();this.formElement().pauseComment.select();this.bindCtrlEnterHandler(this.submit.bind(this));return new Promise(function(h,g){this._resolve=h;this._reject=g;}.bind(this));},submit:function(){if(this.formElement().pauseComment.value==this.formElement().pauseComment.defaultValue){this.formElement().pauseComment.value="";}BS.Util.show("pauseProgressIcon");BS.FormSaver.save(this,this.formElement().action,OO.extend(BS.ErrorsAwareListener,{onCompleteSave:function(b,c,a){b.enable();BS.Util.hide("pauseProgressIcon");if(!this.noReload){BS.reload(true);}else{this.close();}if(this._resolve!=null){this._resolve();}}.bind(this),onFailure:function(){BS.Util.hide("pauseProgressIcon");alert("Problem accessing server");}}),false,this.noReload);return false;}}));